!function(){"use strict";class t{constructor(){this.keys_=null,this.values_=null,this.keys_=new Array,this.values_=new Object}copy(t){let e=t.keys_,i=t.values_;if(e)for(let t=0;t<e.length;++t)this.keys_[t]=e[t];if(i)for(let t in i)i.hasOwnProperty(t)&&(this.values_[t]=i[t])}toString(){let t="{ ";for(let e=0,i=this.keys_.length;e<i;++e,t+=", "){let i=this.keys_[e];t+=i+" = "+this.values_[i]}return t=t.substring(0,t.length-1),t+=" }"}size(){return this.keys_.length}put(t,e){let i=t.toString();null==this.values_[i]?(this.values_[i]=e,this.keys_.push(i)):this.values_[i]=e}get(t){let e=t.toString();return this.values_[e]}getFirst(){let t=null,e=this.keys_[0];return t=this.values_[e]}getLast(){let t=null,e=this.keys_[this.keys_.length-1];return t=this.values_[e]}getByIndex(t){let e=null;if(t>=0&&t<this.keys_.length){let i=this.keys_[t];e=this.values_[i]}return e}remove(t){let e=t.toString(),i=this.indexOf(e);-1!=i&&this.keys_.splice(i,1),this.values_[e]=null}clear(){for(let t=0,e=this.keys_.length;t<e;++t)this.values_[this.keys_[t]]=null;this.keys_=[]}containsKey(t){let e=t.toString();return null!=this.values_[e]}isEmpty(){return 0===this.keys_.length}each(t,e=null){if(t)for(let i=0;i<this.keys_.length;++i){const s=this.keys_[i];t(i,s,this.values_[s],e)}}indexOf(t){let e=-1;const i=this.size();if(i>0){let s=t.toString();for(let t=0,a=i;t<a;++t)if(this.keys_[t]==s){e=t;break}}return e}values(t=0,e=0){let i=new Array,s=(e>0?Math.min(this.keys_.length,e):this.keys_.length)+t;for(let e=t;e<s;++e)i.push(this.values_[this.keys_[e]]);return i}}const e=[.1,.01,.001,1e-4,1e-5,1e-6];class i{static isEmptyObj(t){if(t){if("object"!=typeof t)return!1;for(let e in t)return!1}return!0}static isExistObj(t){return!this.isEmptyObj(t)}static uniqueArray(t){return t.filter(function(t,e,i){return i.indexOf(t)===e})}static uniqueArrayEx(t){let e={};return t.filter(function(t,i,s){return!e.hasOwnProperty(typeof t+JSON.stringify(t))&&(e[typeof t+JSON.stringify(t)]=!0)})}static clampString(t,e,i){i=null==i?"...":i,e*=2;for(var s=this._toCodePoint(t),a=0,n=0,o=0;o<s.length;++o){var l=1;if(s[o].v>=128&&(l=2),a+l>e)break;n=o,a+=l}if(s.length-1==n)return t;var r=i?1:0;return t.substring(0,s[n-r].pos+1)+i}static isEqualF(t,i,s=6){let a=!1,n=e[s-1]||1e-4;return Math.abs(t-i)<=n&&(a=!0),a}static randRange(t,e){return Math.round(Math.random()*(e-t))+t}static randRangeF(t,e,i=0){let s=Math.random()*(e-t)+t;return i>0&&(s=parseFloat(s.toFixed(i))),s}static readJson(t,e){let i=t;-1!==i.indexOf(".json")||(i=t+".json"),Laya.loader.load(i,Laya.Handler.create(null,()=>{let t=Laya.loader.getRes(i);e&&e(t),Laya.loader.clearRes(i)}),null,Laya.Loader.JSON)}static layaHandler(t,e,i,s=!0){return Laya.Handler.create(t,e,i,s)}static formatSecond(t,e=1){let i="";if(1===e){i=parseInt((t/60).toString())+"分"+(t%60).toFixed(0)+"秒"}else if(2===e){let e=t%3600;i=parseInt((t/3600).toString())+"小时"+parseInt((e/60).toString())+"分"+(e%60).toFixed(0)+"秒"}else if(3===e){let e=t%86400,s=e%3600;i=parseInt((t/86400).toString())+"天"+parseInt((e/3600).toString())+"小时"+parseInt((s/60).toString())+"分"+(s%60).toFixed(0)+"秒"}return i}static log(t,...e){e&&e.length>0?console.log(t,e):console.log(t)}static warn(t,...e){e&&e.length>0?console.warn(t,e):console.warn(t)}static error(t,...e){e&&e.length>0?console.error(t,e):console.error(t)}static get isWeChat(){return"undefined"!=typeof wx}static get isBaidu(){return"undefined"!=typeof swan}static get isByteDance(){return"undefined"!=typeof tt}}i._toCodePoint=function(t){let e=[],i=0,s=0,a=0;for(;a<t.length;){let n=a;if(65039!=(i=t.charCodeAt(a++)))if(s){let t=65536+(s-55296<<10)+(i-56320);e.push({v:t,pos:n}),s=0}else 55296<=i&&i<=56319?s=i:e.push({v:i,pos:n})}return e};class s{constructor(){this.sceneMap_=new t,this.sprite3DMap_=new t,this.meshMap_=new t,this.skinMeshMap_=new t,this.matMap_=new t,this.texMap_=new t,this.animMap_=new t,this.lockedMap_=new t}loadScene(t,e){Laya.Scene3D.load(t,Laya.Handler.create(this,s=>{s?(this.sceneMap_.put(t,s),e&&e(s)):i.log("[ResManager] loadScene failed",2)}))}getScene(t){let e=null;return this.sceneMap_.containsKey(t)&&(e=this.sceneMap_.get(t)),e}releaseScene(t){let e=this.getScene(t);e&&(e.destroy(),e=null,this.sceneMap_.remove(t))}loadSprite3D(t,e){Laya.Sprite3D.load(t,Laya.Handler.create(this,s=>{s?(this.sprite3DMap_.put(t,s),e&&e(s)):i.log("[ResManager] loadSprite3D failed",2)}))}getSprite3D(t){let e=null;return this.sprite3DMap_.containsKey(t)&&(e=this.sprite3DMap_.get(t)),e}releaseSprite3D(t){let e=this.getSprite3D(t);e&&(e.destroy(),e=null,this.sprite3DMap_.remove(t))}loadMaterial(t,e){Laya.BaseMaterial.load(t,Laya.Handler.create(this,s=>{s?(this.matMap_.put(t,s),e&&e(s)):i.log("[ResManager] loadMaterial failed",2)}))}getMaterial(t){let e=null;return this.matMap_.containsKey(t)&&(e=this.matMap_.get(t)),e}releaseMaterial(t){let e=this.getMaterial(t);e&&(e.destroy(),e=null,this.matMap_.remove(t))}loadTexture(t,e){Laya.Texture2D.load(t,Laya.Handler.create(this,s=>{s?(this.texMap_.put(t,s),e&&e(s)):i.log("[ResManager] loadTexture failed",2)}))}getTexture(t){let e=null;return this.texMap_.containsKey(t)&&(e=this.texMap_.get(t)),e}releaseTexture(t){let e=this.getTexture(t);e&&(e.destroy(),e=null,this.texMap_.remove(t))}loadMesh(t,e,s=1){Laya.Mesh.load(t,Laya.Handler.create(this,a=>{if(a){let i=null;1===s?(i=new Laya.MeshSprite3D(a),this.meshMap_.put(t,i)):2===s?(i=new Laya.SkinnedMeshSprite3D(a),this.skinMeshMap_.put(t,i)):3===s&&(i=a),e&&e(i)}else i.log("[ResManager] loadMesh failed",2)}))}getMesh(t){let e=null;return this.meshMap_.containsKey(t)&&(e=this.meshMap_.get(t)),e}releaseMesh(t){let e=this.getMesh(t);e&&(e.destroy(),e=null,this.meshMap_.remove(t))}getSkinMesh(t){let e=null;return this.skinMeshMap_.containsKey(t)&&(e=this.skinMeshMap_.get(t)),e}releaseSkinMesh(t){let e=this.getSkinMesh(t);e&&(e.destroy(),e=null,this.skinMeshMap_.remove(t))}loadAnim(t,e){Laya.AnimationClip.load(t,Laya.Handler.create(this,s=>{s?(this.animMap_.put(t,s),e&&e(s)):i.log("[ResManager] loadAnim failed",2,t)}))}getAnim(t){let e=null;return this.animMap_.containsKey(t)&&(e=this.animMap_.get(t)),e}releaseAnim(t){let e=this.getAnim(t);e&&(e.destroy(),e=null,this.animMap_.remove(t))}batchPreload(t,e){Laya.loader.create(t,Laya.Handler.create(this,this._preloaded,[t,e]))}_preloaded(t,e){for(let s=0;s<t.length;++s){let a=Laya.loader.getRes(t[s]);a?this._assignFileType(t[s],a):i.log("[ResManager] batchPreload failed",2,t[s]),e&&e(t[s])}}_assignFileType(t,e){if(-1!==t.lastIndexOf(".ls"))this.sceneMap_.put(t,e);else if(-1!==t.lastIndexOf(".lh"))this.sprite3DMap_.put(t,e);else if(-1!==t.lastIndexOf(".lmat"))this.matMap_.put(t,e);else if(-1!==t.lastIndexOf(".lm"))if(-1===t.indexOf("skin_")){let i=new Laya.MeshSprite3D(e);this.skinMeshMap_.put(t,i)}else{let i=new Laya.SkinnedMeshSprite3D(e);this.meshMap_.put(t,i)}else-1!==t.lastIndexOf(".lani")?this.animMap_.put(t,e):-1===t.lastIndexOf(".png")&&-1===t.lastIndexOf(".jpg")||this.texMap_.put(t,e)}lockSwitch(t,e,s){if(1===e){let e=this.getMaterial(t);e?e.lock=s:i.log("[ResManager] lock failed",2,t)}else if(2===e){let e=this.getMesh(t);e?e.meshFilter.sharedMesh.lock=s:i.log("[ResManager] lock failed",2,t)}else if(3===e){let e=this.getSkinMesh(t);e?e.meshFilter.sharedMesh.lock=s:i.log("[ResManager] lock failed",2,t)}else if(4===e){let e=this.getAnim(t);e?e.lock=s:i.log("[ResManager] lock failed",2,t)}else if(5===e){let e=this.getTexture(t);e?e.lock=s:i.log("[ResManager] lock failed",2,t)}}clearUnused(){Laya.Resource.destroyUnusedResources()}}s.instance=new s,s.nativePath="res/";class a{}a.kGameData="gameDat",a.kSetting="setting",a.kAudio="audio",a.kWxStatus="wxStatus",a.kPlayer="player",a.kDaily="signIn",a.kVersion="ver",a.kForceNav="nav";class n{static clearAllStorage(){Laya.LocalStorage.clear()}static writeBoolean(t,e){let i=e?1:0;Laya.LocalStorage.setItem(t,i.toString())}static readBoolean(t){let e=null,i=Laya.LocalStorage.getItem(t);if(null!=i&&""!==i){let t=parseInt(i);0===t?e=!1:null==t||isNaN(t)||(e=1==t)}return e}static writeNum(t,e){Laya.LocalStorage.setItem(t,e.toString())}static readNum(t){let e=null,i=Laya.LocalStorage.getItem(t);if(null!=i&&""!==i){let t=parseFloat(i);isNaN(t)||(e=t)}return e}static writeJSON(t,e){let i=JSON.stringify(e);Laya.LocalStorage.setItem(t,i)}static readJSON(t){let e=null,i=Laya.LocalStorage.getItem(t);return i&&(e=JSON.parse(i)),e}static remove(t){Laya.LocalStorage.removeItem(t)}}var o;!function(t){t[t.kNone=0]="kNone",t[t.kAudioPause=1]="kAudioPause",t[t.kAudioResume=2]="kAudioResume",t[t.kBnrAdBrowerSim=3]="kBnrAdBrowerSim",t[t.kAdjustVfxLv=4]="kAdjustVfxLv",t[t.kOpenFreeBox=5]="kOpenFreeBox",t[t.kLeaveHome=6]="kLeaveHome",t[t.kRedPoint=7]="kRedPoint"}(o||(o={}));class l{constructor(){this.type_=o.kNone,this.id_=0,this.sender_=null,this.data_=null}init(t,e,i,s){this.id_=t,this.type_=e,this.sender_=i,this.data_=s}get type(){return this.type_}get id(){return this.id_}get sender(){return this.sender_}get data(){return this.data_}}class r{constructor(){this.id_=0,this.callback_=null,this.bExe=!1}get id(){return this.id_}init(t,e){this.id_=t,this.callback_=e}excute(t,e){this.bExe=!0,this.callback_&&this.callback_(t,e),this.bExe=!1}}class h{constructor(){this.baseEvtId_=0,this.baseListenerId_=0,this.listenerMap_=null,this.persistListnerMap_=null,this.delMap_=new t,this.evtLst_=null,this.bExe_=!1}init(){this.baseEvtId_=0,this.baseListenerId_=0,null==this.listenerMap_&&(this.listenerMap_=new t),this.listenerMap_.clear(),null==this.persistListnerMap_&&(this.persistListnerMap_=new t),this.persistListnerMap_.clear(),null==this.evtLst_&&(this.evtLst_=new Array),this.evtLst_=[],this.bExe_=!1}addEvent(t,e=null,i=null,s=!0){++this.baseEvtId_;let a=new l;if(a.init(this.baseEvtId_,t,e,i),s){let e=this.listenerMap_.get(t);if(null!=e)for(let t=0;t<e.length;++t)e[t].excute(a.sender,a.data)}else this.bExe_=!0,this.evtLst_.push(a)}addListener(t,e,i=!1){++this.baseListenerId_;let s=new r;s.init(this.baseListenerId_,e);let a=null;return this.listenerMap_.containsKey(t)?null!=(a=this.listenerMap_.get(t))&&a.push(s):((a=new Array).push(s),this.listenerMap_.put(t,a)),i&&a&&this.persistListnerMap_.put(t,a),this.baseListenerId_}removeListener(t,e){if(this.listenerMap_.containsKey(t)){let i=this.listenerMap_.get(t);if(null!=i){for(let s=0;s<i.length;++s){if(!i[s].bExe&&i[s].id===e){i.splice(s,1);break}i[s].bExe&&(this.delMap_.put(t,e),this.bExe_=!0)}0==i.length&&(this.listenerMap_.remove(t),this.persistListnerMap_.containsKey(t)&&this.persistListnerMap_.remove(t))}}}clear(){this.evtLst_=[];let t=[];this.listenerMap_.each((e,i,s)=>{this.persistListnerMap_.containsKey(i)||t.push(i)});for(let e=0;e<t.length;++e)this.listenerMap_.remove(t[e]);this.delMap_.clear()}excuteEvents(){if(this.bExe_){for(let t=0;t<this.evtLst_.length;++t){let e=this.evtLst_[t];if(null==e){i.log("can not find the approriate game event",3);break}let s=this.listenerMap_.get(e.type);if(s)for(let t=0;t<s.length;++t)s[t].excute(e.sender,e.data);else i.log("Can not find the listeners about event ",2,e.type.toString())}this.delMap_.size()>0&&(this.delMap_.each((t,e,i)=>{this.removeListener(e,i)}),this.delMap_.clear()),this.evtLst_=[],this.bExe_=!1}}}h.instance=new h;const c=h.instance;class d{}d.kGameData="gameDat",d.kSetting="setting",d.kAudio="audio",d.kWxStatus="wxStatus",d.kPlayer="player",d.kDaily="signIn",d.kVersion="ver",d.kForceNav="nav";class _{static clearAllStorage(){Laya.LocalStorage.clear()}static writeBoolean(t,e){let i=e?1:0;Laya.LocalStorage.setItem(t,i.toString())}static readBoolean(t){let e=null,i=Laya.LocalStorage.getItem(t);if(null!=i&&""!==i){let t=parseInt(i);0===t?e=!1:null==t||isNaN(t)||(e=1==t)}return e}static writeNum(t,e){Laya.LocalStorage.setItem(t,e.toString())}static readNum(t){let e=null,i=Laya.LocalStorage.getItem(t);if(null!=i&&""!==i){let t=parseFloat(i);isNaN(t)||(e=t)}return e}static writeJSON(t,e){let i=JSON.stringify(e);Laya.LocalStorage.setItem(t,i)}static readJSON(t){let e=null,i=Laya.LocalStorage.getItem(t);return i&&(e=JSON.parse(i)),e}static remove(t){Laya.LocalStorage.removeItem(t)}}var u;!function(t){t[t.kNone=0]="kNone"}(u||(u={}));const g=-2;class p{constructor(){this.id=0,this.type=u.kNone,this.callback_=null,this.param_=null,this.timer_=0,this.repeat_=1,this.delay_=0,this.interval_=0,this.bFrame_=!1,this.bPause_=!1}set pause(t){this.bPause_=this.bPause_}init(t,e,i=0,s=1,a=0,n=null,o=u.kNone,l=!1){this.id=t,this.callback_=e,this.repeat_=s<g?g:s,this.delay_=i,this.interval_=a,this.timer_=a,this.type=o,this.bFrame_=l,this.bPause_=!1}excute(t){if(this.bPause_)return;let e=!1;if(!(this.delay_>0))return this.repeat_>0||this.repeat_===g?(this.bFrame_?++this.timer_:this.timer_+=t,this.timer_>=this.interval_&&(this.repeat_>0&&--this.repeat_,this.callback_&&this.callback_(this.param_),this.timer_=0)):0===this.repeat_&&(e=!0),e;this.bFrame_?--this.delay_:this.delay_-=t}}class m{constructor(){this.baseId_=0,this.noneTypeMap_=new t,this.specTypeMap_=new t}add(t,e=0,i=1,s=0,a=null,n=u.kNone,o=!1){++this.baseId_;let l=new p;if(l.init(this.baseId_,t,e,i,s,a,n,o),n===u.kNone)this.noneTypeMap_.put(this.baseId_,l);else if(this.specTypeMap_.containsKey(l)){let t=this.specTypeMap_.get(l);null!=t&&t.push(l)}else{let t=new Array;t.push(l),this.specTypeMap_.put(l,t)}return this.baseId_}addWithFrame(t,e=0,i=1,s=0,a=null,n=u.kNone){this.add(t,e,i,s,a,n,!0)}pause(t,e,i=u.kNone){if(i===u.kNone)this.noneTypeMap_.containsKey(e)?this.noneTypeMap_.get(e).pause=t:console.warn("[TimedTask] not valid id in type <TimedTaskType.kNone>");else if(this.specTypeMap_.containsKey(i))if(-1===e){let e=this.specTypeMap_.get(i);if(e)for(let i=0;i<e.length;++i)e[i].pause=t}else{let s=this.specTypeMap_.get(i);if(null!=s)for(let i=0;i<s.length;++i)if(s[i].id===e){s[i].pause=t;break}}else console.warn("[TimedTask] not valid type: ",i)}pauseAll(t,e){this.noneTypeMap_.each((i,s,a)=>{if(e){let i=!1;for(let t=0;t<e.length;++t)if(e[t]==a.id){e.splice(t,1),i=!0;break}i||(a.pause=t)}else a.pause=t}),this.specTypeMap_.each((i,s,a)=>{if(e)for(let i=0;i<a.length;++i){let s=!1;for(let t=0;t<e.length;++t)if(e[t]==a[i].id){e.splice(t,1),s=!0;break}s||(a[i].pause=t)}else for(let e=0;e<a.length;++e)a[e].pause=t})}remove(t,e=u.kNone){if(e===u.kNone)this.noneTypeMap_.containsKey(t)&&this.noneTypeMap_.remove(t);else if(this.specTypeMap_.containsKey(e))if(-1===t)this.specTypeMap_.remove(e);else{let i=this.specTypeMap_.get(e);if(null!=i){for(let e=0;e<i.length;++e)if(i[e].id===t){i.splice(e,1);break}0==i.length&&this.specTypeMap_.remove(e)}}else console.warn("[TimedTask] not valid type: ",e)}clear(){this.baseId_=0,this.noneTypeMap_.clear(),this.specTypeMap_.clear()}excuteTasks(t){if(this.noneTypeMap_.size()>0){let e=[];this.noneTypeMap_.each((i,s,a)=>{a.excute(t)&&e.push(a.id)});for(let t=0;t<e.length;++t)this.remove(e[t])}if(this.specTypeMap_.size()>0){let e=[],i=[];this.specTypeMap_.each((s,a,n)=>{if(n){e.push(a);for(let e=0;e<n.length;++e)n[e].excute(t)&&i.push(n[e].id)}});for(let t=0;t<e.length;++t)for(let s=0;s<i.length;++s)this.remove(i[s],e[t])}}}m.instance=new m;const f=m.instance;class y{}y.debug=0,y.framerate=60,y.payment=0,y.proName="",y.openId="",y.unionId="",y.sessionKey="",y.gameId="";class b{static saveData(){let t={openId:y.openId};_.writeJSON(d.kWxStatus,t)}static readData(){let t=_.readJSON(d.kWxStatus);t&&(y.openId=t.openId)}static fetchSdkInfo(){this.sdkInfo=wx.getSystemInfoSync(),console.log("[WxUtil SDK info]",this.sdkInfo.screenWidth,this.sdkInfo.screenHeight,this.sdkInfo.platform,this.sdkInfo.SDKVersion)}static compareVersionForWx(t,e){let i=t.split("."),s=e.split("."),a=Math.max(i.length,s.length);for(;i.length<a;)i.push("0");for(;s.length<a;)s.push("0");for(let t=0;t<a;t++){let e=parseInt(i[t]),a=parseInt(s[t]);if(e>a)return 1;if(e<a)return-1}return 0}static login(t,e,i,s=!1,a=!1){s?this._login(t,e,i,a):wx.checkSession({success:t=>{console.log("check session succ",t),b.readData()},fail:s=>{console.log("check session fail",s),this._login(t,e,i,a)},complete:t=>{}})}static _login(t,e,s,a=!1){wx.login({success:n=>{i.log("login succ",1,n,a),n.code&&(this.loginCode=n.code,a?t&&t():wx.request({url:this.domain_+"/user/getSessionKey",data:{code:n.code,proName:y.proName,choose:"1"},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:i=>{i.statusCode>=200&&i.statusCode<=400?(console.log("login request succ",i),t&&t(JSON.parse(i.data.res))):(console.log("login request fail",i),e&&e(i))},fail:t=>{console.log("login request complete fail",t),s&&s(t)}}))},fail:t=>{console.log("login fail",t),s&&s(t)},complete:t=>{}})}static fetchUserInfo(t,e,s,a,n,o){-1!=b.compareVersionForWx(this.sdkInfo.SDKVersion,"1.2.0")?wx.getSetting({success:l=>{if(l.authSetting["scope.userInfo"])wx.getUserInfo({withCredentials:!0,lang:"zh_CN",success:t=>{e&&e(t.userInfo),this._authLogin(t,s,a)},fail:t=>{i.log("get setting scope userInfo failed",1,t)},complete:t=>{}});else if(-1!=b.compareVersionForWx(this.sdkInfo.SDKVersion,"2.0.1")){let l=wx.createImage();l.src="res/raw-assets/resources/"+t+".png",l.onload=function(){let t=o;if(i.isEmptyObj(t)){let e=l.width,i=l.height;t={left:.5*this.sdkInfo.screenWidth-.5*e,top:.5*this.sdkInfo.screenHeight,width:e,height:i,color:"#ffffff",lineHeight:40,backgroundColor:"#ff0000",borderColor:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4}}this._authentication(e,t,l.src,n,s,a)}.bind(this)}else b.modalDialog("微信更新提示","当前微信版本较低，建议升级以保障游戏体验",function(){wx.exitMiniProgram({})},null,!1)},fail:t=>{},complete:t=>{}}):b.modalDialog("微信更新提示","当前微信版本过低，请升级已保障正常游戏体验",function(){wx.exitMiniProgram({})},null,!1)}static _authLogin(t,e,i){wx.request({url:this.domain_+"/user/auth",data:{encryptedData:t.encryptedData,iv:t.iv,code:this.loginCode,proName:y.proName},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:t=>{t.statusCode>=200&&t.statusCode<=400?(console.log("_authLogin request succ",t),e&&e(t.data.res)):(console.log("_authLogin request fail",t),i&&i())},fail:t=>{console.log("_authLogin request complete fail",t)}})}static _authentication(t,e,s,a,n,o){let l=wx.createUserInfoButton({type:"image",text:"txt",image:s,style:e,withCredentials:!0,lang:"zh_CN"});l.show(),i.log("create button",1,l);let r=function(h){if(i.log("_authentication onTap",1,h),null==h.iv||null==h.encryptedData){i.log("cancel auth");let l=wx.createImage();l.src=s,l.onload=function(){let s=e;if(i.isEmptyObj(s)){let t=l.width,e=l.height;s={left:.5*this.sdkInfo.screenWidth-.5*t,top:.5*this.sdkInfo.screenHeight,width:t,height:e,color:"#ffffff",lineHeight:40,backgroundColor:"#ff0000",borderColor:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4}}this._authentication(t,e,l.src,a,n,o)}.bind(this)}else t&&t(h.userInfo),this._authLogin(h,n,o),a&&a();l.offTap(r),l.destroy()}.bind(this);l.onTap(r)}static uploadUserInfo(t,e,i,s,a,n){wx.request({url:this.domain_+"/user/updUser",data:{proName:y.proName,openid:y.openId,unionid:y.unionId,nickname:t,gender:i,avatarurl:e,city:s,province:a,country:n},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:t=>{},fail:t=>{}})}static showForward(t){wx.showShareMenu({withShareTicket:!1,success:t=>{},fail:()=>{},complete:()=>{}}),wx.onShareAppMessage(function(){let e=null;return t&&(e=t()),e})}static launchQueryCheck(t=!1){}static onShowQueryCheck(t,e=!1){}static reqTimerReset(t,e,s){let a=function(){wx.request({url:this.domain_+"/user/reqTimerReset",data:{proName:y.proName,sysName:t,openId:y.openId,choose:e.toString()},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:t=>{if(t.statusCode>=200&&t.statusCode<=400){console.log("reqTimerReset request succ",t);let e=parseInt(t.data.res);s&&s(e)}else console.log("reqTimerReset request fail",t),b.modalDialog("网络报告","当前网络环境不佳，请检查网络后重试")},fail:t=>{console.log("reqTimerReset request fail",t)}})}.bind(this);""==y.openId?b.login(function(t){y.sessionKey=t.sessionKey,y.openId=t.openId,a(),i.log("reqTimerReset relogin",1,t)},null,null,!0):a()}static reqTimerResetUnion(t,e,i,s){let a=function(){wx.request({url:this.domain_+"/user/reqTimerResetU",data:{proName:y.proName,sysName:t,unionId:y.unionId,choose:e.toString()},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:t=>{if(t.statusCode>=200&&t.statusCode<=400){console.log("reqTimerResetUnion request succ",t);let e=parseInt(t.data.res);i&&i(e)}else console.log("reqTimerResetUnion request fail",t)},fail:t=>{console.log("reqTimerResetUnion request complete fail",t)}})}.bind(this);""==y.unionId?s&&s():a()}static watchVideoAds(t,e,i,s,a){let n=b.sdkInfo;if(-1!=b.compareVersionForWx(n.SDKVersion,"2.1.0")){let n=function(s){if(b.videoAdsProtectFlags_.containsKey(t)){if(1===b.videoAdsProtectFlags_.get(t))return}console.log("Ads Close callback",s.isEnded),c.addEvent(o.kAudioResume),s&&s.isEnded||void 0===s?(e&&e(),b.videoAdsProtectFlags_.put(t,1)):(i&&i(),b.videoAdsProtectFlags_.put(t,0)),b.videoTimeId_>0&&(f.remove(b.videoTimeId_),b.videoTimeId_=0),b.videoBonusCallback_=null},l=function(t){console.log("Ads error callback",t.errMsg),c.addEvent(o.kAudioResume),s&&s(t),b.videoBonusCallback_=null};if(b.videoAd_=wx.createRewardedVideoAd({adUnitId:t}),b.videoAd_.load().then(()=>{b.videoAd_.show().then(()=>{console.log("video show"),c.addEvent(o.kAudioPause)}).catch(t=>console.log("video err",t)),b.videoAdsProtectFlags_.put(t,0)}).catch(t=>console.log(t.errMsg)),this.videoAdsCallbackMap_.containsKey(t)){let e=this.videoAdsCallbackMap_.get(t);b.videoAd_.offClose(e.closeCallback),b.videoAd_.offError(e.errCallback),this.videoAdsCallbackMap_.remove(t)}b.videoAd_.onClose(n),b.videoAd_.onError(l);let r=new x(n,l);this.videoAdsCallbackMap_.put(t,r),a&&a()}else b.modalDialog("提示","微信版本较低，暂不支持视频观看",null,null,!1)}static addInterstitialAd(t){let e=b.sdkInfo;if(-1!=b.compareVersionForWx(e.SDKVersion,"2.6.0"))try{this.interAd=wx.createInterstitialAd({adUnitId:t})}catch(t){console.log("addInterstitialAd",t)}}static showInterstitialAd(){let t=b.sdkInfo;if(-1!=b.compareVersionForWx(t.SDKVersion,"2.6.0")&&this.interAd)try{this.interAd.show()}catch(t){console.log("showInterstitialAd",t)}}static checkVersionUpdate(t,e){let s=b.sdkInfo;if(-1!=b.compareVersionForWx(s.SDKVersion,"1.9.90")){let a=s.system;if(-1!==a.indexOf("Android")){let t=a.substr(7).trim();if(-1==b.compareVersionForWx(t,"6.6.7"))return i.log("skip update cause the system version is too low",1,t),void(e&&e())}i.log("check version update",s.system);const n=wx.getUpdateManager();n.onCheckForUpdate(function(i){console.log(i.hasUpdate),i.hasUpdate?t&&t():e&&e()}),n.onUpdateReady(function(){b.modalDialog("更新提示","新版本已经准备好，请重启游戏",function(){n.applyUpdate()},null,!1)}),n.onUpdateFailed(function(){b.modalDialog("更新提示","新版本下载失败，请确认网络环境是否良好或者重启微信",null,null,!1)})}else b.modalDialog("微信更新提示","当前微信版本较低，建议升级以保障游戏体验",null,null,!1),e&&e()}static modalDialog(t,e,i,s,a=!0,n="取消",o="#000000",l="确定",r="#3cc51f"){wx.showModal({title:t,content:e,showCancel:a,cancelText:n,cancelColor:o,confirmText:l,confirmColor:r,success:function(t){t.confirm?i&&i():t.cancel&&s&&s()}})}static toast(t,e=1500){wx.showToast({title:t,duration:e,icon:"none"})}static showGameClub(t,e,i,s){-1!=b.compareVersionForWx(this.sdkInfo.SDKVersion,"2.0.3")&&(null==this.gameClub_&&(this.gameClub_=wx.createGameClubButton({type:"image",text:"",image:"",style:{left:t,top:e,width:i,height:s},icon:"dark"})),this.gameClub_.show())}static hideGameClub(){i.isExistObj(this.gameClub_)&&this.gameClub_.hide()}static removeGameClub(){i.isExistObj(this.gameClub_)&&(this.gameClub_.destroy(),this.gameClub_=null)}static vibrateShort(){-1!=b.compareVersionForWx(this.sdkInfo.SDKVersion,"1.2.0")&&wx.vibrateShort()}static vibrateLong(){-1!=b.compareVersionForWx(this.sdkInfo.SDKVersion,"1.2.0")&&wx.vibrateLong()}static setAudioOption(t,e){-1!=b.compareVersionForWx(this.sdkInfo.SDKVersion,"2.3.0")&&wx.setInnerAudioOption({mixWithOther:t,obeyMuteSwitch:e})}static playAudio(t,e=!1,i=0,s=1,a=!1){let n=null;if(this.audioInfoMap_.containsKey(t)?n=this.audioInfoMap_.get(t):(n=new k(t),this.audioInfoMap_.put(t,n)),n){let o=n.obj;o&&(o.src=t,o.startTime=i,o.volume=s,o.loop=e,o.autoplay=a,o.play())}}static addAudioCallback(t,e){if(this.audioInfoMap_.containsKey(t)){let i=this.audioInfoMap_.get(t);i.endCallback&&i.obj.offEnded(i.endCallback),i.endCallback=e,i.obj.onEnded(i.endCallback)}}static resumeAudio(t){if(this.audioInfoMap_.containsKey(t)){this.audioInfoMap_.get(t).obj.play()}}static pauseAudio(t){if(this.audioInfoMap_.containsKey(t)){this.audioInfoMap_.get(t).obj.pause()}}static stopAudio(t){if(this.audioInfoMap_.containsKey(t)){this.audioInfoMap_.get(t).obj.stop()}}static destroyAudio(t){if(this.audioInfoMap_.containsKey(t)){let e=this.audioInfoMap_.get(t);e.endCallback&&e.obj.offEnded(e.endCallback),e.obj.destroy(),this.audioInfoMap_.remove(t)}}}b.sdkInfo=null,b.domain_="https://login.joyfulh.com/comLogin",b.loginCode="",b.videoBonusCallback_=null,b.videoAd_=null,b.videoTimeId_=0,b.videoAdsProtectFlags_=new t,b.videoAdsCallbackMap_=new t,b.interAd=null,b.gameClub_=null,b.audioInfoMap_=new t;class k{constructor(t){this.obj=null,this.endCallback=null,this.obj=wx.createInnerAudioContext()}}class x{constructor(t,e){this.closeCallback=null,this.errCallback=null,this.closeCallback=t,this.errCallback=e}}var v;!function(t){t[t.kBgmMenu=0]="kBgmMenu",t[t.kNone=9999]="kNone"}(v||(v={}));const w=["bgm_menu"];var M;!function(t){t[t.kGoodClick=0]="kGoodClick",t[t.kLuckyBox=1]="kLuckyBox",t[t.kNone=9999]="kNone"}(M||(M={}));const L=["goodClick","luckybox"];class S{constructor(){this.bMuteMusic_=!1,this.bMuteSound_=!1,this.curBgmType_=v.kNone,this.bgmId_=0,this.maxBgmVol_=1,this.maxSfxVol_=1,this.maxFadeVol_=0,this.bgms_=new t,this.sfxMap_=new t,this.fadeTimeTaskId_=0}isStopMusic(){return this.bMuteMusic_}isStopSound(){return this.bMuteSound_}init(){Laya.SoundManager.autoReleaseSound=!1,c.addListener(o.kAudioPause,this.pauseMusic.bind(this),!0),c.addListener(o.kAudioResume,this.resumeMusic.bind(this),!0),this._readData()}start(){}setIfMuteMusic(t){let e=this.bMuteMusic_;this.bMuteMusic_=t,t?i.isWeChat?this.pauseMusic():Laya.SoundManager.stopMusic():i.isWeChat?this.resumeMusic():Laya.SoundManager.playMusic(this.bgms_.get(this.curBgmType_),1),e!=t&&this._saveData()}setIfMuteSound(t){let e=this.bMuteSound_;this.bMuteSound_=t,t&&Laya.SoundManager.stopAllSound(),e!=t&&this._saveData()}setBgmVolume(t){this.maxBgmVol_=t,Laya.SoundManager.setMusicVolume(t),t!=this.maxBgmVol_&&this._saveData()}setSfxVolume(t){this.maxSfxVol_=t,Laya.SoundManager.setSoundVolume(t),t!=this.maxSfxVol_&&this._saveData()}_saveData(){let t={bMuteBgm:this.bMuteMusic_,bMuteSfx:this.bMuteSound_,maxBgmVol:this.maxBgmVol_,maxSfxVol:this.maxSfxVol_};_.writeJSON(d.kAudio,t)}_readData(){let t=_.readJSON(d.kAudio);i.isExistObj(t)?(this.bMuteMusic_=t.bMuteBgm,this.bMuteSound_=t.bMuteSfx,this.maxBgmVol_=t.maxBgmVol,this.maxSfxVol_=t.maxSfxVol):this._saveData(),this.setBgmVolume(this.maxBgmVol_),this.setSfxVolume(this.maxSfxVol_)}playMusic(t,e){if(t!==v.kNone&&w[t]){Laya.SoundManager.stopMusic(),this.curBgmType_=t;let a="";this.bgms_.containsKey(t)?a=this.bgms_.get(t):(a=s.nativePath+"audio/"+w[t]+".mp3",this.bgms_.put(t,a));let n=e?1:0,o=null;e&&(o=Laya.Handler.create(this,this._loadBgm,[t,e])),this.bMuteMusic_||(i.isWeChat?(b.playAudio(a,!0),e&&b.addAudioCallback(a,o)):Laya.SoundManager.playMusic(a,n,o))}else i.log("can't find Bgm",t)}_loadBgm(t,e){e&&e(t)}resumeMusic(){if(!this.bMuteMusic_)if(i.isWeChat){let t=this.bgms_.get(this.curBgmType_);t&&b.resumeAudio(t)}else Laya.SoundManager.setMusicVolume(this.maxBgmVol_)}pauseMusic(){if(i.isWeChat){let t=this.bgms_.get(this.curBgmType_);t&&b.pauseAudio(t)}else Laya.SoundManager.setMusicVolume(0)}stopEffects(){Laya.SoundManager.stopAllSound()}stopMusic(){if(i.isWeChat){let t=this.bgms_.get(this.curBgmType_);t&&b.stopAudio(t)}else Laya.SoundManager.stopMusic()}replayMusic(){if(this.curBgmType_&&this.bgms_.containsKey(this.curBgmType_))if(i.isWeChat){let t=this.bgms_.get(this.curBgmType_);t&&b.playAudio(t,!0)}else Laya.SoundManager.stopMusic(),Laya.SoundManager.playMusic(this.bgms_.get(this.curBgmType_),1)}changeBgmWithFade(t,e=1){m.instance.remove(this.fadeTimeTaskId_),this.maxFadeVol_>0&&(this.maxBgmVol_=this.maxFadeVol_),this.maxFadeVol_=this.maxBgmVol_;let s=this.maxBgmVol_,a=e/10,n=this.maxFadeVol_/10*2,o=!1;this.fadeTimeTaskId_=m.instance.add(()=>{this.maxBgmVol_>0&&!o?(this.maxBgmVol_-=n,this.maxBgmVol_<=0&&(this.maxBgmVol_=0,this.playMusic(t),o=!0)):(this.maxBgmVol_+=n,this.maxBgmVol_>=s&&(this.maxBgmVol_=s)),i.log(this.maxBgmVol_),this.setBgmVolume(this.maxBgmVol_)},0,10,a)}playSound(t,e,a=!1){if(t!==M.kNone&&L[t]){let i=null;e&&!a&&(i=Laya.Handler.create(this,this._loadSfx,[t,e]));let n="";this.sfxMap_.containsKey(t)?n=this.sfxMap_.get(t):(n=s.nativePath+"audio/"+L[t]+".mp3",this.sfxMap_.put(t,n));let o=a?0:1;this.bMuteSound_||Laya.SoundManager.playSound(n,o,i)}else i.log("can't find Sfx",t)}_loadSfx(t,e){e&&e(t)}}S.instance=new S;const I={resServer:"https://huandong-1257458597.cos.ap-guangzhou.myqcloud.com/HDSDK/NavList/Pub/",qrResServer:"https://huandong-1257458597.cos.ap-guangzhou.myqcloud.com/HDSDK/NavList/QRCode/",bnrResServer:"https://huandong-1257458597.cos.ap-guangzhou.myqcloud.com/HDSDK/NavList/Banner/",commServer:"https://login.joyfulh.com/comLogin",statServer:"https://statistic.joyfulh.com/statistic",nav:"/jumpData/getJumpData",updImportStat:"/data/updImportStat",updExportStat:"/data/updExportStat"};class C{constructor(){this.url="",this.data=""}}const D=9e5,T=1e4,B=15e3,A=5;class P{constructor(){this.gridCb=null,this.likeCb=null,this.qrCb=null,this.bnrCb=null}}class V{constructor(){this.sn=0,this.path="",this.img="",this.type=0,this.extra=null,this.appId="",this.id="",this.name="",this.alias="",this.qrUrl="",this.bnrUrl="",this.tag=0,this.verCode="",this.box=0}}class R{static get needUpdateNavData(){return this.bUpdateNav_}static get isDataExisted(){return this.bDataExisted_}static get getForceNavIds(){return this.forceIds_}static getForceNavData(t){let e=null;if(this.forceMap_[t]){let i=this.forceMap_[t];if(i){let t=0,s=i.length-1;e=i[Math.round(Math.random()*(s-t))+t]}}return e}static register(t,e,i,s,a){this._readSave(),this.bRegister_=!0;let n=Date.now()-this.loginTime_;this.openID_&&""!==this.openID_&&"null"!=this.openID_&&n<=144e5?(this.init(this.openID_,t,e,i,s,a),console.log("[HDSDK] no need login",n,this.openID_)):this._isWechat?(console.log("[HDSDK] login for SDK"),this._login(t,e,i,s,a)):this.init("",t,e,i,s,a)}static init(t,e,i,s,a,n){if(this.openID_=t||"",this.proName_=e,this.bRegister_||this._readSave(),console.log("[HDSDK] init",this.newUser_,e,this.openID_),Date.now()-this.lastRefreshTime_>D?(this.bDownloaded_=!1,this.loadNativeData(i,s,a,n),this._requstQueue(i,s,a,n)):(this.gridArr_.length>0&&i&&i(this.gridArr_),this.likeArr_.length>0&&s&&s(this.likeArr_),this.qrArr_.length>0&&a&&a(this.qrArr_),this.bnrArr_.length>0&&n&&n(this.bnrArr_)),this._isWechat){let i=wx.getLaunchOptionsSync();if(i.query&&(i.query.hdg&&""!=i.query.hdg||i.query.HDg_nav_0&&""!=i.query.HDg_nav_0)){let s=i.query.HDg_nav_0||i.query.hdg;this._reportImportStat(e,t,s)}}this.bRegister_=!1,this.newUser_=0,""!=this.openID_&&"null"!=this.openID_&&(this._isWechat?(wx.setStorageSync("user",this.openID_),wx.setStorageSync("login",this.loginTime_)):localStorage.setItem("user",this.openID_))}static loadNativeData(t,e,i,s){this.bLoadedNative_||(void 0!==window.Laya?window.Laya.loader.load("data/hd_nav.json",window.Laya.Handler.create(null,()=>{let a=window.Laya.loader.getRes("data/hd_nav.json");a?(this._parseNavData(a,t,e,i,s),window.Laya.loader.clearRes("data/hd_nav.json")):console.log("no native data")}),null,window.Laya.Loader.JSON):void 0!==window.cc&&window.cc.loader.loadRes("data/hd_nav.json",window.cc.JsonAsset,function(a,n){a?console.log("no native data"):(this._parseNavData(n.json,t,e,i,s),window.cc.loader.release(n))}))}static getGridArray(){return this.gridArr_}static getLikeArray(){return this.likeArr_}static getQRCodeArray(){return this.qrArr_}static getBannerArray(){return this.bnrArr_}static navigate(t,e,i){if(this._isWechat){if(this.datMap_[t]){let s=this.datMap_[t];if(3===s.type)wx.previewImage({urls:[s.qrUrl],success:t=>{console.log("[HDSDK] navigate qr")}});else{let t=wx.getSystemInfoSync();if(1==this._compareVersionForWx(t.SDKVersion,"2.2.0")){if(1===s.box&&-1!==t.platform.indexOf("ios"))return void(i&&i());wx.navigateToMiniProgram({appId:s.appId,path:s.path,extraData:s.extra,success:()=>{this._reportExportStat(s),e&&e()},fail:()=>{i&&i()}})}else wx.showModal({title:"版本提示",content:"微信版本较低，暂不支持游戏跳转"})}}}else{let e=this.datMap_[t];console.log("[HDSDK] not wechat platform,navigate data is",e.sn,e.name,e)}}static uploadImportData(t){1===this.newUser_&&this._reportImportStat(this.proName_,this.openID_,t)}static _fetchData(t,e,i,s,a){t&&""!==t&&this._getNavData(t,n=>{if(console.log("[HDSDK] fetch data",n),n&&n.res){1===this.currPage_&&n.res.length>0&&(this.bUpdateNav_=!0,this.bDownloaded_=!0,this.datMap_={},this.forceMap_={},this.forceIds_=[],this.gridArr_=[],this.likeArr_=[],this.qrArr_=[],this.bnrArr_=[],this.reqQue_=[],this.bDataExisted_=!1,console.log("[HDSDK] page one clear flag")),n.res.length>0&&(++this.currPage_,this._fetchData(t,e,i,s,a));let o=n.res;for(let t=0;t<o.length;++t)this._createNavData(o[t]);this.gridArr_.length>0||this.likeArr_.length>0?this.lastRefreshTime_=Date.now():this.lastRefreshTime_=0,0==n.res.length&&this.currPage_>=1&&(e&&e(this.gridArr_),i&&i(this.likeArr_),s&&s(this.qrArr_),a&&a(this.bnrArr_),this.bDataExisted_=!0)}})}static _readSave(){let t=null;if(this._isWechat)try{t=wx.getStorageSync("user");let e=wx.getStorageSync("login");this.loginTime_=Number(e)}catch(e){this.loginTime_=0,t=null}else t=localStorage.getItem("user");t?(this.newUser_=0,console.log("[HDSDK] read dat",t,this.loginTime_),""!=t&&"null"!=t&&(this.openID_=t)):this.newUser_=1}static _getNavData(t,e){let i=I.commServer+I.nav,s={proName:t,page:this.currPage_,limit:20};this._common(i,s,e)}static _parseNavData(t,e,i,s,a){if(!this.bDownloaded_){for(const e in t)t.hasOwnProperty(e)&&this._createNavData(t[e],!0);e&&this.gridArr_.length>0&&e(this.gridArr_),i&&this.likeArr_.length>0&&i(this.likeArr_),s&&this.qrArr_.length>0&&s(this.qrArr_),a&&this.bnrArr_.length>0&&a(this.bnrArr_),this.bLoadedNative_=!0,this.bDataExisted_=!0,console.log("[HDSDK] load native data")}}static _checkUpdate(t){let e=!1,i=t.id+"_"+t.s;if(this.datMap_[i]){let s=this.datMap_[i],a=this._genVerificationCode(t);s.verCode!=a&&(e=!0)}return e}static _createNavData(t,e=!1){let i=new V;if(-1!==t.img.indexOf(".")?i.img=I.resServer+t.img:i.img=I.resServer+t.img+".png",i.sn=t.s,i.type=t.t,i.name=t.n,i.path=t.p,i.alias=t.a,""!==t.e&&(i.extra=JSON.parse(t.e)),i.appId=t.id,i.id=i.appId+"_"+i.sn,e&&(i.verCode=this._genVerificationCode(t)),i.extra){if(i.extra.bnr){let t=i.extra.bnr;-1!==t.indexOf(".")?i.bnrUrl=I.bnrResServer+t:i.bnrUrl=I.bnrResServer+t+".png",this.bnrArr_.push(i)}if(i.extra.tag&&(i.tag=1),i.extra.box&&(i.box=1),i.extra.force)if(this.forceMap_[i.appId]){this.forceMap_[i.appId].push(i)}else this.forceMap_[i.appId]=[],this.forceMap_[i.appId].push(i),this.forceIds_.push(i.appId)}if(1===t.t)this.gridArr_.push(i);else if(2===t.t)this.likeArr_.push(i);else if(3===t.t){if(i.extra&&i.extra.qr){let t=i.extra.qr;-1!==t.indexOf(".")?i.qrUrl=I.qrResServer+t:i.qrUrl=I.qrResServer+t+".png"}this.qrArr_.push(i)}else 4===t.t&&(this.gridArr_.push(i),this.likeArr_.push(i));this.datMap_[i.id]=i}static _genVerificationCode(t){let e="",i=t.s+t.n+t.a,s=t.p,a=s.length+s.charAt(0)+s.charAt(Math.round(s.length/2))+s.charAt(s.length-1),n="";if(""!==t.e){let e=t.e;n=e.length+e.charAt(0)+e.charAt(Math.round(e.length/2))+e.charAt(e.length-1)}return e=i+a+n}static _reportImportStat(t,e,i){if(null!=e&&"null"!=e&&""!=e){let s=I.statServer+I.updImportStat,a={proName:t,openid:e,source:i};this._common(s,a,null),console.log("[HDSDK] import stat",e,i)}else this._login(t),console.error("[HDSDK] _reportImportStat openId不存在，请保证openId的获取")}static _reportExportStat(t){if(null!=this.openID_&&"null"!=this.openID_&&""!=this.openID_){let e=I.statServer+I.updExportStat,i="";""!==t.bnrUrl?i="banner"+t.sn:1==t.type?i="grid"+t.sn:2==t.type?i="like"+t.sn:4==t.type&&(i="all"+t.sn);let s={proName:this.proName_,openid:this.openID_,gameName:t.name,location:i,appid:t.appId,alias:t.alias};this._common(e,s,null),console.log("[HDSDK] export stat",this.openID_,t.appId,t.id,t.name)}else console.error("[HDSDK] _reportExportStat openId不存在，请保证openId的获取")}static _common(t,e,i,s){if(null==e)return void console.error("[HttpRequest] failed");let a=new C;if(a.url=t,"object"==typeof e){for(const t in e)if(e.hasOwnProperty(t)){const i=e[t];if(null==i)continue;if(""!=a.data&&(a.data+="&"),"object"==typeof i){let e=JSON.stringify(i);a.data+=t+"="+encodeURI(e)}else"string"==typeof i||"number"==typeof i||"boolean"==typeof i?a.data+=t+"="+encodeURI(i.toString()):(a.data+=t+"="+encodeURI(i.toString()),console.warn("[HttpRequest] please check your data type,only support object,string,number or boolean"))}}else a.data=encodeURI(e);this._send(a,i,s),a=null}static _send(t,e,i){let s=new XMLHttpRequest;s.onreadystatechange=function(){4==s.readyState&&s.status>=200&&s.status<400?(console.log("[HDSDK] req succ",s.responseText),e&&e(JSON.parse(s.responseText))):(s.status<200||s.status>=400)&&console.log("[HDSDK] conn",s.readyState,s.status)},s.onerror=function(){console.log("[HDSDK] error",s.status),i&&i()};let a=t.url+"?"+t.data;s.open("GET",a,!0),s.send()}static _compareVersionForWx(t,e){let i=t.split("."),s=e.split("."),a=Math.max(i.length,s.length);for(;i.length<a;)i.push("0");for(;s.length<a;)s.push("0");for(let t=0;t<a;t++){let e=parseInt(i[t]),a=parseInt(s[t]);if(e>a)return 1;if(e<a)return-1}return 0}static _requstQueue(t,e,i,s){if(this.reqLimited_<A&&!this.bDownloaded_){let a=new P;a.gridCb=t,a.likeCb=e,a.qrCb=i,a.bnrCb=s,this.reqQue_.push(a),console.log("[HDSDK] _requstQueue",this.reqQue_.length)}++this.reqLimited_,this._requestProc()}static _requestProc(){if(Date.now()-this.lastReqTime_>T){let t=this.reqQue_.shift();t&&(this.lastReqTime_=Date.now(),this.currPage_=1,this._fetchData(this.proName_,t.gridCb,t.likeCb,t.qrCb,t.bnrCb),clearTimeout(this.reqTimerId_),this.reqTimerId_=setTimeout(this._requestProc.bind(this),B),console.log("[HDSDK] _requestProc",this.reqQue_.length))}}static _login(t,e,i,s,a){wx.login({success:n=>{n.code&&wx.request({url:I.commServer+"/user/getSessionKey",data:{code:n.code,proName:t,choose:"1"},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:n=>{if(n.statusCode>=200&&n.statusCode<=400){console.log("[HDSDK] login request succ",n),this.loginTime_=Date.now();let o=JSON.parse(n.data.res);o&&o.openId&&this.init(o.openId,t,e,i,s,a)}else console.log("[HDSDK] login request fail",n),this.init("",t,e,i,s,a)},fail:t=>{console.log("[HDSDK] login request error",t)}})},fail:n=>{console.log("[HDSDK] wx login error",n),this.init("",t,e,i,s,a)},complete:t=>{}})}static get _isWechat(){return"undefined"!=typeof wx}}R.gridArr_=[],R.likeArr_=[],R.qrArr_=[],R.bnrArr_=[],R.forceMap_={},R.forceIds_=[],R.datMap_={},R.openID_="",R.proName_="",R.lastRefreshTime_=0,R.lastReqTime_=0,R.reqQue_=[],R.reqLimited_=0,R.bDownloaded_=!1,R.reqTimerId_=0,R.autoTimerId_=0,R.newUser_=1,R.currPage_=1,R.loginTime_=0,R.dataLen_=0,R.bRegister_=!1,R.bLoadedNative_=!1,R.bUpdateNav_=!1,R.bDataExisted_=!1;class N{constructor(){this.val=0,this.prob=0}}class E{constructor(){this.id=0,this.day=0,this.amountBase=0,this.bAmountCal=!1,this.items=[],this.desc=""}}class F{constructor(){this.idRand=[],this.amountRand=[],this.idBase=0,this.bIdCal=!1,this.amountBase=0,this.bAmoutCal=!1}}class O{constructor(){this.id=0,this.count=0,this.items=[]}}class U{constructor(){this.id=0,this.name="",this.res=""}}class H{static fetch(t){this._parseCategory(t.bonusCategory),this._parseSignInData(t.signInGenRule),this._parseBoxData(t.boxGenRule)}static getSignInDataGroup(t){let e=[];return e=this._getDataGroup(this.signInDatMap_,7,t)}static getBoxDataGroup(t){let e=[];return e=this._getDataGroup(this.boxDataMap_,3,t)}static getSignInBonusID(t){let e=0;if(this.signInDatMap_.containsKey(t)){let s=this.signInDatMap_.get(t);if(s.items.length>0)if(1==s.items.length)e=s.items[0].val;else{let t=0,a=0,n=i.randRange(0,100);for(let i=0;i<s.items.length;++i){if(n<=(a+=s.items[i].prob)&&n>t){e=s.items[i].val;break}t+=s.items[i].prob}}}return e}static getSignInBonusAmount(t,e){let i=0;if(this.signInDatMap_.containsKey(t)){let s=this.signInDatMap_.get(t);i=s.bAmountCal&&e?e(s.amountBase):s.amountBase}return i}static getBoxBonusID(t,e){return this._calBoxBonusVal(t.idRand,t.idBase,t.bIdCal,e)}static getBoxBonusAmount(t,e){return this._calBoxBonusVal(t.amountRand,t.amountBase,t.bAmoutCal,e)}static getBonusCategoryData(t){let e=null;return this.categoryMap_.containsKey(t)&&(e=this.categoryMap_.get(t)),e}static _getDataGroup(t,e,i){let s=[],a=t.size();if(a>0){for(;i*e>a-1;)--i;let n=0;(s=t.values(i*e,e)).length;for(;s.length<e;)s.push(s[n]),++n>=s.length&&(n=0)}return s}static _calBoxBonusVal(t,e,s,a){let n=0;if(0==t.length)n=s&&a?a(e):e;else if(1==t.length)n=t[0].val;else{let e=0,s=0,a=i.randRange(0,100);for(let i=0;i<t.length;++i){if(a<=(s+=t[i].prob)&&a>e){n=t[i].val;break}e+=t[i].prob}}return n}static _parseSignInData(t){if(t)for(const e in t)if(t.hasOwnProperty(e)){const i=t[e];let s=new E;s.id=parseInt(e),s.day=i.day;let a=this._parseFuncGrammar(i.amount);s.amountBase=a.base,s.bAmountCal=a.bCal,s.items=this._parseRandGrammar(i.bid),s.desc=i.desc,H.signInDatMap_.put(s.id,s)}}static _parseBoxData(t){if(t){let e=(t,e,i)=>{let s=new F;if(""!==t)if(this._isFuncGrammar(t)){let e=this._parseFuncGrammar(t);s.idBase=e.base,s.bIdCal=e.bCal}else this._isRandGrammar(t)?s.idRand=this._parseRandGrammar(t):s.idBase=Number(t);if(""!==e)if(this._isFuncGrammar(e)){let t=this._parseFuncGrammar(e);s.amountBase=t.base,s.bAmoutCal=t.bCal}else this._isRandGrammar(e)?s.amountRand=this._parseRandGrammar(e):s.amountBase=Number(e);(s.idBase>0||s.idRand.length>0||s.amountBase>0||s.amountRand.length>0)&&i.push(s)};for(const i in t)if(t.hasOwnProperty(i)){const s=t[i];let a=new O;a.id=parseInt(i),a.count=s.count,e(s.bid1,s.num1,a.items),e(s.bid2,s.num2,a.items),e(s.bid3,s.num3,a.items),H.boxDataMap_.put(a.id,a)}}}static _parseCategory(t){if(t)for(const e in t)if(t.hasOwnProperty(e)){const i=t[e];let s=new U;s.id=parseInt(e),s.name=i.name,s.res=i.res,H.categoryMap_.put(s.id,s)}}static _isFuncGrammar(t){return"string"==typeof t&&-1!=t.indexOf("f")}static _isRandGrammar(t){return"string"==typeof t&&-1!=t.indexOf(",")}static _parseFuncGrammar(t){let e={base:0,bCal:!1};if("string"==typeof t&&-1!=t.indexOf("f")){let i=t.indexOf("("),s=t.indexOf(")");if(-1!=i&&-1!=s){let a=t.substring(i+1,s);e.base=Number(a),e.bCal=!0}else e.base=1,e.bCal=!1}else e.base=Number(t);return e}static _parseRandGrammar(t){let e=[];if("string"==typeof t&&-1!=t.indexOf(",")){let i=0,s=0,a=t.indexOf(","),n=-1!=a?2:0;for(;n>0;){let o=new N,l=-1!=a?t.substring(0,a):t,r=l.indexOf(":");if(-1!=r){let t=l.substring(0,r);if(o.val=Number(t),i<100){let t=l.substring(r+1);if(o.prob=Number(t),(i+=o.prob)>100){let t=i-100;o.prob-=t,o.prob<0&&(o.prob=0)}}else o.prob=0}else o.val=Number(l),o.prob=-1,++s;--n,-1!=a&&-1!=(a=(t=t.substring(a+1)).indexOf(","))&&++n,e.push(o)}if(i<100){let t=100-i;if(s>0){let i=t/s;for(let t=0;t<e.length;++t)-1==e[t].prob&&(e[t].prob=i);e[e.length-1].prob+=1e-7}else e[e.length-1].prob+=t}}else{let i=new N;i.val=Number(t),i.prob=100,e[0]=i}return e}}H.signInDatMap_=new t,H.boxDataMap_=new t,H.categoryMap_=new t;const q=5,K=300,G=3;var j;!function(t){t[t.kCoin=1]="kCoin",t[t.kPiece1=2]="kPiece1",t[t.kPiece2=3]="kPiece2",t[t.kPiece3=4]="kPiece3"}(j||(j={}));class W{constructor(t,e,i=""){this.type=j.kCoin,this.count=0,this.desc="",this.type=t,this.count=e,this.desc=i}}class z{static get signInAwards(){if(0===z.dailyDat.signInBonusMap.size()||z.dailyDat.signInAwardCnt>=7){z.dailyDat.signInBonusMap.clear(),z.dailyDat.signInAwardCnt=0;let t=t=>t*this.prop.lv,e=Math.floor((z.dailyDat.signInTotalCnt+1)/7),i=H.getSignInDataGroup(e);for(let e=0;e<i.length;++e){let s=i[e],a=H.getSignInBonusID(s.id),n=H.getSignInBonusAmount(s.id,t),o=s.desc,l=H.getBonusCategoryData(a);""==o&&(o=l?"可获得"+l.name:"可获得奖励"),z.dailyDat.signInBonusMap.put(s.day,new W(a,n,o))}}return z.dailyDat.signInBonusMap}static genBoxAwards(t,e){if(e){e.clear(),t<1?t=1:t>3&&(t=3);let i=t=>t,s=t=>t*this.prop.lv,a=H.getBoxDataGroup(0);for(let n=0;n<a.length;++n)if(a[n].count===t){for(let t=0;t<a[n].items.length;++t){let o=a[n].items[t],l=H.getBoxBonusID(o,i),r=H.getBoxBonusAmount(o,s);e.put(t+1,new W(l,r))}break}}}static get isVideoLimited(){return 1===z.dailyDat.videoLimited}static get isVideoBonus(){return z.dailyDat.videoBonusTime<=0&&z.dailyDat.videoBonusCnt>0}static get isVideoBonusExisted(){return z.dailyDat.videoBonusCnt>0}static get isSignInAutoPopout(){return z.dailyDat.signAutoPopCnt>0}static get isSignInAwarded(){return 1===z.dailyDat.signInAwarded}static get isSignIn7Days(){return z.dailyDat.signInAwardCnt>=7}static get videoBounsTime(){return z.dailyDat.videoBonusTime}static limitVideo(){z.dailyDat.videoLimited=1}static countSignInPop(t=!1){t?z.dailyDat.signAutoPopCnt=-1:--z.dailyDat.signAutoPopCnt}static calVideoBonusTime(t){z.dailyDat.videoBonusTime-=t}static countVideoBonus(){--z.dailyDat.videoBonusCnt}static resetVideoBonusTime(){z.dailyDat.videoBonusTime=K*(q-z.dailyDat.videoBonusCnt+1)}static setOfflineTimestamp(){z.dailyDat.offlineTimestamp=Date.now()}static calOfflineTime(){if(z.dailyDat.offlineTimestamp>0){let t=Date.now()-z.dailyDat.offlineTimestamp,e=t/1e3;z.calVideoBonusTime(e),z.dailyDat.offlineTimestamp+=t}}static isCoinAfford(t){return z.prop.coin>=t}static saveProp(){_.writeJSON(d.kPlayer,z.prop)}static saveSignIn(){_.writeJSON(d.kDaily,z.dailyDat)}static read(){let t=_.readJSON(d.kPlayer);t?(z.prop.coin=t.coin,z.prop.ownRoles=t.ownRoles,z.prop.itemMap.copy(t.itemMap)):(z.prop.itemMap.put(1,1),z.saveProp());let e=_.readJSON(d.kDaily);if(e){z.dailyDat.signInAwardCnt=e.signInAwardCnt,z.dailyDat.lastSignInDay=e.lastSignInDay,z.dailyDat.signInTotalCnt=e.signInTotalCnt;let t=new Date;t.getDate()==z.dailyDat.lastSignInDay?(z.dailyDat.videoLimited=e.videoLimited,z.dailyDat.signAutoPopCnt=e.signAutoPopCnt,z.dailyDat.videoBonusCnt=e.videoBonusCnt,z.dailyDat.videoBonusTime=e.videoBonusTime,z.dailyDat.signInAwarded=e.signInAwarded):(z.dailyDat.videoLimited=0,z.dailyDat.signAutoPopCnt=G,z.dailyDat.videoBonusCnt=q,z.dailyDat.videoBonusTime=K,z.dailyDat.signInAwarded=0,z.dailyDat.lastSignInDay=t.getDate()),z.dailyDat.offlineTimestamp=e.lastTimestamp,z.calOfflineTime(),z.dailyDat.signInAwardCnt>=7?(z.dailyDat.signInBonusMap.clear(),z.dailyDat.signInAwardCnt=0):z.dailyDat.signInBonusMap.copy(e.signInBonusMap),z.saveSignIn()}else{z.dailyDat.lastSignInDay=0,z.dailyDat.signInAwardCnt=0,z.dailyDat.signInAwarded=0,z.dailyDat.signInTotalCnt=0,z.dailyDat.videoLimited=0,z.dailyDat.signAutoPopCnt=G,z.dailyDat.videoBonusCnt=q,z.dailyDat.videoBonusTime=K;let t=new Date;z.dailyDat.lastSignInDay=t.getDate(),z.saveSignIn()}}}z.prop=new class{constructor(){this.lv=1,this.coin=0,this.ownRoles=[1],this.itemMap=new t}},z.dailyDat=new class{constructor(){this.signInBonusMap=new t,this.lastSignInDay=0,this.signInAwarded=0,this.signInAwardCnt=0,this.signInTotalCnt=0,this.videoLimited=0,this.signAutoPopCnt=2,this.videoBonusCnt=5,this.videoBonusTime=3600,this.offlineTimestamp=0}};class J{static get getMessage(){return this.message.sh[i.randRange(0,this.message.sh.length-1)]}static loadBackendConfig(){}static loadJson(){i.readJson("data/testDat",t=>{H.fetch(t),this.bJsonLoaded=!0})}}J.version="1.0.0",J.config={export:1,forceNavProb:50,forceFakePageProb:0,fakeBtnClick:0,directAward:0},J.message={sh:[{title:"分享标题，请自行修改",img:""}]},J.bJsonLoaded=!1;const X=!1;class Q{constructor(){this.gameEvtMgr_=null,this.timedTaskMgr_=null,this.fpsSum_=0,this.frames_=0,this.bRecDt_=!1,this.bLogined=!1}init(){if(Laya.stage.frameRate=60===y.framerate?Laya.Stage.FRAME_FAST:Laya.Stage.FRAME_SLOW,null==this.gameEvtMgr_&&(this.gameEvtMgr_=h.instance),this.gameEvtMgr_.init(),null==this.timedTaskMgr_&&(this.timedTaskMgr_=m.instance),this.timedTaskMgr_.clear(),S.instance.init(),1==y.debug&&n.clearAllStorage(),this.loadData(),i.isWeChat){let t=this._loginSucc.bind(this),e=this._loginFail.bind(this),i=this._loginError.bind(this);y.openId&&""!=y.openId&&"null"!=y.openId&&0===y.payment?this._loginSucc(null):b.login(t,e,i,!0);let s=function(){let t=J.getMessage;return{title:t.title,imageUrl:t.img,query:""}}.bind(this);b.showForward(s),wx.onAudioInterruptionEnd(()=>{S.instance.stopEffects(),S.instance.resumeMusic()})}else this.bLogined=!0,R.init(y.openId,y.proName);this._onShow(),this._onHide()}start(){}log(){}loadData(){this.readData(),b.readData(),z.read()}saveData(){n.writeJSON(a.kGameData,{})}readData(){let t=n.readJSON(a.kGameData);i.isExistObj(t)}get eventManager(){return this.gameEvtMgr_}changeScene(t,e){h.instance.clear(),m.instance.clear(),s.instance.loadScene(t,()=>{e&&e(),Laya.Resource.destroyUnusedResources()}),i.isWeChat&&wx.triggerGC()}clear(){h.instance.clear(),m.instance.clear(),Laya.Resource.destroyUnusedResources(),i.isWeChat&&wx.triggerGC()}recordFPS(t){t&&(this.fpsSum_=0,this.frames_=0),this.bRecDt_=t}get averageFPS(){let t=0;return this.frames_>0&&(t=Math.floor(this.fpsSum_/this.frames_)),t}update(){let t=Laya.timer.delta/1e3;if(this.gameEvtMgr_&&this.gameEvtMgr_.excuteEvents(),this.timedTaskMgr_&&this.timedTaskMgr_.excuteTasks(t),this.bRecDt_){if(t>0){let e=1/t;e>60&&(e=60),this.fpsSum_+=e}++this.frames_}}_loginSucc(t){t?(y.openId=t.openId,y.sessionKey=t.sessionKey,console.log("login succ cb",t)):console.log("no login succ cb"),y.openId&&""!=y.openId&&"null"!=y.openId&&0===y.payment&&b.saveData(),R.init(y.openId,y.proName),b.launchQueryCheck(X),this.bLogined=!0}_loginFail(t){y.sessionKey="",this.bLogined=!0,console.log("login fail cb",t)}_loginError(t){this.bLogined=!0}_onShow(){i.isWeChat&&wx.onShow(t=>{S.instance.stopEffects(),S.instance.resumeMusic(),i.log("onShow");(function(t){i.log("on show invite cb",t)}).bind(this);b.onShowQueryCheck(t.query,X),Laya.stage.renderingEnabled=!0,Laya.timer.resume(),z.calOfflineTime()})}_onHide(){i.isWeChat&&wx.onHide(t=>{Laya.stage.renderingEnabled=!1,Laya.timer.pause(),S.instance.pauseMusic(),S.instance.stopEffects(),z.setOfflineTimestamp(),z.saveSignIn()})}}var Z,Y,$;Q.instance=new Q,function(t){t[t.kDefault=0]="kDefault",t[t.kSetting=994]="kSetting",t[t.kDialog=995]="kDialog",t[t.kCoin=996]="kCoin",t[t.kBlocker=997]="kBlocker",t[t.kTrans=998]="kTrans",t[t.kExportCom=999]="kExportCom",t[t.kExportPage=1e3]="kExportPage",t[t.kTip=1001]="kTip",t[t.kTestBnr=1002]="kTestBnr"}(Z||(Z={}));class et{constructor(){this.com_=null,this.id_=0,this.bLock_=!1}init(t){}add(t){this.com_&&(t.addChild(this.com_),this.com_.visible=!1)}reset(){}remove(){this.com_&&this.com_.removeFromParent()}}et.root=null;class it extends et{constructor(){super(...arguments),this.lbl_=null,this.showTrans_=null}init(t){t&&(this.com_=t,t.setSize(Laya.stage.width,Laya.stage.height),this.lbl_=t.getChild("tipLbl").asTextField,this.showTrans_=t.getTransition("showTrans"),t.sortingOrder=Z.kTip,t.visible=!1,et.root.addChild(t))}show(t){this.com_&&(this.com_.visible=!0,this.lbl_.text=t,this.showTrans_.stop(),this.showTrans_.play(i.layaHandler(this,()=>{this.com_.visible=!1})))}}it.instance=new it,function(t){t[t.kLow=1]="kLow",t[t.kMid=2]="kMid",t[t.kHigh=3]="kHigh"}(Y||(Y={})),function(t){t[t.kBgm=0]="kBgm",t[t.kSfx=1]="kSfx",t[t.kHighFx=2]="kHighFx",t[t.kMidFx=3]="kMidFx",t[t.kLowFx=4]="kLowFx"}($||($={}));class st extends et{constructor(){super(...arguments),this.bgmToggle_=null,this.sfxToggle_=null,this.highFxRadio_=null,this.midFxRadio_=null,this.lowFxRadio_=null,this.backBtn_=null,this.homeBtn_=null,this.openTrans_=null,this.closeTrans_=null,this.closeCb_=null,this.vfxLv_=Y.kMid,this.bVfx_=!1,this.bGame_=!1}get VFXLvl(){return this.vfxLv_}set VFXLvl(t){this.vfxLv_=t,this._save()}init(t){t&&(this.com_=t,t.setSize(Laya.stage.width,Laya.stage.height),this.bgmToggle_=t.getChild("bgmToggle").asButton,this.sfxToggle_=t.getChild("sfxToggle").asButton,this.highFxRadio_=t.getChild("fxHighRadio").asButton,this.midFxRadio_=t.getChild("fxMidRadio").asButton,this.lowFxRadio_=t.getChild("fxLowRadio").asButton,this.backBtn_=t.getChild("backBtn").asButton,this.homeBtn_=t.getChild("homeBtn").asButton,this.openTrans_=t.getTransition("openTrans"),this.closeTrans_=t.getTransition("closeTrans"),this.bgmToggle_.selected=!S.instance.isStopMusic(),this.sfxToggle_.selected=!S.instance.isStopSound(),fgui.GRoot.inst.volumeScale=this.sfxToggle_.selected?1:0,this._read(),this.bgmToggle_.on(fgui.Events.STATE_CHANGED,this,this._onToggleChange,[$.kBgm]),this.sfxToggle_.on(fgui.Events.STATE_CHANGED,this,this._onToggleChange,[$.kSfx]),this.highFxRadio_.on(fgui.Events.STATE_CHANGED,this,this._onToggleChange,[$.kHighFx]),this.midFxRadio_.on(fgui.Events.STATE_CHANGED,this,this._onToggleChange,[$.kMidFx]),this.lowFxRadio_.on(fgui.Events.STATE_CHANGED,this,this._onToggleChange,[$.kLowFx]),this.backBtn_.onClick(this,this._onClose),this.homeBtn_.onClick(this,this._onHome),t.sortingOrder=Z.kSetting,t.visible=!1,et.root.addChild(t))}show(t,e,s=!1){if(this.com_){this.com_.visible=!0,this.bVfx_=!1,this.homeBtn_.visible=s,this.bLock_=!0,this.openTrans_.play(i.layaHandler(this,()=>{this.bLock_=!1,t&&t()}));let a=this.com_.getController("FxRadioGroup");3===this.vfxLv_?a.selectedIndex=0:2===this.vfxLv_?a.selectedIndex=1:1===this.vfxLv_&&(a.selectedIndex=2),this.bGame_=s,this.closeCb_=e}}_onToggleChange(t){if(!this.bLock_)switch(t){case $.kBgm:S.instance.setIfMuteMusic(!this.bgmToggle_.selected);break;case $.kSfx:S.instance.setIfMuteSound(!this.sfxToggle_.selected),fgui.GRoot.inst.volumeScale=this.sfxToggle_.selected?1:0;break;case $.kHighFx:this.vfxLv_=Y.kHigh,this.bVfx_=!0;break;case $.kMidFx:this.vfxLv_=Y.kMid,this.bVfx_=!0;break;case $.kLowFx:this.vfxLv_=Y.kLow,this.bVfx_=!0}}_onClose(){this.bLock_||this.com_&&(this._save(),this.closeCb_&&this.closeCb_(),h.instance.addEvent(o.kAdjustVfxLv,null,{lv:this.vfxLv_}),this.bGame_?(this.bVfx_&&it.instance.show("游戏中仅部分特效设置生效"),this.com_.visible=!1):this.closeTrans_.play(i.layaHandler(this,()=>{this.com_.visible=!1})))}_onHome(){this.bLock_||this._onClose()}_save(){let t={effLv:this.vfxLv_};_.writeJSON(d.kSetting,t)}_read(){let t=_.readJSON(d.kSetting);this.vfxLv_=t?t.effLv:Y.kMid}}st.instance=new st;class at extends et{constructor(){super(...arguments),this.lbl_=null}init(t){t&&(this.com_=t,this.lbl_=t.getChild("txtLbl").asTextField)}show(t){this.com_&&(this.lbl_.text=t,this.com_.setSize(this.lbl_.actualWidth+20,this.lbl_.actualHeight+20),fgui.GRoot.inst.showPopup(this.com_))}}at.instance=new at;class nt extends et{constructor(){super(...arguments),this.bg_=null,this.rotTrans_=null,this.taskId_=0}init(t){t&&(this.com_=t,t.setSize(Laya.stage.width,Laya.stage.height),this.bg_=t.getChild("bg").asImage,this.rotTrans_=t.getTransition("rot"),t.sortingOrder=Z.kBlocker,t.visible=!1,et.root.addChild(t))}block(t=3,e=!1){this.com_&&(this.com_.visible=!0,this.bg_&&(this.bg_.visible=e),this.rotTrans_.play(null,-1),this.taskId_>0&&(m.instance.remove(this.taskId_),this.taskId_=0),this.taskId_=m.instance.add(()=>{this.hide()},t))}hide(){this.com_&&(this.taskId_>0&&(m.instance.remove(this.taskId_),this.taskId_=0),this.rotTrans_.stop(),this.com_.visible=!1,this.taskId_=0)}}nt.instance=new nt;class ot{static watchOrShare(t,e,i,s){if(this.succCallback_=e,this.failCallback_=s,z.isVideoLimited)it.instance.show("今日视频已达上限");else{let e=()=>{nt.instance.hide(),this.succCallback_&&(this.succCallback_(i),this.succCallback_=null)},s=()=>{nt.instance.hide(),this.failCallback_&&(this.failCallback_(),this.failCallback_=null),it.instance.show("请观看完整视频获取奖励")},a=()=>{it.instance.show("今日视频已达上限"),nt.instance.hide(),this.failCallback_&&(this.failCallback_(),this.failCallback_=null),z.limitVideo()};nt.instance.block(10),b.watchVideoAds(t,e,s,a)}}}ot.kSignIn="adunit-173c5e5d35b44266",ot.kBox="adunit-d1fdb8baaf15e4cd",ot.kResult="adunit-9eda1e1302d3932b",ot.kTry="adunit-090b55dfa38539f5",ot.kRevive="adunit-3e1ae1a358f740cf",ot.succCallback_=null,ot.failCallback_=null;class lt{constructor(){this.self=null,this.dayLbl=null,this.iconLoader=null,this.cntLbl=null,this.maskGrp=null}}const rt=7;class ht extends et{constructor(){super(...arguments),this.awardBtn_=null,this.closeBtn_=null,this.awardCtrl_=null,this.boxCom_=null,this.items_=[],this.showTrans_=null,this.closeTrans_=null,this.bInited_=!1,this.bAwarded_=!1}init(t){if(t){this.com_=t,this.awardBtn_=t.getChild("awardBtn").asButton,this.closeBtn_=t.getChild("closeBtn").asButton,this.awardCtrl_=this.awardBtn_.getController("sh"),this.showTrans_=t.getTransition("showTrans"),this.closeTrans_=t.getTransition("closeTrans");for(let e=0;e<rt;++e){let i=new lt,s=t.getChild("item"+(e+1)).asButton;s&&(i.self=s,i.dayLbl=s.getChild("dayLbl").asTextField,i.iconLoader=s.getChild("iconLoader").asLoader,i.cntLbl=s.getChild("cntLbl").asTextField,i.maskGrp=s.getChild("maskGrp").asGroup,this.items_.push(i))}this.com_.visible=!1}}show(){this.com_&&(this.com_.visible=!0,z.isSignInAwarded?(this.awardBtn_.grayed=!0,this.bAwarded_=!0):(this.awardBtn_.grayed=!1,this.bAwarded_=!1),this.awardCtrl_&&(this.awardCtrl_.selectedIndex=z.isVideoLimited?1:0),this.bInited_&&!z.isSignIn7Days||(z.signInAwards.each((t,e,i)=>{let s=this.items_[t];if(s){s.dayLbl.text=(t+1).toString();let e=i.type;e===j.kCoin?s.iconLoader.url="ui://CommUI/coin":e>=j.kPiece1&&e<=j.kPiece3&&(s.iconLoader.url="ui://CommUI/piece"+(e-j.kPiece1+1)),s.cntLbl.text="x"+i.count,s.maskGrp.visible=t<z.dailyDat.signInAwardCnt,s.self.onClick(this,this._onItemClick,[t])}}),this.bInited_=!0),this.awardBtn_.onClick(this,this._onAward),this.closeBtn_.onClick(this,this._onClose),this.bLock_=!0,this.showTrans_.stop(),this.showTrans_.play(i.layaHandler(this,()=>{this.bLock_=!1})))}reset(){this.com_.visible=!1,this.bLock_=!1,this.awardBtn_.offClick(this,this._onAward),this.closeBtn_.offClick(this,this._onClose)}_onItemClick(t){if(this.items_[t]){let e=z.signInAwards.getByIndex(t);at.instance.show(e.desc)}}_onAward(){this.bLock_||(this.bAwarded_?this._onClose():i.isWeChat?(ot.watchOrShare(ot.kSignIn,this._getAward.bind(this)),this.awardCtrl_&&(this.awardCtrl_.selectedIndex=z.isVideoLimited?1:0)):this._getAward())}_onClose(){this.bLock_||(h.instance.addEvent(o.kRedPoint,null,{type:1}),z.saveProp(),z.saveSignIn(),this.bLock_=!0,this.closeTrans_.play(i.layaHandler(this,()=>{this.reset()})))}_getAward(){this.bAwarded_=!0,this.awardBtn_.grayed=!0,S.instance.playSound(M.kGoodClick);let t=z.signInAwards.getByIndex(z.dailyDat.signInAwardCnt),e=t.type;e===j.kCoin?it.instance.show("获得金币×"+t.count+"！"):e>=j.kPiece1&&e<=j.kPiece3&&it.instance.show("获得碎片"+(e-j.kPiece1+1)+"×"+t.count),this.items_[z.dailyDat.signInAwardCnt].maskGrp.visible=!0,z.dailyDat.signInAwarded=1,++z.dailyDat.signInTotalCnt,++z.dailyDat.signInAwardCnt,z.saveSignIn(),z.saveProp()}_boxOpened(){it.instance.show("获得宝箱奖励！"),z.saveProp()}}const ct=["小心不要碰到礁石","加速滑板能让你变得更快","尽量避开障碍","不要在背后撞到对手","空中调整方向很困难","冲刺状态下撞到障碍不会减速","复活后能够无敌一小段时间"];class dt extends et{constructor(){super(...arguments),this.lbl_=null,this.loader_=null,this.showTrans_=null,this.closeTrans_=null,this.rotTrans_=null,this.callbackOver_=null,this.taskId_=0,this.bTrans_=!1}init(t){t&&(this.com_=t,t.setSize(Laya.stage.width,Laya.stage.height),this.lbl_=t.getChild("txtLbl").asTextField,this.loader_=t.getChild("imgLoader").asLoader,this.showTrans_=t.getTransition("showTrans"),this.closeTrans_=t.getTransition("closeTrans"),this.rotTrans_=t.getTransition("rotTrans"),t.sortingOrder=Z.kTrans,t.visible=!1,et.root.addChild(t))}show(t,e=!1){this.com_&&(this.com_.visible=!0,S.instance.stopMusic(),this.callbackOver_=t,e?(this.loader_.visible=!1,this.lbl_.visible=!1):(this.loader_.visible=!0,this.lbl_.visible=!0,this.lbl_.text=ct[i.randRange(0,ct.length-1)],this.taskId_>0&&(m.instance.remove(this.taskId_),this.taskId_=0)),this.showTrans_.play(i.layaHandler(this,this._showOver)),this.rotTrans_.play(null,-1),this.bTrans_=!0)}over(t=0,e=null){this.bTrans_?t>0?this.taskId_=m.instance.add(()=>{e&&e(),this._close()},t):(e&&e(),this._close()):e&&e()}reset(){this.com_&&(this.rotTrans_.stop(),this.com_.visible=!1,this.bTrans_=!1)}_showOver(){this.callbackOver_&&(this.callbackOver_(),this.callbackOver_=null)}_close(){this.closeTrans_.play(i.layaHandler(this,this.reset))}}dt.instance=new dt;class _t{constructor(){this.vertices_=[],this.color_=Laya.Color.GREEN,this.pls_=null}show(t){this.pls_&&null==this.pls_.parent&&t.addChild(this.pls_)}hide(){this.pls_&&this.pls_.removeSelf()}destroy(){this.pls_&&this.pls_.destroy(!0)}}class ut extends _t{constructor(t,e,i,s=null){super(),this.color_=s||Laya.Color.GREEN,this.pls_=new Laya.PixelLineSprite3D(12,i+"_lwf"),this.pls_.addLine(t,e,this.color_,this.color_)}update(t,e,i=null){i&&(this.color_=i),this.pls_.setLine(0,t,e,this.color_,this.color_)}}class gt extends _t{constructor(t,e,i=null,s=0){super(),this.indices_=[],this.r_=null,this.color_=i||Laya.Color.GREEN;let a=new Laya.Vector3(t.x,s,t.y),n=new Laya.Vector3(t.right,s,t.y),o=new Laya.Vector3(t.right,s,t.bottom),l=new Laya.Vector3(t.x,s,t.bottom);this.r_=t,this.vertices_.push(a),this.vertices_.push(n),this.vertices_.push(o),this.vertices_.push(l),this.indices_=[0,1,0,3,1,2,2,3],this.pls_=new Laya.PixelLineSprite3D(12,e+"_rxzwf");for(let t=0;t<this.indices_.length;t+=2){let e=this.indices_[t]?this.vertices_[this.indices_[t]]:this.vertices_[0],i=this.indices_[t+1]?this.vertices_[this.indices_[t+1]]:this.vertices_[0];this.pls_.addLine(e,i,this.color_,this.color_)}}update(t=null,e=0){if(this.pls_){t&&(this.color_=t);let i=this.r_;this.vertices_[0].setValue(i.x,e,i.y),this.vertices_[1].setValue(i.right,e,i.y),this.vertices_[2].setValue(i.right,e,i.bottom),this.vertices_[3].setValue(i.x,e,i.bottom);let s=0;for(let t=0;t<this.indices_.length;t+=2){let e=this.indices_[t]?this.vertices_[this.indices_[t]]:this.vertices_[0],i=this.indices_[t+1]?this.vertices_[this.indices_[t+1]]:this.vertices_[0];this.pls_.setLine(s++,e,i,this.color_,this.color_)}}}}class pt extends _t{constructor(t,e,i=null){super(),this.indices_=[],this.bb_=null,this.color_=i||Laya.Color.GREEN;let s=t,a=s.getMin(),n=new Laya.Vector3(s.getMin().x,s.getMax().y,s.getMin().z),o=new Laya.Vector3(s.getMin().x,s.getMin().y,s.getMax().z),l=new Laya.Vector3(s.getMax().x,s.getMin().y,s.getMin().z),r=new Laya.Vector3(s.getMin().x,s.getMax().y,s.getMax().z),h=new Laya.Vector3(s.getMax().x,s.getMax().y,s.getMin().z),c=new Laya.Vector3(s.getMax().x,s.getMin().y,s.getMax().z),d=s.getMax();this.bb_=s,this.vertices_.push(a),this.vertices_.push(n),this.vertices_.push(o),this.vertices_.push(l),this.vertices_.push(r),this.vertices_.push(h),this.vertices_.push(c),this.vertices_.push(d),this.indices_=[0,1,0,2,0,3,1,4,1,5,7,4,7,5,7,6,6,2,6,3,2,4,3,5],this.pls_=new Laya.PixelLineSprite3D(12,e+"_bwf");for(let t=0;t<this.indices_.length;t+=2){let e=this.indices_[t]?this.vertices_[this.indices_[t]]:this.vertices_[0],i=this.indices_[t+1]?this.vertices_[this.indices_[t+1]]:this.vertices_[0];this.pls_.addLine(e,i,this.color_,this.color_)}}update(t=null){if(this.pls_){t&&(this.color_=t);let e=this.bb_;this.vertices_[0]=e.getMin(),this.vertices_[1].setValue(e.getMin().x,e.getMax().y,e.getMin().z),this.vertices_[2].setValue(e.getMin().x,e.getMin().y,e.getMax().z),this.vertices_[3].setValue(e.getMax().x,e.getMin().y,e.getMin().z),this.vertices_[4].setValue(e.getMin().x,e.getMax().y,e.getMax().z),this.vertices_[5].setValue(e.getMax().x,e.getMax().y,e.getMin().z),this.vertices_[6].setValue(e.getMax().x,e.getMin().y,e.getMax().z),this.vertices_[7]=e.getMax();let i=0;for(let t=0;t<this.indices_.length;t+=2){let e=this.indices_[t]?this.vertices_[this.indices_[t]]:this.vertices_[0],s=this.indices_[t+1]?this.vertices_[this.indices_[t+1]]:this.vertices_[0];this.pls_.setLine(i++,e,s,this.color_,this.color_)}}}}class mt{static drawBoxWireframe(t,e,i,s=null){let a=null;this.wireframeMap_.containsKey(e)?(a=this.wireframeMap_.get(e)).update(s):(a=new pt(t,e,s),this.wireframeMap_.put(e,a)),a&&a.show(i)}static drawLineWireframe(t,e,i,s=null,a=null){let n=null;this.wireframeMap_.containsKey(i)?(n=this.wireframeMap_.get(i)).update(t,e,a):(n=new ut(t,e,i,a),this.wireframeMap_.put(i,n)),n&&n.show(s)}static drawRectXZWireframe(t,e,i=null,s=null,a=0){let n=null;this.wireframeMap_.containsKey(e)?(n=this.wireframeMap_.get(e)).update(s):(n=new gt(t,e,s,a),this.wireframeMap_.put(e,n)),n&&n.show(i)}static hideWireframe(t){if(this.wireframeMap_.containsKey(t)){this.wireframeMap_.get(t).hide()}}static removeWireframe(t){if(this.wireframeMap_.containsKey(t)){this.wireframeMap_.get(t).destroy(),this.wireframeMap_.remove(t)}}static drawCylinderXZ(t,e,i,s,a=0,n=32){let o=null;this.primitiveBoundMap_.containsKey(t)?(o=this.primitiveBoundMap_.get(t)).transform.localPositionY=a:((o=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCylinder(e,i,n))).transform.localPositionY=a,this.primitiveBoundMap_.put(t,o)),o&&!o.parent&&s.addChild(o)}static hidePrimitive(t){if(this.primitiveBoundMap_.containsKey(t)){this.primitiveBoundMap_.get(t).removeSelf()}}static removePrimitive(t){if(this.primitiveBoundMap_.containsKey(t)){this.primitiveBoundMap_.get(t).destroy(!0),this.primitiveBoundMap_.remove(t)}}}mt.wireframeMap_=new t,mt.primitiveBoundMap_=new t;class ft{static clamp(t,e,i){return Math.max(Math.min(t,i),e)}}class yt{constructor(t,e,i){this.point=null,this.vertex1=null,this.vertex2=null,this.point=t.copy(t),this.vertex1=e.copy(e),this.vertex2=i.copy(i)}}class bt{constructor(t,e,i){this.x=0,this.y=0,this.radius=0,this.tag="",this.x=t,this.y=e,this.radius=i}}class kt{static getBoundingBox(t,e=1,i=1,s=1){if(1===e&&1===i&&1===s)return t.meshRenderer.bounds;{let a=t.meshRenderer.bounds,n=a.getCenter(),o=a.getExtent();o.x*=e,o.y*=i,o.z*=s;let l=new Laya.Bounds(new Laya.Vector3,new Laya.Vector3);return l.setCenter(n),l.setExtent(o),l}}static convertBound2RectXZ(t,e=1,i=1){let s=this.getBoundingBox(t,e,1,i),a=new Laya.Rectangle;return a.x=s.getMin().x,a.y=s.getMin().z,a.width=Math.abs(s.getMax().x-a.x),a.height=Math.abs(s.getMax().z-a.y),a}static convertBound2CircleXZ(t,e=1){let i=this.getBoundingBox(t,e,1,e),s=i.getCenter(),a=i.getMax().x-i.getMin().x,n=i.getMax().z-i.getMin().z,o=Math.sqrt(n*n+a*a)/2;return new bt(s.x,s.z,o)}static getRectXZVertices(t,e){e[0].x=t.x,e[0].y=t.y,e[1].x=t.right,e[1].y=t.y,e[2].x=t.right,e[2].y=t.bottom,e[3].x=t.x,e[3].y=t.bottom}static isParallelVec2D(t,e){let s=new Laya.Vector2;Laya.Vector2.normalize(t,s);let a=new Laya.Vector2;Laya.Vector2.normalize(e,a);let n=Laya.Vector2.dot(s,a);return!!i.isEqualF(Math.abs(n),1)}static isParallelVec3D(t,e){let s=new Laya.Vector3;Laya.Vector3.normalize(t,s);let a=new Laya.Vector3;Laya.Vector3.normalize(e,a);let n=Laya.Vector3.dot(s,a);return!!i.isEqualF(Math.abs(n),1)}static isPointOnSegment2D(t,e,s){let a=(s.x-t.x)*(e.y-t.y),n=(e.x-t.x)*(s.y-t.y);return i.isEqualF(a,n)&&Math.min(t.x,e.x)<=s.x&&Math.max(t.x,t.x)>=s.x&&Math.min(t.y,e.y)<=s.y&&Math.max(t.y,e.y)>=s.y}static intersectSeg2Seg2D(t,e,i,s){let a=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x),n=(t.x-s.x)*(e.y-s.y)-(t.y-s.y)*(e.x-s.x);if(a*n>=0)return null;let o=(i.x-t.x)*(s.y-t.y)-(i.y-t.y)*(s.x-t.x);if(o*(o+a-n)>=0)return null;let l=o/(n-a),r=l*(e.x-t.x),h=l*(e.y-t.y);return new Laya.Point(t.x+r,t.y+h)}static intersectSeg2Rect2D(t,e,i){let s=[];this.getRectXZVertices(i,this.pnts_);for(let i=0;i<this.indices_.length;i+=2){let a=this.indices_[i]?this.pnts_[this.indices_[i]]:this.pnts_[0],n=this.indices_[i+1]?this.pnts_[this.indices_[i+1]]:this.pnts_[0],o=this.intersectSeg2Seg2D(t,e,a,n);if(o){let t=new yt(o,a,n);s.push(t)}}return s}static intersectLine2Circle2D(t,e,i,s=!1){let a=[],n=e.x-t.x,o=e.y-t.y,l=t.x-i.x,r=t.y-i.y,h=n*n+o*o,c=2*(n*l+o*r),d=c*c-4*h*(l*l+r*r-i.radius*i.radius);if(h<=1e-7||d<0);else if(0===d){let e=-c/(2*h);s?e>=0&&e<=1&&(a[0]=new Laya.Point(t.x+e*n,t.y+e*o)):a[0]=new Laya.Point(t.x+e*n,t.y+e*o)}else{let e=(-c+Math.sqrt(d))/(2*h),i=(-c-Math.sqrt(d))/(2*h);s?e<0&&i<0||e>1&&i>1||e<0&&i>1||e>1&&i<0||(e>=0&&e<=1&&(i<0||i>1)?a[0]=new Laya.Point(t.x+e*n,t.y+e*o):i>=0&&i<=1&&(e<0||e>1)?a[0]=new Laya.Point(t.x+i*n,t.y+i*o):e>=0&&e<=1&&i>=0&&i<=1&&(a[0]=new Laya.Point(t.x+e*n,t.y+e*o),a[1]=new Laya.Point(t.x+i*n,t.y+i*o))):(a[0]=new Laya.Point(t.x+e*n,t.y+e*o),a[1]=new Laya.Point(t.x+i*n,t.y+i*o))}return a}static intersectSeg2Circle2D(t,e,i){return this.intersectLine2Circle2D(t,e,i,!0)}}kt.pnts_=[new Laya.Point,new Laya.Point,new Laya.Point,new Laya.Point],kt.indices_=[0,1,0,3,1,2,2,3];class xt extends Laya.Script3D{constructor(){super(...arguments),this.cam_=null,this.touchPos_=new Laya.Vector2,this.ray_=new Laya.Ray(new Laya.Vector3,new Laya.Vector3),this.tree_=null,this.treeSclTimer_=0,this.rocks_=[],this.float_=null,this.stick1_=null,this.stick2_=null,this.circles_=[],this.sea_=null,this.horVecN_=new Laya.Vector3(1,0,0),this.verVecN_=new Laya.Vector3(0,0,1),this.reflectLine_=new Laya.Vector3,this.bHome_=!1,this.bTouched_=!1}init(){let t=this.owner;t.enableFog=!0,t.fogColor=new Laya.Vector3(.9,1,1),t.fogStart=6,t.fogRange=12;let e=this.owner.getChildByName("Main Camera");e&&(e.clearFlag=Laya.BaseCamera.CLEARFLAG_SKY,s.instance.loadMaterial(s.nativePath+"3d/Sky/skyBox.lmat",e=>{let i=t.skyRenderer;i.mesh=Laya.SkyBox.instance,i.material=e}),this.cam_=e,e.enableHDR=!1);let i=t.getChildByName("homeNode");if(i){let e=i.getChildByName("tree");e&&(e.transform.scale=new Laya.Vector3(.5,.5,.5),mt.drawBoxWireframe(e.meshRenderer.bounds,e.name,t,Laya.Color.RED),this.tree_=e);let s=i.getChildByName("unbrella");if(s){let e=kt.getBoundingBox(s,.8,1,.8);mt.drawBoxWireframe(e,s.name,t)}let a=i.getChildByName("stick");this.stick1_=Laya.MeshSprite3D.instantiate(a),this.stick2_=Laya.MeshSprite3D.instantiate(a),t.addChild(this.stick1_),t.addChild(this.stick2_);for(let t=0;t<8;++t)this.rocks_[t]=i.getChildByName("rock"+(t+1));this.float_=i.getChildByName("blue_float")}let a=t.getChildByName("beach");a&&(this.sea_=a.getChildByName("sea")),Laya.stage.addChild(this.owner),Laya.stage.setChildIndex(this.owner,0)}enterHome(){this.bHome_=!0,Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this._onTouchBegin),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this._onTouchMove),Laya.stage.on(Laya.Event.MOUSE_UP,this,this._onTouchEnd),S.instance.playMusic(v.kBgmMenu)}enterGame(){if(this.bHome_=!1,this.cam_){this.cam_.transform.localRotationEulerX=-90,this.cam_.transform.localPositionY=3,this.cam_.transform.localPositionX=-.5;for(let t=0;t<this.rocks_.length;++t){let e=kt.convertBound2RectXZ(this.rocks_[t]);mt.drawRectXZWireframe(e,this.rocks_[t].name,this.owner,Laya.Color.MAGENTA),this.circles_[t]=kt.convertBound2CircleXZ(this.rocks_[t],1),this.circles_[t].tag=this.rocks_[t].name+"_c"}}}leaveHome(){}leaveGame(){}onUpdate(){if(this.bHome_){let t=Laya.timer.delta/1e3;if(this.tree_){this.treeSclTimer_+=t;let e=ft.clamp(1+Math.cos(this.treeSclTimer_),.3,1.2);this.tree_.transform.localScaleY=e,this.tree_.transform.localPositionZ+=.01*Math.cos(this.treeSclTimer_),mt.drawBoxWireframe(this.tree_.meshRenderer.bounds,this.tree_.name,this.owner,Laya.Color.RED)}}}_onTouchBegin(t){"frameRate"in t.target&&(this.bHome_&&(this.touchPos_.x=Laya.stage.mouseX,this.touchPos_.y=Laya.stage.mouseY,this.cam_.viewportPointToRay(this.touchPos_,this.ray_),this.cam_.transform.lookAt(this.ray_.direction,new Laya.Vector3(0,1,0))),this.bTouched_=!0)}_onTouchMove(t){if(this.bTouched_&&!this.bHome_){this.touchPos_.x=Laya.stage.mouseX,this.touchPos_.y=Laya.stage.mouseY,this.cam_.viewportPointToRay(this.touchPos_,this.ray_);let t=kt.getBoundingBox(this.sea_),e=new Laya.Vector3;Laya.CollisionUtils.intersectsRayAndBoxRP(this.ray_,t._boundBox,e);let i=new Laya.Vector3(this.float_.transform.position.x,0,this.float_.transform.position.z),s=new Laya.Vector3(e.x,0,e.z);mt.drawLineWireframe(i,s,"l1",this.owner,Laya.Color.BLUE);for(let t=0;t<this.circles_.length;++t){let e=kt.intersectSeg2Circle2D(new Laya.Point(i.x,i.z),new Laya.Point(s.x,s.z),this.circles_[t]);if(e.length>0){if(console.log("circle inter",this.circles_[t].tag),mt.drawCylinderXZ(this.circles_[t].tag,this.circles_[t].radius,.01,this.rocks_[t],.1),e.length>1){this.stick1_.active=!0,this.stick2_.active=!0,this.stick1_.transform.position=new Laya.Vector3(e[0].x,0,e[0].y),this.stick2_.transform.position=new Laya.Vector3(e[1].x,0,e[1].y);break}this.stick1_.active=!0,this.stick2_.active=!1,this.stick1_.transform.position=new Laya.Vector3(e[0].x,0,e[0].y);break}this.stick1_.active=!1,this.stick2_.active=!1,mt.hidePrimitive(this.circles_[t].tag)}for(let t=0;t<this.rocks_.length;++t){let e=kt.convertBound2RectXZ(this.rocks_[t]),a=kt.intersectSeg2Rect2D(new Laya.Point(i.x,i.z),new Laya.Point(s.x,s.z),e),n=[];for(let t=0;t<a.length;++t){let e=a[t];n.push(e)}let o=null;if(n.length>0)if(n.length>1){let t=0;for(let e=0;e<n.length;++e){let s=n[e].point.distance(i.x,i.z);(s<t||0===t)&&(o=n[e],t=s)}}else o=n[0];if(o){let e=new Laya.Vector3(o.vertex2.x-o.vertex1.x,0,o.vertex2.y-o.vertex1.y),s=0,a=0;kt.isParallelVec3D(e,this.horVecN_)?(s=2*o.point.x-i.x,a=i.z):(s=i.x,a=2*o.point.y-i.z),this.reflectLine_.setValue(s-o.point.x,0,a-o.point.y),Laya.Vector3.normalize(this.reflectLine_,this.reflectLine_),Laya.Vector3.scale(this.reflectLine_,.3,this.reflectLine_);let n=new Laya.Vector3(o.point.x,0,o.point.y),l=new Laya.Vector3(s,0,a);mt.drawLineWireframe(n,l,this.rocks_[t].name+"l2",this.owner,Laya.Color.RED)}else mt.hideWireframe(this.rocks_[t].name+"l2")}}}_onTouchEnd(t){this.bTouched_=!1}}var vt;!function(t){t[t.kStart=0]="kStart",t[t.kSignIn=1]="kSignIn",t[t.kSetting=2]="kSetting",t[t.kBox=3]="kBox"}(vt||(vt={}));class wt extends Laya.Script{constructor(){super(...arguments),this.homePnl_=null,this.startBtn_=null,this.signInBtn_=null,this.settingBtn_=null,this.boxBtn_=null,this.showTrans_=null,this.closeTrans_=null,this.settingUI_=null,this.signInUI_=null,this.stage_=null,this.bLocked_=!1,this.bFirst_=!1,this.bPreloadBnr_=!1}onAwake(){wt.instance=this,fgui.UIPackage.loadPackage(s.nativePath+"2d/fgui/HomeHUD",i.layaHandler(this,this._onLoadedUI))}onDestroy(){}open(){this._enter()}onUpdate(){}setStartBtnStatus(t=!1){this.startBtn_&&(this.startBtn_.getController("try").selectedIndex=t?0:1)}_onLoadedUI(){let t=fgui.GRoot.inst,e=fgui.UIPackage;e.addPackage(s.nativePath+"2d/fgui/HomeHUD"),this.homePnl_=e.createObject("HomeHUD","HomePnl").asCom,this.homePnl_.setSize(Laya.stage.width,Laya.stage.height),this.homePnl_&&(t.addChild(this.homePnl_),this.homePnl_.visible=!1,this.startBtn_=this.homePnl_.getChild("startBtn").asButton,this.signInBtn_=this.homePnl_.getChild("signInBtn").asButton,this.settingBtn_=this.homePnl_.getChild("settingBtn").asButton,this.boxBtn_=this.homePnl_.getChild("freeBoxBtn").asButton,this.startBtn_.onClick(this,this._onClick,[vt.kStart]),this.signInBtn_.onClick(this,this._onClick,[vt.kSignIn]),this.settingBtn_.onClick(this,this._onClick,[vt.kSetting]),this.boxBtn_.onClick(this,this._onClick,[vt.kBox]),this.showTrans_=this.homePnl_.getTransition("showTrans"),this.closeTrans_=this.homePnl_.getTransition("closeTrans"),this.settingUI_=st.instance,this.signInUI_=new ht,this.signInUI_.init(this.homePnl_.getChild("signInPnl").asCom))}_loadedBnr(){let t=s.instance.getScene(s.nativePath+"3d/Stage.ls");if(t){t.addComponent(xt);let e=t.getComponent(xt);e.init(),this.stage_=e,this._enter()}}_enter(){this.homePnl_&&this.stage_&&dt.instance.over(0,()=>{this.owner.active=!0,this.homePnl_.visible=!0,this.bPreloadBnr_=!1,this.stage_.enterHome()})}_leave(){this.homePnl_.visible=!1}_onClick(t){if(!this.bLocked_)switch(t){case vt.kStart:break;case vt.kSignIn:this.signInUI_&&this.signInUI_.show();break;case vt.kSetting:this.settingUI_&&this.settingUI_.show()}}_redPoint(t,e){e&&1===e.type&&(this.signInBtn_.getController("redPnt").selectedIndex=1)}_fpsResult(){if(this.settingUI_){let t=Q.instance.averageFPS;if(i.log("average FPS",t),t>0){let e=this.settingUI_.VFXLvl;e==Y.kHigh?t<=52?this.settingUI_.VFXLvl=Y.kMid:t<=45&&(this.settingUI_.VFXLvl=Y.kLow):e==Y.kMid?t<=55?this.settingUI_.VFXLvl=Y.kLow:t>=60&&(this.settingUI_.VFXLvl=Y.kHigh):e==Y.kLow&&t>=58&&(this.settingUI_.VFXLvl=Y.kMid)}}}_showPageBnr(){}_hidePageBnr(){}_showFoldBnr(){}_hideFoldBnr(){}}wt.instance=null;class Mt extends et{constructor(){super(...arguments),this.titleLbl_=null,this.contentLbl_=null,this.confirmBtn_=null,this.closeBtn_=null,this.showTrans_=null,this.closeTrans_=null,this.yesCallback_=null,this.noCallback_=null}init(t){t&&(this.com_=t,t.setSize(Laya.stage.width,Laya.stage.height),this.titleLbl_=t.getChild("titleLbl").asTextField,this.contentLbl_=t.getChild("contentLbl").asTextField,this.confirmBtn_=t.getChild("confirmBtn").asButton,this.closeBtn_=t.getChild("closeBtn").asButton,this.showTrans_=t.getTransition("showTrans"),this.closeTrans_=t.getTransition("closeTrans"),t.sortingOrder=Z.kDialog,t.visible=!1,et.root.addChild(t))}show(t,e,s,a,n=!1){this.com_&&(this.com_.visible=!0,this.titleLbl_.text=t,this.contentLbl_.text=e,this.bLock_=!0,this.showTrans_.play(i.layaHandler(this,()=>{this.bLock_=!1})),this.confirmBtn_.onClick(this,this._onConfirm),this.closeBtn_.onClick(this,this._onClose),this.yesCallback_=s,this.noCallback_=a,this.closeBtn_.visible=!n)}reset(){this.com_&&(this.bLock_=!1,this.com_.visible=!1,this.confirmBtn_.offClick(this,this._onConfirm),this.closeBtn_.offClick(this,this._onClose),this.com_.sortingOrder!=Z.kDialog&&this.renderSortOriginal())}renderSortTop(){this.com_&&(this.com_.sortingOrder=Z.kTip)}renderSortOriginal(){this.com_&&(this.com_.sortingOrder=Z.kDialog)}_onConfirm(){this.bLock_||(this.yesCallback_&&this.yesCallback_(),this.bLock_=!0,this.closeTrans_.play(i.layaHandler(this,this.reset)))}_onClose(){this.bLock_||(this.noCallback_&&this.noCallback_(),this.bLock_=!0,this.closeTrans_.play(i.layaHandler(this,this.reset)))}}Mt.instance=new Mt;class Lt extends Laya.Script{constructor(){super(...arguments),this.loadPnl_=null,this.loadProg_=null,this.loadBg_=null,this.loadProc_=0,this.loadTimer_=0,this.bLoading_=!1,this.bLoaded_=!1,this.bExcuted_=!1,this.bChanged_=!1}onStart(){Q.instance.init(),Laya.timer.frameLoop(1,Q.instance,Q.instance.update),J.loadJson(),et.root=fgui.GRoot.inst,Laya.stage.addChild(et.root.displayObject),fgui.UIConfig.packageFileExtension="bin",fgui.UIPackage.loadPackage(s.nativePath+"LoadUI",i.layaHandler(this,this._onLoadingUI))}_onLoadingUI(){if(fgui.UIPackage.addPackage(s.nativePath+"LoadUI"),this.loadPnl_=fgui.UIPackage.createObject("LoadUI","Loading").asCom,this.loadPnl_){et.root.addChild(this.loadPnl_),this.loadPnl_.setSize(Laya.stage.width,Laya.stage.height),this.loadBg_=this.loadPnl_.getChild("bg").asImage,this.loadProg_=this.loadPnl_.getChild("prog").asProgress;let t=this.loadBg_.width,e=this.loadBg_.height,s=Laya.stage.height/e,a=Laya.stage.width/t;s>a?(this.loadBg_.width=t*s,this.loadBg_.height=e*s):(this.loadBg_.width=t*a,this.loadBg_.height=e*a),i.log("loading UI size",this.loadBg_.width,this.loadBg_.height,t,e,s,a)}i.isWeChat&&(b.fetchSdkInfo(),b.checkVersionUpdate(this._updateApp.bind(this),this._noUpdate.bind(this))),this.bLoading_=!0,this.loadProc_=0}_updateApp(){}_noUpdate(){}_excuteLoad(){s.nativePath="res/",this.bLoaded_=!0,this._addProc(99)}onUpdate(){if(this.bLoading_)if(this.loadProc_<40){let t=Laya.timer.delta/1e3;this.loadTimer_-=t,this.loadTimer_<=0&&(this._addProc(i.randRange(10,15)),this.loadTimer_=i.randRangeF(.1,.3))}else this.loadProc_<89?this.bExcuted_?this.loadProc_<88&&this._addProc(1):(this._excuteLoad(),this.bExcuted_=!0):this.bLoaded_&&!this.bChanged_&&J.bJsonLoaded&&Q.instance.bLogined&&(fgui.UIPackage.loadPackage(s.nativePath+"2d/fgui/CommUI",i.layaHandler(this,this._onLoadCommUI)),this.bChanged_=!0)}_onLoadCommUI(){J.loadBackendConfig(),fgui.UIPackage.addPackage(s.nativePath+"2d/fgui/CommUI");let t=fgui.UIPackage.createObject("CommUI","Blocker").asCom;t&&nt.instance.init(t);let e=fgui.UIPackage.createObject("CommUI","Tip").asCom;e&&it.instance.init(e);let i=fgui.UIPackage.createObject("CommUI","Popup").asCom;i&&at.instance.init(i);let a=fgui.UIPackage.createObject("CommUI","DialogPnl").asCom;a&&Mt.instance.init(a);let n=fgui.UIPackage.createObject("CommUI","SettingPnl").asCom;n&&st.instance.init(n);let o=fgui.UIPackage.createObject("CommUI","TransPnl").asCom;o&&dt.instance.init(o),this._addProc(0,!0),et.root.removeChild(this.loadPnl_),this.loadPnl_.dispose(),fgui.UIPackage.removePackage("LoadUI"),dt.instance.show(()=>{Laya.Scene.open("HomeHUD.scene",!0)})}_addProc(t,e=!1){e?this.loadProc_=100:(this.loadProc_+=t,this.loadProc_>99&&(this.loadProc_=99)),this.loadProg_.value=this.loadProc_}}class St{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("game_ui/home_hud.ts",wt),t("load.ts",Lt)}}St.width=720,St.height=1280,St.scaleMode="fixedwidth",St.screenMode="vertical",St.alignV="middle",St.alignH="center",St.startScene="Load.scene",St.sceneRoot="",St.debug=!1,St.stat=!0,St.physicsDebug=!1,St.exportSceneToJson=!0,St.init();new class{constructor(){window.Laya3D?Laya3D.init(St.width,St.height):Laya.init(St.width,St.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=St.scaleMode,Laya.stage.screenMode=St.screenMode,Laya.URL.exportSceneToJson=St.exportSceneToJson,(St.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),St.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),Laya.alertGlobalError=!0,Laya.MouseManager.multiTouchEnabled=!1,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){St.startScene&&Laya.Scene.open(St.startScene)}}}();