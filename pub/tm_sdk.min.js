module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=16)}([function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(9)),s=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setStorageSyncErrorTimes=0,this.watchObjectKeyCaches=null,this.wxAPIMapToOff={onShow:"offShow",onHide:"offHide",onAppHide:"offAppHide",onAppShow:"offAppShow"},this.isCocos=null,this.isLaya=null,this.linearCongruenceSeed=Date.now()}return o(e,[{key:"getNavigateList",value:function(){return void 0!==("undefined"==typeof GameGlobal?"undefined":i(GameGlobal))&&GameGlobal.__wxConfig&&GameGlobal.__wxConfig.navigateToMiniProgramAppIdList||[]}},{key:"needUpdateTips",value:function(e,t){console.error(e+"接口即将被弃用，请使用"+t+"接口。详情请参考文档")}},{key:"getLocationInfo",value:function(){return this.promiseFy(wx.getLocation,{type:"wgs84"}).catch(function(e){return{}})}},{key:"getStorageSync",value:function(e){try{return wx.getStorageSync(e)}catch(e){return""}}},{key:"filterEmptyKey",value:function(e){var t=this;return"Object"===this.getVariableType(e)&&(e=this.deepClone(e),Object.keys(e).forEach(function(n){"Object"===t.getVariableType(e[n])&&(e[n]=t.filterEmptyKey(e[n])),(null===e[n]||void 0===e[n]||""===e[n]||t.isEmptyObject(e[n]))&&delete e[n]})),e}},{key:"setStorageSync",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;try{wx.setStorageSync(e,t)}catch(r){n>0&&this.setStorageSync(e,t,--n)}}},{key:"watchObjectKey",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.get,i=n.set;if("Object"!==this.getVariableType(e)){var o=this;this.watchObjectKeyCaches=this.watchObjectKeyCaches||new WeakMap;var a=o.watchObjectKeyCaches.get(e)||s.deepClone(e);this.watchObjectKeyCaches.set(e,a),Object.defineProperty(e,t,{set:function(e){"Function"===o.getVariableType(i)&&i(e,a[t]),e!==a[t]&&(a[t]=e)},get:function(){return"Function"===o.getVariableType(r)?r(a[t]):a[t]}})}}},{key:"bindJsScopeToFn",value:function(e,t){var n=this;return t&&("Function"===this.getVariableType(e)?e=e.bind(t):"Object"===this.getVariableType(e)&&Object.keys(e).forEach(function(r){e[r]=n.bindJsScopeToFn(e[r],t)})),e}},{key:"isCocosGame",value:function(){return null!==this.isCocos?this.isCocos:this.isCocos=this.isRuningMiniGame()&&"object"===("undefined"==typeof cc?"undefined":i(cc))&&"object"===i(cc.sys)&&cc.sys.platform===cc.sys.WECHAT_GAME}},{key:"getCocosMainVersion",value:function(){if(this.isCocosGame()&&cc.ENGINE_VERSION)return cc.ENGINE_VERSION.split(".")[0]}},{key:"isLayaGame",value:function(){return null!==this.isLaya?this.isLaya:this.isLaya=this.isRuningMiniGame()&&"object"===("undefined"==typeof Laya?"undefined":i(Laya))&&"function"==typeof Laya.Browser&&i(Laya.Browser.onWeiXin)}},{key:"addPreHook",value:function(e,t){var n=["onShareAppMessage"],r=null;"App"===e&&(r=App),"Page"===e&&(r=Page);var i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=function(r){if(t.hasOwnProperty(r)){var i=t[r]||function(){};if(e[r]){var o=e[r];e[r]=function(){for(var e=this,t=arguments.length,a=Array(t),s=0;s<t;s++)a[s]=arguments[s];if(n.indexOf(r)>-1){var u=o.apply(this,a);return i.call.apply(i,[this,u].concat(a))}var c=i.apply(this,a);c&&c.then?c.then(function(){return o.apply(e,a)}):o.apply(this,a)}}else e[r]=i}};for(var o in t)i(o);r(e)};"App"===e&&(App=i),"Page"===e&&(Page=i)}},{key:"nextShow",value:function(){var e=this;return new Promise(function(t,n){e.isRuningMiniPro()?"function"==typeof wx.onAppShow?e.forceBindWxAPI("onAppShow",function(e){t(e)}):s.addPreHook("App",{onShow:function(e){t(e)}}):e.isRuningMiniGame()?e.forceBindWxAPI("onShow",function(e){t(e)}):t()})}},{key:"listenWxAPI",value:function(e,t){var n=this;try{var r=wx[e];Object.defineProperty(wx,e,{writable:!0}),wx[e]=function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];var a=r.apply(void 0,i);if("Function"===n.getVariableType(t))return t({userOptions:i,wxOriginReturns:a})},Object.defineProperty(wx,e,{writable:!1})}catch(e){console.error(e)}}},{key:"getRandomNumber",value:function(e,t){this.linearCongruenceSeed=(9301*this.linearCongruenceSeed+49297)%233280;var n=this.linearCongruenceSeed/233280;return 0===n?this.getRandomNumber(e,t):Math.floor(n*(t-e+1))}},{key:"forceBindWxAPI",value:function(e,t){"Function"===this.getVariableType(t)&&(wx[e](t),this.listenWxAPI(this.wxAPIMapToOff[e],function(n){0===n.userOptions.length&&wx[e](t)}))}},{key:"normalizeRes",value:function(e){return e.errMsg||e.statusCode?e.data?{err:e.data.err||e.data.code||0,code:e.statusCode,message:e.data.msg||e.data.message,data:e.data.data}:{err:1,code:e.statusCode||e.errCode||999,message:e.errMsg}:{err:e.err||e.code,code:e.statusCode,message:"string"==typeof e?e:e.msg||e.message,data:e.data}}},{key:"cutStringAndBackWidth",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=t*n,i=e.length,o=0;if(i>n){for(var a=0;a<i;a++)if(e.charCodeAt(a)>127||94==e.charCodeAt(a)?o+=t:o+=t/2,o>r){e=e.substr(0,a)+"...",o+=t/2;break}}else o=t*i;return{string:e,width:o}}},{key:"isHighViewPhone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.width,n=void 0===t?0:t,r=e.height;return(n/(void 0===r?0:r)).toFixed(2)<(9/16).toFixed(2)}},{key:"wxImageLoader",value:function(e){var t=wx.createImage();return new Promise(function(n,r){t.onload=function(){n(t)},t.onerror=function(e){r(e.message||e)},t.src=e})}},{key:"promiseFy",value:function(e,t){var n={};if(t)for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return new Promise(function(t,r){n.success=function(e){e?(200===e.statusCode||e.errMsg.indexOf(":ok")>-1)&&t(e):t(e)},n.fail=function(e){r(s.normalizeRes(e))},e?e.call(wx,n):r(new Error({message:"miniProgramFn is not defined"}))})}},{key:"addQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s.stringifyQuery(t);return n?e.indexOf("?")>-1?e+"&"+n:e+"?"+n:e}},{key:"parseQuery",value:function(e){if("string"==typeof e&&e.indexOf("=")>-1){var t={};try{(e.indexOf("?")>-1?e.split("?")[1].split("&"):e.split("&")).forEach(function(e){var n=e.split("=");n&&n.length>1&&(t[n[0]]=n[1])})}catch(e){}return t}return{}}},{key:"stringifyQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[];for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];r="string"==typeof r?r:"number"==typeof r&&isNaN(r)?"NaN":void 0===r?"undefined":JSON.stringify(r),t.push([n+"="+r])}return t.join("&")}},{key:"getCurrentRoute",value:function(){var e=getCurrentPages();return"/"+e[e.length-1].route}},{key:"getCurrentOptions",value:function(){var e=getCurrentPages();return e[e.length-1].options}},{key:"getCurrentFullUrl",value:function(){var e=s.getCurrentRoute(),t=s.getCurrentOptions();return s.addQuery(e,t)}},{key:"getNetWorkStatus",value:function(){var e=this;return this.getNetWorkStatusPromise||(this.getNetWorkStatusPromise=new a.default(function(e,t){wx.getNetworkType({success:function(t){e(t)},fail:function(e){t(e)}})}),wx.onNetworkStatusChange(function(t){e.currNetWorkType=t.networkType})),a.default.resolve().then(function(){return e.getNetWorkStatusPromise}).then(function(t){return e.currNetWorkType?e.currNetWorkType:t.networkType}).catch(function(e){return{}})}},{key:"getSystemInfo",value:function(){return s.promiseFy(wx.getSystemInfo).catch(function(e){return{}})}},{key:"setStorage",value:function(e,t){return s.promiseFy(wx.setStorage,{key:e,data:t}).then(function(){return t}).catch(function(){})}},{key:"getStorage",value:function(e){return s.promiseFy(wx.getStorage,{key:e}).then(function(e){return e.data}).catch(function(){return""})}},{key:"checkSessionValidation",value:function(){return s.promiseFy(wx.checkSession).then(function(){return!0}).catch(function(){return!1})}},{key:"isRuningMiniPro",value:function(){return"function"==typeof getApp&&"undefined"==typeof GameGlobal&&"undefined"!=typeof wx}},{key:"isRuningMiniGame",value:function(){return"function"!=typeof getApp&&"undefined"!=typeof GameGlobal&&"undefined"!=typeof wx}},{key:"isEmptyObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"{}"===JSON.stringify(e)}},{key:"makeResponse",value:function(e){var t=e.code,n=void 0===t?200:t,r=e.message,i=e.err;return{err:void 0===i?0:i,code:n,message:r}}},{key:"getVariableType",value:function(e){return Object.prototype.toString.call(e).slice(8,-1)}},{key:"deepClone",value:function(e){var t=s.getVariableType(e),n=void 0;if("Object"===t&&(n={}),"Array"===t&&(n=[]),!n)return e;for(var r in e)if(e.hasOwnProperty(r)){var i=e[r],o=s.getVariableType(i),a="Object"===o||"Array"===o;n[r]=a?s.deepClone(i):i}return n}},{key:"encode",value:function(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}},{key:"handleGetMethodData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Object.keys(t).length)return e;var n=[];Object.keys(t).forEach(function(e){var r=t[e];if(null!=r){var i=[];Array.isArray(r)?(i=r,e+="[]"):i=[r],i.forEach(function(t){n.push(s.encode(e)+"="+s.encode(t))})}});var r=n.join("&");return"&"===e[e.length-1]&&(e=e.slice(0,-1)),"&"===(e+=(-1===e.indexOf("?")?"?":"&")+r)[e.length-1]&&(e=e.slice(0,-1)),e}},{key:"getOSbySystemInfo",value:function(){var e=((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).system||"").toLowerCase(),t=e;return e.indexOf("ios")>-1&&(t="ios"),e.indexOf("android")>-1&&(t="android"),e.indexOf("win")>-1&&(t="win"),t}},{key:"checkExpireByServerTimeFormat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!0;try{n=new Date(e).getTime()<=Date.now()+t}catch(e){}return n}},{key:"normalErrorHandler",value:function(e){var t=e.message,n=void 0===t?"程序错误":t;return Promise.resolve().then(function(){return s.promiseFy(wx.showModal,{content:n,showCancel:!1})})}},{key:"sleep",value:function(e){return new Promise(function(t){return setTimeout(t,e)})}}]),e}());n.default=s},function(n,r,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=i(4),s=c(i(0)),u=c(i(5)),d=c(i(2)),l=c(i(9));function c(e){return e&&e.__esModule?e:{default:e}}var f=function(){var n=function(){return new l.default(function(e,t){s.default.getNetWorkStatus().then(function(t){"none"!=t?e():(console.error("当前网络已断开，请检查网络状态"),wx.onNetworkStatusChange(function(t){t.isConnected&&e()}))}).catch(e)})},r=null,i=null,c={test:"https://test.kuaiyugo.com"},h={test:"http://test.kuaiyugo.com",pre:"https://h5game-log.kuaiyugo.com",prod:"https://h5game-log.kuaiyugo.com"},p={test:"https://cdn.kuaiyugo.com",prod:"https://cdn.kuaiyugo.com"},g={test:"https://test.skysriver.com",prod:"https://api.skysriver.com"},m=function(){if(s.default.isRuningMiniGame()&&GameGlobal&&GameGlobal.__wxConfig&&GameGlobal.__wxConfig.navigateToMiniProgramAppIdList){var e=GameGlobal.__wxConfig.navigateToMiniProgramAppIdList;Object.keys(e).forEach(function(t){["download","upload"].indexOf(t)>-1&&-1==e[t].indexOf(p[a.SDK_CONFIG.ENV])?console.error("当前应用域名白名单缺少以下配置: "+t+"类型："+p[a.SDK_CONFIG.ENV]):"request"===t&&(-1==e[t].indexOf(g[a.SDK_CONFIG.ENV])&&console.error("当前应用域名白名单缺少以下配置: "+t+"类型："+g[a.SDK_CONFIG.ENV]),c[a.SDK_CONFIG.ENV]&&-1==e[t].indexOf(c[a.SDK_CONFIG.ENV])&&console.error("当前应用域名白名单缺少以下配置: "+t+"类型："+c[a.SDK_CONFIG.ENV]))})}return!0},I={getTMAppConfig:function(){return g[a.SDK_CONFIG.ENV]+"/api/v1/delivery/app_config"},getRiskFactor:function(){return c[a.SDK_CONFIG.ENV]+"/api/toolkit/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/br"},shareTemplate:function(){return g[a.SDK_CONFIG.ENV]+"/api/v1/delivery/share_template"},getJudgeConfig:function(){return g[a.SDK_CONFIG.ENV]+"/api/v1/delivery/judge_config"},checkSDK:function(){return g[a.SDK_CONFIG.ENV]+"/api/v1/delivery/sdk_check"},tmBehaviour:function(){return g[a.SDK_CONFIG.ENV]+"/api/v1/delivery/collect_user_behaviour"},flowList:function(e){return g[a.SDK_CONFIG.ENV]+"/api/v1/delivery/position/"+e},heartBeatRecordUrl:function(){return h[a.SDK_CONFIG.ENV]+"/ping"},loadingLog:function(){return h[a.SDK_CONFIG.ENV]+"/dataAnalysis/saveLoadingLog"},behaviorLog:function(){return h[a.SDK_CONFIG.ENV]+"/dataAnalysis/saveUserBehaviorLogV2"},getGroupIdAndRank:function(){return c[a.SDK_CONFIG.ENV]+"/api/toolkit/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/share_entergroup"},getTigerIdByWxId:function(e){return c[a.SDK_CONFIG.ENV]+"/api/tiger/v1/positions_tactics/"+e},userInfo:function(){return c[a.SDK_CONFIG.ENV]+"/api/platuser/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/miniprogram_sessions"},authCode:function(){return c[a.SDK_CONFIG.ENV]+"/api/oauth/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/authroizes"},accessToken:function(){return c[a.SDK_CONFIG.ENV]+"/api/oauth/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/access_tokens"},checkUserAccountStatus:function(){return c[a.SDK_CONFIG.ENV]+"/api/oauth/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/check"},midasPayOrder:function(){return c[a.SDK_CONFIG.ENV]+"/api/payment/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/midas_orders"},wxPayOrder:function(){return c[a.SDK_CONFIG.ENV]+"/api/payment/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/wx_orders"},checkPayType:function(){return c[a.SDK_CONFIG.ENV]+"/api/payment/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/pay_types"},checkOrderStatus:function(e){return c[a.SDK_CONFIG.ENV]+"/api/payment/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/orders/"+e+"/status"},accountMerge:function(){return c[a.SDK_CONFIG.ENV]+"/api/platuser/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/mergers"},goldBalance:function(){return c[a.SDK_CONFIG.ENV]+"/api/payment/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/gold_balances"},confirmPay:function(e){return c[a.SDK_CONFIG.ENV]+"/api/payment/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/orders/"+e+"/confirm_pays"},midasBalance:function(){return c[a.SDK_CONFIG.ENV]+"/api/payment/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/midas_balances"},refreshSession:function(){return c[a.SDK_CONFIG.ENV]+"/api/platuser/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/refresh_session"},cancelOrder:function(e){return c[a.SDK_CONFIG.ENV]+"/api/payment/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/orders/"+e+"/cancel_orders"},payErrorOrder:function(){return c[a.SDK_CONFIG.ENV]+"/api/payment/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/error_orders"},h5PayOrder:function(){return c[a.SDK_CONFIG.ENV]+"/api/panda/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/orders"},h5PayOrderStatus:function(e){return c[a.SDK_CONFIG.ENV]+"/api/panda/v1/programs/"+a.SDK_CONFIG.PROGRAM_ID+"/users/"+u.default.userInfo.open_id+"/orders/"+e},getBackBtnGameInfo:function(e,t){return c[a.SDK_CONFIG.ENV]+"/api/tiger/v1/checkBackflow?A_app_id="+e+"&B_app_id="+t},getAbtestUserGroup:function(){return g[a.SDK_CONFIG.ENV]+"/api/v1/delivery/user_group"}};function v(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).forceRefresh,t=a.STORAGE_KEYS.AUTH_CODE_INFO_STORAGE_KEY;return Promise.resolve().then(function(){return u.default.fetchUserInfo()}).then(function(){return s.default.getStorage(t)}).then(function(t){return e?f.getAuthCode():t&&t.expires_at?s.default.checkExpireByServerTimeFormat(t.expires_at,6e4)?f.getAuthCode():(t.fromCache=!0,t):f.getAuthCode()}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fromCache?e.code:s.default.setStorage(t,e).then(function(e){return e.code})})}function y(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).forceRefresh,t=void 0!==e&&e;return i||(i=Promise.resolve().then(function(){return v({forceRefresh:t})}).then(function(e){return function e(t){var n=t.code,r=t.forceRefresh,i=void 0!==r&&r,o=a.STORAGE_KEYS.ACCESS_TOKEN_INFO_STORAGE_KEY;return Promise.resolve().then(function(){return s.default.getStorage(o)}).then(function(e){return e&&e.expires_at&&!i?s.default.checkExpireByServerTimeFormat(e.expires_at,18e4)?f.getAccessToken({code:n}):(e.fromCache=!0,e):f.getAccessToken({code:n})}).then(function(e){var t=e;return u.default.access_token=t.access_token,t.fromCache?t.access_token:s.default.setStorage(o,t).then(function(e){return e.access_token})}).catch(function(t){if(1013===t.err)return v({forceRefresh:!0}).then(function(t){return e({code:t})});console.error(t)})}({code:e,forceRefresh:t})}).then(function(e){return i=null,e})),i}var w={getTMAppConfig:{method:"GET",urlMaker:function(){return I.getTMAppConfig()},noAccessToken:!0},getRiskFactor:{method:"GET",urlMaker:function(){return I.getRiskFactor()},dataMaker:function(e){var t=e.version;return{version:d.default.appVersion||t}},noAccessToken:!0},checkSDK:{method:"POST",urlMaker:function(){return I.checkSDK()},dataMaker:function(e){return{open_id:e.open_id,code:e.code}}},postLoadingLog:{method:"POST",urlMaker:function(e){return I.loadingLog()},dataMaker:function(e){return e},isLogAPI:!0},postTigerBehaviour:{method:"POST",urlMaker:function(e){return I.tmBehaviour()},dataMaker:function(e){return e},isLogAPI:!0},postHeartBeatRecord:{method:"POST",urlMaker:function(){return I.heartBeatRecordUrl()},dataMaker:function(e){var t=e.uid,n=e.uidfp,r=e.uidfp2;return{aid:a.SDK_CONFIG.APPID,uidfp:n,uidfp2:r,uid:t}},isLogAPI:!0,noLog:!0},postBehaviorLog:{method:"POST",urlMaker:function(e){return I.behaviorLog()},dataMaker:function(e){return e},isLogAPI:!0},getGroupIdAndRank:{method:"POST",urlMaker:function(){return I.getGroupIdAndRank()},dataMaker:function(e){return{share_id:e.share_id,share_open_id:e.share_open_id,wx_encrypted_data:e.wx_encrypted_data,wx_iv:e.wx_iv}}},getTigerIdByWxId:{method:"GET",urlMaker:function(e){var t=e.wx_position_id;return I.getTigerIdByWxId(t)},dataMaker:function(e){var t=e.version;return{gender:u.default.userInfo.gender,version:d.default.appVersion||t,openid:u.default.userInfo.open_id}}},getFlowList:{method:"GET",urlMaker:function(e){var t=e.positionId;return I.flowList(t)},dataMaker:function(){return{pid:u.default.userInfo.pid,gender:u.default.userInfo.gender,version:d.default.appVersion,openid:u.default.userInfo.open_id}}},postUserInfo:{method:"POST",urlMaker:function(e){return I.userInfo()},dataMaker:function(e){return{auth_mode:e.auth_mode,wx_code:e.wx_code,wx_encrypted_data:e.wx_encrypted_data,wx_iv:e.wx_iv,wx_signature:e.wx_signature}},headerMaker:function(){return _()},noAccessToken:!0},postUpdateUserInfo:{method:"POST",urlMaker:function(e){return I.userInfo()},dataMaker:function(e){var t=e.userInfoDetail;return{openId:u.default.userInfo.open_id,appId:a.SDK_CONFIG.APPID,encryptedData:t.encryptedData,iv:t.iv,signature:t.signature,rawData:t.rawData}},noAccessToken:!0},getAuthCode:{method:"GET",urlMaker:function(e){return I.authCode()},dataMaker:function(){return{openid:u.default.userInfo.open_id,scope:"snsapi_base",redirect_uri:"https://www.starsriver.cn",response_type:"code",state:"code"}},noAccessToken:!0},getAccessToken:{method:"GET",urlMaker:function(e){return I.accessToken()},dataMaker:function(e){var t=e.code;return{programId:a.SDK_CONFIG.PROGRAM_ID,openid:u.default.userInfo.open_id,grant_type:"authorization_code",code:t,program_secret:a.SDK_CONFIG.PROGRAM_SECRET}},noAccessToken:!0},postCheckUserAccountStatus:{method:"POST",urlMaker:function(e){return I.checkUserAccountStatus()},dataMaker:function(){return{}}},postCreateMidasPayOrder:{method:"POST",urlMaker:function(e){return I.midasPayOrder()},dataMaker:function(e){return{coin:e.coin,program_param:e.program_param}}},platuserRefreshSession:{method:"GET",urlMaker:function(){return I.refreshSession()},dataMaker:function(e){return{wx_code:e.wx_code}}},postCreateWxPayOrder:{method:"POST",urlMaker:function(e){return I.wxPayOrder()},dataMaker:function(e){return{coin:e.coin,program_param:e.program_param}}},getCheckPayType:{method:"GET",urlMaker:function(e){return I.checkPayType()},dataMaker:function(){return{}}},getCheckOrderStatus:{method:"GET",urlMaker:function(e){return I.checkOrderStatus(e)},dataMaker:function(){return{}}},postMergeAccounts:{method:"POST",urlMaker:function(e){return I.accountMerge()},dataMaker:function(e){return{clipboard:e.clipboard}}},putUpdateGoldBalance:{method:"PUT",urlMaker:function(){return I.goldBalance()},dataMaker:function(e){return{gold:e.gold,transaction_type:e.transaction_type,gold_desc:e.gold_desc}}},getGoldBalance:{method:"GET",urlMaker:function(){return I.goldBalance()},dataMaker:function(){return{}}},getShareTemplate:{method:"GET",urlMaker:function(){return I.shareTemplate()},noAccessToken:!0,dataMaker:function(e){var t=e.version,n=e.scene;return n?{version:d.default.appVersion||t,scene:n}:{version:d.default.appVersion||t}}},getJudgeConfig:{method:"GET",urlMaker:function(){return I.getJudgeConfig()},dataMaker:function(){return{version:d.default.appVersion}}},putConfirmPay:{method:"PUT",urlMaker:function(e){return I.confirmPay(e)}},putCancelPay:{method:"PUT",urlMaker:function(e){return I.cancelOrder(e)}},putUpdateMidasBalance:{method:"PUT",urlMaker:function(e){return I.midasBalance()},dataMaker:function(){return{}}},postPayErrorLog:{method:"POST",urlMaker:function(){return I.payErrorOrder()},dataMaker:function(e){var t=e.order_code;return{msg:e.msg,order_code:t}},headerMaker:function(){return _()}},postCreateH5PayOrder:{method:"POST",urlMaker:function(e){return I.h5PayOrder()},dataMaker:function(e){return{amount:e.amount,program_param:e.program_param}}},getH5PayOrderStatus:{method:"GET",urlMaker:function(e){return I.h5PayOrderStatus(e)},dataMaker:function(){return{}}},getBackBtnGameInfo:{method:"GET",urlMaker:function(e){var t=e.A_app_id,n=e.B_app_id;return I.getBackBtnGameInfo(t,n)},dataMaker:function(){return{}}},getAbtestUserGroup:{method:"GET",urlMaker:function(){return I.getAbtestUserGroup()},dataMaker:function(){return{openid:u.default.userInfo.open_id}}}};function S(e){e.apiName;var t=e.urlMaker,i=e.dataMaker,o=e.method,u=void 0===o?"GET":o,d=e.headerMaker,h=e.noAccessToken,p=void 0!==h&&h,g=e.noLog,v=void 0!==g&&g,S=null,I=0;return S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m(),Promise.resolve().then(function(){return n()}).then(function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r||"test"===a.SDK_CONFIG.ENV||(r=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return"String"===s.default.getVariableType(t)?l.default.resolve(t):0===t.length?l.default.reject(s.default.makeResponse(a.RESPONSE.NO_AVAILABLE_HOST)):new l.default(function(e,n){wx.request({url:t[0],success:e,fail:n})}).then(function(){return e(t[0])}).catch(function(){return e(t.slice(1))})}(e).then(function(e){c[a.SDK_CONFIG.ENV]=e})),r}(a.SPARE_HOSTS_LIST)}).then(function(){if(!p)return y()}).then(function(){var n=i&&i(e),r=t(e);return"get"===u.toLowerCase()&&(r=s.default.handleGetMethodData(r,i&&i(e)),n={}),s.default.promiseFy(wx.request,{url:r,method:u,data:n,header:d?d(e):_()})}).catch(function(e){var t=s.default.normalizeRes(e);return Promise.reject(t)}).then(function(n){var r=s.default.normalizeRes(n);try{!v&&f.REQUEST_LOG&&(console.warn("发起请求:"+u+t(e)),console.warn("请求Header: "+JSON.stringify(d?d(e):_())),console.warn("请求body: "+JSON.stringify(i&&i(e))),console.warn("请求response: ",n),console.warn("返回: ",r))}catch(n){console.error("请求日志打印时报错"+n)}return 0===r.err?Promise.resolve(r.data):a.ACCESS_TOKEN_EXPIRED_CODE.indexOf(r.err)>-1&&++I<a.MAX_LOGIN_RETRY_TIMES?y({forceRefresh:!0}).then(function(){return S(e)}):Promise.reject(r)})}}function _(){var e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).noAccessToken,t={miniprogram:a.SDK_CONFIG.APPID,version:a.SDK_CONFIG.SDKVERSION,device:d.default.appSystemOsType};return e||(t.accesstoken=u.default.access_token),t}return new(function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(){var e=this;Object.keys(w).forEach(function(t){var n=w[t];n.apiName=t,n.isLogAPI?e[t]=e.generateLogAPI(n):e[t]=S(n)}),this.REQUEST_LOG=!0,Object.keys(I).forEach(function(t){e.API_LIST=e.API_LIST||{},e.API_LIST[t]=I[t]})}.call(this),this.RES_HOST=p[a.SDK_CONFIG.ENV]}return o(t,[{key:"generateLogAPI",value:function(e){var r=e.urlMaker,i=e.dataMaker,o=e.method,a=void 0===o?"GET":o,s=e.headerMaker,u=(e.noAccessToken,e.noLog),c=void 0!==u&&u;return function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return new l.default(function(u,d){m(),n().then(function(){wx.request({url:r(e),method:a,data:i&&i(e),header:s?s(e):_(),complete:function(t){!c&&f.REQUEST_LOG&&(console.warn("发起请求:"+a+r(e)),console.warn("请求Header: "+JSON.stringify(s?s(e):_())),console.warn("请求body: "+JSON.stringify(i&&i(e))),console.warn("请求response: ",t))},success:function(e){u(e)},fail:function(n){o>0&&t(e,--o).then(u).catch(d)}})})})}}}]),t}())}();r.default=f},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=d(r(1)),a=d(r(0)),s=r(4),u=d(r(5)),c=d(r(11)),l=d(r(12));function d(e){return e&&e.__esModule?e:{default:e}}var f=[1020,1035,1036,1037,1038,1043];n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hasTiggerNavigate=!1,this.deviceStorageDate=0,this.isSharing=!1,this.APP_SHOW_OPTIONS="",this.appIsShow=!0,this.APP_STATUS_SHOW_STAMPS=[],this.APP_STATUS_HIDE_STAMPS=[],this.API_RETRY_NETWORK_STATUS="none",this.appUnitCookieId="",this.appSystemInfo="",this.appOptionsScene="",this.appShareEventId="",this.appChannelCode="",this.appShareId="",this.appShareId2="",this.appSystemOsType="",this.appVersion="",this.initSDKPromise="",this.hasInitSDK=!1,this.source_appid=""}return i(e,[{key:"sendLanuchCodeToCheck",value:function(e){var t=e.query;t.skysriver&&u.default.fetchUserInfo().then(function(e){o.default.checkSDK({open_id:e.open_id,code:t.skysriver}).then(function(e){wx.showModal({title:"SDK接入测试",content:"发送测试码成功"})}).catch(function(e){wx.showModal({title:"SDK接入测试",content:e.message})})})}},{key:"saveEnvironmentData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getChannelCode(e),n=this.getAppOptionsShareId(e),r=n.shareId,i=n.shareId2,o=e.query||{};this.appUnitCookieId=this.appUnitCookieId||this.getAndSaveUnitCookieId(),this.appSystemInfo=this.appSystemInfo||wx.getSystemInfoSync(),this.appSystemOsType=this.appSystemOsType||a.default.getOSbySystemInfo(this.appSystemInfo),o.seid&&(this.appShareEventId=o.seid),e.scene&&(this.appOptionsScene=e.scene),t&&(this.appChannelCode=t),r&&(this.appShareId=r),i&&(this.appShareId2=i),e.scene&&f.some(function(t){return Number(t)===e.scene})?this.source_appid=e.referrerInfo&&e.referrerInfo.appId||"":this.source_appid=""}},{key:"getAppOptionsShareId",value:function(e){var t=e.query||{},n=void 0,r=void 0;return a.default.isRuningMiniPro()?(n=t.shareId||"",r=t.shareId2||""):a.default.isRuningMiniGame()&&(n=t.sid||"",r=t.sid2||""),{shareId:n,shareId2:r}}},{key:"getAndSaveUnitCookieId",value:function(){var e=s.STORAGE_KEYS.USER_TID_STORAGE_KEY,t=a.default.getStorageSync(e);return t||(t=this.getUnitCookieId(),a.default.setStorageSync(e,t)),t}},{key:"getShareEventId",value:function(){return this.getUnitCookieId().slice(10)}},{key:"getUnitCookieId",value:function(){return""+Date.now()+Math.floor(1e7*Math.random())}},{key:"getSDKCookieId",value:function(){var e=this,t=s.STORAGE_KEYS.USER_TID_STORAGE_KEY;return Promise.resolve().then(function(){return a.default.getStorage(t)}).then(function(n){return n||(n=e.getUnitCookieId(),a.default.setStorage(t,n))})}},{key:"getChannelCode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.query=e.query||{};var t=e.query.channelCode;if(t||(t=((e.referrerInfo||{}).extraData||{}).channelCode),!t){var n=e.query.extraParam||"{}";try{n=JSON.parse(n)}catch(e){n={}}t=n.channelCode}return t}},{key:"packLogData",value:function(e,t){var n={n:"tm_sdk",v:s.SDK_CONFIG.SDKVERSION};if("login_in"===e){var r=this.deviceStorageDate||a.default.getStorageSync("SDK_DEVICE_LOG"),i=Date.now();(i-r>864e5||!r)&&(n.device=this.appSystemInfo,this.deviceStorageDate=i,a.default.setStorageSync("SDK_DEVICE_LOG",""+i))}var o={ak:s.SDK_CONFIG.APPKEY,aid:s.SDK_CONFIG.APPID,type:e,tid:this.appUnitCookieId,uid:u.default.userInfo.open_id,pid:u.default.userInfo.pid,uidfp:u.default.userInfo.ofp,uidfp2:u.default.userInfo.ofp2,gender:u.default.userInfo.gender,region:u.default.regionRoleInfo.region,role:u.default.regionRoleInfo.role};return l.default.runningAbtestGroup&&l.default.runningAbtestGroup.length>0&&(o.abtest=l.default.runningAbtestGroup),"login_in"===e&&this.source_appid&&(o.said=this.source_appid),-1===["t1","t2","t3"].indexOf(e)&&(o=Object.assign(o,{ccode:this.appChannelCode,path:a.default.isRuningMiniPro()?a.default.getCurrentFullUrl():"",sid:this.appShareId,sid2:this.appShareId2,scene:this.appOptionsScene,seid:this.appShareEventId})),t&&Object.assign(o,t),n.ext=a.default.filterEmptyKey(o),{userLog:n}}},{key:"getAppJSONConfig",value:function(e){return this.getJSONConfigPromise=this.getJSONConfigPromise||o.default.getTMAppConfig(),this.getJSONConfigPromise.then(function(t){return e?t[e]||{}:t})}},{key:"getJudgeConfigById",value:function(e){return this.getJudgeConfigPromise=this.getJudgeConfigPromise||o.default.getJudgeConfig(),this.getJudgeConfigPromise.then(function(t){return void 0!==e?t[e]||{}:t}).catch(function(){})}},{key:"getAppShowOptions",value:function(){var e=this;return new Promise(function(t,n){e.APP_SHOW_OPTIONS?t(e.APP_SHOW_OPTIONS):a.default.nextShow().then(function(n){e.APP_SHOW_OPTIONS=n,t(n)})})}},{key:"initSDK",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.appVersion,n=e.hideRequestLog;if(e.openId,!this.hasInitSDK){if(!t)throw s.RESPONSE.INIT_SDK_APP_VERSION_ERROR;this.appVersion=t,n&&this.hideRequestLog(),c.default.getShareTemplates(),this.hasInitSDK=!0}}},{key:"hideRequestLog",value:function(){o.default.REQUEST_LOG=!1,o.default.REQUEST_LOG||console.error("您已关闭SDK控制台打印日志，请在上线之前重新打开")}},{key:"navigateToMiniProgram",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.appId,r=t.path,i=t.extraData,o=void 0===i?{}:i,c=t.envVersion,d=void 0===c?"release":c,l=t.success,f=t.fail;d=a.default.parseQuery(r).destVersion||d;var h={appId:s.SDK_CONFIG.APPID,openId:u.default.userInfo.open_id};this.hasTiggerNavigate=!0,a.default.nextShow().then(function(){e.hasTiggerNavigate=!1}),wx.navigateToMiniProgram({appId:n,path:r,extraData:Object.assign(o,{mergeAccount:h}),envVersion:d,success:l,fail:function(){e.hasTiggerNavigate=!1,f&&f.apply(void 0,arguments)}})}},{key:"getRiskFactor",value:function(){return this.getRiskFactorPromise?this.getRiskFactorPromise:this.getRiskFactorPromise=o.default.getRiskFactor()}}]),e}())},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTigerStyle=t.tigerType=t.oldTigerCreativeType=t.PRE_TIGER_REFRESH=t.standardCanvasSize=t.demoWinSize=t.normalWxWinSize=t.exitAnimationType=t.AdvEnterAnimationType=t.clickAnimationType=t.AdvDynamicType=t.closeBtnX=t.closeBtnBg=t.videoTigerIcons=t.blinkTigerTipsIcon=t.blinkTigerCancelIcon=void 0;var r=i(n(6));function i(e){return e&&e.__esModule?e:{default:e}}var o=i(n(1)).default.RES_HOST+"/plat/SDK/sdk_img_res";t.blinkTigerCancelIcon=o+"/blink_tiger_cancel.png",t.blinkTigerTipsIcon=o+"/blink_tiger_tips.png",t.videoTigerIcons=o+"/tiger_video_icon.png",t.closeBtnBg=o+"/close_bg.png",t.closeBtnX=o+"/close_x.png",t.AdvDynamicType={none:0,easeInOut:1,shake:2,moveByY:3},t.clickAnimationType={none:0,scale:1},t.AdvEnterAnimationType={showToTop:-1,none:0,jumpFromTop:1},t.exitAnimationType={exitToBottom:-1,none:0},t.normalWxWinSize={width:375,height:667},t.demoWinSize={width:375,height:667},t.standardCanvasSize={landscape:{width:1920,height:1080},portrait:{width:1080,height:1920}},t.PRE_TIGER_REFRESH=6e5,t.oldTigerCreativeType={staticIcon:1,dynamicIcon:2,portraitBlinkPage:3,staticBox:4,dynamicBox:5,boxBanner:6,gameBanner:7,landscapeBlinkPage:8,recommend:9,testStaticAd:10,video:11,testDynamicAd:12},t.tigerType={floatIcon:1,blinkIcon:2,boxIcon:3,boxBanner:4,gameBanner:5,horizontalBlinkIcon:6,recommend:7,testAd:8,fakeVideo:9,intersititialAd:10},t.getTigerStyle=function(e){var t={width:0,height:0};if(e){var n=e.split("x");t={width:Number(n[0]),height:Number(n[1])}}return{1:{width:t.width,height:t.height},2:{width:r.default.getWinSize().width,height:r.default.getWinSize().height},6:{width:r.default.getWinSize().width,height:r.default.getWinSize().height},7:{width:375,height:120},9:{width:r.default.getWinSize().width,height:r.default.getWinSize().height},10:{width:t.width,height:t.height}}}},function(e,t,n){"use strict";var r;function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});var o=t.SDK_CONFIG={ENV:"prod",APPKEY:"aeb9287257a211ea97849b3b298b9ee9",APPID:"wxd05f277d60dfcef0",PROGRAM_ID:"aeb9287057a211ea97849b3b298b9ee9",PROGRAM_SECRET:"aeb9287157a211ea97849b3b298b9ee9",HAS_APPSECRET:!0,SDKVERSION:"2.6.8"};t.MAX_LOGIN_RETRY_TIMES=3,t.ACCESS_TOKEN_EXPIRED_CODE=[1304,1021,1022,1020],t.SPARE_HOSTS_LIST="test"===o.ENV?["https://test.kuaiyugo.com"]:["https://api.kuaiyugo.com","https://api.51yxstar.com","https://api.51staryule.com","https://api.51sfske.com"],t.MAX_PAY_RETRY_TIMES=5,t.PAY_RETRY_INTERVAL=1e3,t.RESPONSE=(i(r={NO_MERGE_ERROR:{message:"没有发起合并账户操作"},API_DISABLED:{message:"该接口或功能已停止使用"},API_DISABLED_WITHOUT_APPSECRET:{message:"由于该应用未提供appSecret, 该接口在当前应用无法使用"},INIT_SDK_ERROR:{err:1e5,message:"TM_SDK未初始化, 请先使用init()方法初始化"},INIT_SDK_APP_VERSION_ERROR:{err:100001,message:"appVersion 不能为空, 请传入正确的当前应用版本号"},REGION_ROLE_VARIABLE_NEED:{message:"缺少region或role必传参数"},CHECK_OLD_SDK_JOIN_UP:{message:"当前项目中存在不兼容的SDK，请确保项目中不包含以下SDK：xh_minipro_sdk、xh_minipro_statistic"},NO_AVAILABLE_HOST:{message:"NO_AVAILABLE_HOST"},CUSTOM_EVENT_ID_IS_NULL:{err:100100,message:"事件id必须为非空字符串"},CUSTOM_EVENT_DATA_LENGTH_EXCEED_LIMIT:{err:100101,message:"自定义事件参数data长度不能超过512"},CUSTOM_EVENT_KEY_NOT_LEGAL:{err:100102,message:"data参数中的value值都不能为undefined/null/NaN"},CUSTOM_EVENT_KEY_TYPE_ILLEGAL:{err:100103,message:"key的值必须为Number或者String类型"},CUSTOM_EVENT_VALUE_TYPE_ILLEGAL:{err:100104,message:"value的值必须为Number或者String类型"},CUSTOM_EVENT_KEY_LENGTH_EXCEED_LIMIT:{err:100105,message:"key的长度不能超过16"},CUSTOM_EVENT_VALUE_LENGTH_EXCEED_LIMIT:{err:100106,message:"value长度不能超过128"},CUSTOM_EVENT_DATA_EMPTY:{err:100107,message:"data参数为空，请传入data参数"},EVENT_CALLTIMES_LIMITS:{message:"每秒钟不能调用超过10次"}},"NO_AVAILABLE_HOST",{message:"NO_AVAILABLE_HOST"}),i(r,"CHECK_ORDER_TIME_OUT",{err:100200,message:"CHECK_ORDER_TIME_OUT"}),i(r,"USER_PAY_DISABLED_IOS",{err:100201,message:"USER_PAY_DISABLED_IOS"}),i(r,"USER_PAY_DISABLED_ANDROID",{err:100202,message:"USER_PAY_DISABLED_ANDROID"}),i(r,"USER_PAY_DISABLED",{err:100203,message:"USER_PAY_DISABLED"}),i(r,"PAY_FAIL",{err:100204,message:"PAY_FAIL"}),i(r,"PAY_UNKNOWN_ORDER_STATUS",{err:100205,message:"PAY_UNKNOWN_ORDER_STATUS"}),i(r,"USER_PAY_DISABLED_OTHER",{err:100206,message:"USER_PAY_DISABLED_OTHER"}),i(r,"USER_PAY_DISABLED_WINDOWS",{err:100207,message:"USER_PAY_DISABLED_WINDOWS"}),i(r,"PAY_SUCCESS",{message:"PAY_SUCCESS"}),i(r,"NO_AD_CONFIG",{message:"NO_AD_CONFIG"}),i(r,"H5PAY_CHECK_ORDER_TIME_OUT",{err:100300,message:"H5PAY_CHECK_ORDER_TIME_OUT"}),i(r,"H5PAY_FAIL_SELLER_DELIVER_FAIL",{err:100301,message:"H5PAY_FAIL_SELLER_DELIVER_FAIL"}),i(r,"H5PAY_FAIL_PAY_ERROR",{err:100302,message:"H5PAY_FAIL_PAY_ERROR"}),i(r,"H5PAY_FAIL_BUYER_NOT_PAY",{err:100303,message:"H5PAY_FAIL_BUYER_NOT_PAY"}),i(r,"H5PAY_FAIL_SELL_NOT_DELIVERY",{err:100304,message:"H5PAY_FAIL_SELL_NOT_DELIVERY"}),i(r,"H5PAY_UNKNOWN_ORDER_STATUS",{err:100305,message:"H5PAY_UNKNOWN_ORDER_STATUS"}),i(r,"H5_PAY_SUCCESS",{message:"H5_PAY_SUCCESS"}),r),t.STORAGE_KEYS={USER_TID_STORAGE_KEY:"XH_USER_TID",CHANNEL_CODE_STORAGE_KEY:"XH_CHANNEL_CODE",AUTH_CODE_INFO_STORAGE_KEY:"XH_AUTH_CODE_INFO",ACCESS_TOKEN_INFO_STORAGE_KEY:"ACCESS_TOKEN_INFO",ACCOUNT_MERGE_RECORDS_STORAGE_KEY:"ACCOUNT_MERGE_RECORDS",GET_NEW_DATE_ASTRICT_KEY:"GET_NEW_DATE",USER_INFO_STORAGE_KEY:"TM_USER_INFO"}},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=c(r(0)),a=c(r(1)),s=c(r(18)),u=r(4),d=c(r(9));function c(e){return e&&e.__esModule?e:{default:e}}var l=0,f=null,h=!1;n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.userInfo={},this.regionRoleInfo={},this.access_token="",this.waitForOpenIdCallBacks=[]}return i(e,[{key:"runWaitForOpenCallBacks",value:function(){this.waitForOpenIdCallBacks.forEach(function(e){return e()}),this.waitForOpenIdCallBacks=[]}},{key:"sendUserInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.openId,n=e.gender;if(!t)throw"请传入正确的openId";this.userInfo.open_id||(this.userInfo.open_id=t,this.userInfo.ofp2=(0,s.default)(t+"m9taxbK1"),this.userInfo.gender=void 0!==n?n:1,this.runWaitForOpenCallBacks())}},{key:"whenOpenIdIsReady",value:function(){var e=this;return new d.default(function(t,n){e.userInfo.open_id?t():e.waitForOpenIdCallBacks.push(function(){t()})})}},{key:"fetchUserInfo",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).openIdOnly;return f&&(void 0===t||t)?f.then(function(){return e.userInfo}):f=u.SDK_CONFIG.HAS_APPSECRET?Promise.resolve().then(function(){return o.default.promiseFy(wx.login)}).then(function(e){return a.default.postUserInfo({auth_mode:"default",wx_code:e.code})}).then(function(t){if(!t.nick_name){var n=o.default.getStorageSync(u.STORAGE_KEYS.USER_INFO_STORAGE_KEY+"_"+t.open_id);if(n)try{var r=JSON.parse(n);t.avatar_url=r.avatarUrl,t.nick_name=r.nickName,delete r.avatarUrl,delete r.nickName,Object.assign(t,r)}catch(e){}}return e.userInfo=t,l=0,h||(h=a.default.putUpdateMidasBalance().catch(function(){return h=!1})),e.runWaitForOpenCallBacks(),t}).catch(function(t){return 1026===t.err&&l<5?(l+=1,e.fetchUserInfo({openIdOnly:!1})):(l=0,Promise.reject(t))}):this.whenOpenIdIsReady().then(function(){return e.userInfo})}},{key:"getWxUserInfoAndSave",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.nick_name?e:t.nickName?(e.avatar_url=t.avatarUrl,e.nick_name=t.nickName,o.default.setStorageSync(u.STORAGE_KEYS.USER_INFO_STORAGE_KEY+"_"+e.open_id,JSON.stringify(t)),delete t.avatarUrl,delete t.nickName,Object.assign({},e,t)):e}},{key:"updateUserInfo",value:function(e){var t=this,n=null;return Promise.resolve().then(function(){return o.default.promiseFy(wx.login)}).then(function(e){return n=e.code}).then(function(){return o.default.promiseFy(wx.getUserInfo)}).then(function(e){return a.default.postUserInfo({auth_mode:"full",wx_code:n,wx_encrypted_data:e.encryptedData,wx_iv:e.iv,wx_signature:e.signature}).then(function(n){return t.getWxUserInfoAndSave(n,e.userInfo)}).catch(function(){return t.getWxUserInfoAndSave(t.userInfo,e.userInfo)})}).then(function(e){t.userInfo=e,l=0;var n=o.default.deepClone(e);return delete n.is_new,n}).catch(function(n){return 1026===n.err&&l<5?(l+=1,t.updateUserInfo(e)):(l=0,Promise.reject(n))})}}]),e}())},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=u(r(20)),a=u(r(21)),s=r(3),c=u(r(0));function u(e){return e&&e.__esModule?e:{default:e}}var d={};n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.wxWinSize=null}return i(e,[{key:"cocosSetNodeImage",value:function(e,t,n){return new Promise(function(r,i){if(!(e&&e instanceof cc.Node))return i(new Error("请传入正确的节点"));if(t){var o=function(e,t){if(cc.isValid(e)){var r=e.getComponent(cc.Sprite)||e.getComponent(cc.Mask);if(n){var i=n.rectX||0,o=n.rectY||0,a=n.rectW||0,s=n.rectH||0,u=n.rectXPercent,c=n.rectYPercent,d=n.rectWPercent,l=n.rectHPercent,f=u>=0&&u<1?t.width*u:i,h=c>=0&&c<1?t.height*c:o,p=d>=0&&d<=1?t.width*d:a,g=l>=0&&l<=1?t.height*l:s,y=cc.rect(f,h,p,g);r.spriteFrame=new cc.SpriteFrame(t,y)}else r.spriteFrame=new cc.SpriteFrame(t);return r.spriteFrame}};d[t]?r(o(e,d[t])):0===t.indexOf(wx.env.USER_DATA_PATH)?cc.loader.load(t,function(n,i){d[t]=i,o(e,i),r()}):c.default.wxImageLoader(t).then(function(n){if(cc.isValid(e)&&e.active){var i=new cc.Texture2D;i.initWithElement(n),i.handleLoadedTexture(),d[t]=i,r(o(e,i))}}).catch(i)}else console.warn("请传入正确的资源路径")})}},{key:"scaleSizeInWxWindow",value:function(e){var t=this.wxWinSize||wx.getSystemInfoSync();return e*(s.normalWxWinSize.width/t.screenWidth)}},{key:"scaleSizeInCanvas",value:function(e){return e*(this.getWinSize().width/s.demoWinSize.width)}},{key:"runAction",value:function(e,t,n){c.default.isCocosGame()?o.default.show(e,t,n):c.default.isLayaGame()&&a.default.show(e,t,n)}},{key:"runEnterSceneAction",value:function(e,t,n){return c.default.isCocosGame()?o.default.enter(e,t,n):c.default.isLayaGame()?a.default.enter(e,t,n):Promise.resolve()}},{key:"runExitSceneAction",value:function(e,t,n){return new Promise(function(r,i){c.default.isCocosGame()?o.default.exit(e,t,n).then(function(){r()}):c.default.isLayaGame()?a.default.exit(e,t,n).then(function(){r()}):r()})}},{key:"sceneIsInit",value:function(){return!!(c.default.isCocosGame()&&cc&&cc.director&&cc.director.getScene()||c.default.isLayaGame()&&Laya&&Laya.stage)||(console.error("[createTiger]: 场景未初始化"),!1)}},{key:"getSceneChildByName",value:function(e){return this.sceneIsInit()?c.default.isCocosGame()?cc.director.getScene().getChildByName(e):c.default.isLayaGame()?Laya.stage.getChildByName(e):null:null}},{key:"createMaskNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.parent,r=t.maskNodeStyle,i=t.innerNodeStyle,o={},a={};return c.default.isCocosGame()?(o=this.createCocosMaskNode("mask_node",{parent:r.rectNode?r.rectNode:n,style:r}),a=this.createNode(e,{parent:o,style:i})):c.default.isLayaGame()&&(a=this.createNode(e,{parent:n,style:i}),o=this.createLayaMaskNode("mask_node",{parent:r.rectNode?r.rectNode:a,style:r})),{innerNode:a,maskNode:o}}},{key:"createLayaMaskNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.parent,r=t.style;if(c.default.isLayaGame()){var i=r.type;if("ELLIPSE"===i){var o=new Laya.Sprite;this.createGraphics(o,{width:r.width,height:r.height,radius:r.height/2}),r&&this.setStyle(o,r),n.mask=o}else"RECT"===i&&(n.scrollRect=new Laya.Rectangle(0,0,r.width,r.height));return n}}},{key:"createCocosMaskNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.parent,r=t.style;if(c.default.isCocosGame()){var i=this.createNode(e,{parent:n,style:r}),o=r.type;if(o){var a=i.addComponent(cc.Mask);a&&["RECT","ELLIPSE"].includes(o)&&(a.type=cc.Mask.Type[o]||a.type)}return i}}},{key:"addChild",value:function(e,t){c.default.isCocosGame()?e?this.isDestroy(e)||e.addChild(t):cc.director.getScene().addChild(t):c.default.isLayaGame()&&(e?this.isDestroy(e)||e.addChild(t):Laya.stage.addChild(t))}},{key:"createLabelNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.parent,r=t.style,i="";return c.default.isCocosGame()?(i=new cc.Node(e)).addComponent(cc.Label):c.default.isLayaGame()&&(i=new Laya.Text),this.addChild(n,i),r&&this.setStyle(i,r),i}},{key:"transparentColor",value:function(e){var t=(e=e.replace(/[^0-9,]/g,"")).split(",").map(function(e){return Number(e)});return c.default.isCocosGame()?new(Function.prototype.bind.apply(cc.Color,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t)))):c.default.isLayaGame()?"#"+(t=t.slice(0,3).map(function(e){return e.toString(16)})).join(""):void 0}},{key:"setScrollViewNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isDestroy(e))if(c.default.isCocosGame()){var n=e.addComponent(cc.ScrollView);if(t)for(var r in t)t.hasOwnProperty(r)&&["vertical","content","horizontal"].includes(r)&&(n[r]=t[r])}else if(c.default.isLayaGame()&&t.horizontal&&t.content){var i=t.content,o=0,a=0,s=0,u=0,d=!1;e.on(Laya.Event.MOUSE_DOWN,e,function(t){s=i.x,u=i.width-e.width,o=Laya.stage.mouseX,d=!0}),e.on(Laya.Event.MOUSE_MOVE,e,function(e){d&&(a=Laya.stage.mouseX-o,i.x=s+a)}),e.on(Laya.Event.MOUSE_OUT,e,function(e){if(d){var t=i.x+a;t=u>0?t>0?0:t<-u?-u:t:0,Laya.Tween.to(i,{x:t},500,Laya.Ease.quadOut),o=0,a=0,s=0,u=0,d=!1}})}}},{key:"createNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.parent,r=t.style,i={};return c.default.isCocosGame()?i=new cc.Node(e):c.default.isLayaGame()&&((i=new Laya.Sprite).name=e),this.addChild(n,i),r&&this.setStyle(i,r),i}},{key:"setLabelStyle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(c.default.isCocosGame()){var n=e.getComponent(cc.Label);if(n){for(var r in t)if(t.hasOwnProperty(r))switch(r){case"horizontalAlign":t[r]=t[r].toUpperCase(),["LEFT","CENTER","RIGHT"].includes(t[r])&&(n[r]=cc.Label.HorizontalAlign[t[r]]);break;case"overflow":t[r]=t[r].toUpperCase(),["CLAMP","NONE"].includes(t[r])&&(n[r]=cc.Label.Overflow[t[r]]);break;case"color":void 0!==t[r]&&(e.color=this.transparentColor(t.color));break;default:n[r]=t[r]||n[r]}e.setContentSize(e.tigerWidth,e.tigerHeight)}}else if(c.default.isLayaGame()){var i=e;for(var o in t)if(t.hasOwnProperty(o)){var a=t[o];switch(o){case"string":i.text=a;break;case"horizontalAlign":["left","center","right"].includes(a)&&(i.align=a);break;case"verticalAlign":["top","center","bottom"].includes(a)&&(i.valign={top:"top",center:"middle",bottom:"bottom"}[a]);break;case"color":i.color=this.transparentColor(t.color);break;case"overflow":["clamp"].includes(a)&&(i.overflow={clamp:"hidden",none:"visible"}[a]);break;case"font":case"fontSize":i[o]=a||i[o]}}}}},{key:"getChildByName",value:function(e,t){if(c.default.isCocosGame()){if(e.getChildByName)return e.getChildByName(t);if(e.children&&e.children.length){var n=!0,r=!1,i=void 0;try{for(var o,a=e.children[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.name===t)return s}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}}else if(c.default.isLayaGame()){if(e.getChildByName)return e.getChildByName(t);if(e._children&&e._children.length){var u=!0,d=!1,l=void 0;try{for(var f,h=e._children[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var p=f.value;if(p.name===t)return p}}catch(e){d=!0,l=e}finally{try{!u&&h.return&&h.return()}finally{if(d)throw l}}}}}},{key:"createGraphics",value:function(e,t){var n=t.width,r=t.height,i=t.opacity,o=t.color,a=t.radius;if(i=i||0,o=o||"0,0,0",a=a||0,c.default.isCocosGame()){(i=Math.ceil(255*i))&&(o+=","+i);var s=e.getComponent(cc.Graphics)||e.addComponent(cc.Graphics);s.clear(),s.fillColor=this.transparentColor(o),c.default.getCocosMainVersion()>=2?s.roundRect(-n/2,-r/2,n,r,a):c.default.getCocosMainVersion()<2&&s.roundRect(0,0,n,r,a),s.fill()}else if(c.default.isLayaGame()){if(e.graphics.clear(),e.graphics.save(),e.graphics.alpha(1-i),a){var u=n-a,d=r-a,l=[["moveTo",a,0],["lineTo",u,0],["arcTo",n,0,n,a,a],["lineTo",n,d],["arcTo",n,r,u,r,a],["lineTo",a,r],["arcTo",0,r,0,d,a],["lineTo",0,a],["arcTo",0,0,a,0,a]];e.graphics.drawPath(0,0,l,{fillStyle:this.transparentColor(o)})}else e.graphics.drawRect(0,0,n,r,this.transparentColor(o));e.graphics.restore()}}},{key:"setStyle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.width,r=t.height,i=t.x,o=t.y,a=t.zIndex,s=t.opacity,u=t.bgStyle,d=t.fontStyle;if(t.maskType,!this.isDestroy(e)&&(c.default.isCocosGame()?(void 0!==n&&void 0!==r&&(e.setContentSize(n,r),e.tigerWidth=n,e.tigerHeight=r),void 0!==i&&void 0!==o&&(e.position=this.getStylePosition(e,{width:n,height:r,x:i,y:o})),void 0!==s&&(e.opacity=s),e.zIndex=void 0!==a?a:1):c.default.isLayaGame()&&(void 0!==i&&void 0!==o&&(e.x=i,e.y=o),e.zOrder=void 0!==a?a:1,void 0!==n&&void 0!==r&&(e.tigerWidth=n,e.tigerHeight=r,e.width=n,e.height=r,e.scrollRect&&(e.scrollRect=new Laya.Rectangle(0,0,n,r)))),d&&this.setLabelStyle(e,d),void 0===i&&void 0===o&&void 0===n&&void 0===r||(u=u||e.bgStyle),void 0!==u)){var l=this.getChildByName(e,"engineApiBgNode")||this.createNode("engineApiBgNode",{parent:e,style:{x:0,y:0,width:n,height:r,zIndex:0}});this.createGraphics(l,{width:n,height:r,opacity:u.opacity,color:u.color,radius:u.radius}),e.bgStyle=u}}},{key:"getStylePosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.width,r=void 0===n?0:n,i=t.height,o=void 0===i?0:i,a=t.x,s=t.y;if(c.default.isCocosGame()&&!this.isDestroy(e)){var u=!this.isDestroy(e.parent),d=this.getWinSize(),l=e.parent&&this.getSceneId()==this.getNodeId(e.parent);return u||(e.parent={width:0,height:0,anchorX:0,anchorY:0}),{x:r*e.anchorX-(l?d.width:e.parent.width)*e.parent.anchorX+a,y:(l?d.height:e.parent.height)*(1-e.parent.anchorY)-o*(1-e.anchorY)-s}}return{x:a,y:s}}},{key:"setNodeClickScaleTransition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.duration,r=void 0===n?.1:n,i=t.scale,o=void 0===i?1.2:i;if(!this.isDestroy(e))if(c.default.isCocosGame()){var a=e.getComponent(cc.Button);a||(a=e.addComponent(cc.Button)),a.transition=cc.Button.Transition.SCALE,a.duration=Number(r),a.zoomScale=Number(o)}else if(c.default.isLayaGame()){var s=e.width,u=e.height,d=e.x,l=e.y;e.on(Laya.Event.MOUSE_DOWN,e,function(t){e.scale(o,o),e.x=d-(o*s-s)/2,e.y=l-(o*u-u)/2}),e.on(Laya.Event.MOUSE_OUT,e,function(t){e.scale(1,1),e.x=d,e.y=l})}}},{key:"getWinSize",value:function(){return this.sceneIsInit()?c.default.isCocosGame()?{width:cc.winSize.width,height:cc.winSize.height}:c.default.isLayaGame()?{width:Laya.stage.width,height:Laya.stage.height}:s.standardCanvasSize:s.standardCanvasSize}},{key:"getSceneId",value:function(){if(this.sceneIsInit()){var e=c.default.isCocosGame()?cc.director.getScene():c.default.isLayaGame()?Laya.stage.$_GID:null;return this.getNodeId(e)}}},{key:"getNodeId",value:function(e){return this.sceneIsInit()&&e?c.default.isCocosGame()?e._id:c.default.isLayaGame()?e.$_GID:void 0:void 0}},{key:"loadImage",value:function(e,t,n){var r=this;return new Promise(function(i,o){if(r.isDestroy(e))return o(new Error("[loadImage] 节点不存在"));if(c.default.isCocosGame()){var a=e.getComponent(cc.Sprite);a||(a=e.addComponent(cc.Sprite)),a.sizeMode=cc.Sprite.SizeMode.CUSTOM,r.cocosSetNodeImage(e,t,n).then(function(){e.setContentSize(e.tigerWidth,e.tigerHeight),i()}).catch(o)}else if(c.default.isLayaGame()){var s=(Laya.version&&Laya.version.split(".")[0])>=2;Laya.loader.load(t,Laya.Handler.create(Laya,function(){var r=Laya.loader.getRes(t);if(n){e.graphics.clear();var o=n.rectX||0,a=n.rectY||0,u=n.rectW||e.width,c=n.rectH||e.height,d=Laya.Texture.create(r,o,a,u,c);s?e.graphics.drawImage(d,0,0,e.tigerWidth,e.tigerHeight):e.graphics.drawTexture(d,0,0,e.tigerWidth,e.tigerHeight),i()}else s?e.loadImage(t):(e.graphics.clear(),e.loadImage(t,0,0,e.tigerWidth,e.tigerHeight)),i()}))}else o(new Error("当前引擎环境不兼容此方法"))})}},{key:"isVisible",value:function(e){return!this.isDestroy(e)&&(c.default.isCocosGame()?e.active:!!c.default.isLayaGame()&&e.visible)}},{key:"isDestroy",value:function(e){return!e||(c.default.isCocosGame()?!cc.isValid(e):!!c.default.isLayaGame()&&e.destroyed)}},{key:"isNowScene",value:function(e){return this.getSceneId()===e}},{key:"bindTap",value:function(e){var t=e.node,n=e.type,r=e.callback;if(c.default.isCocosGame()||c.default.isLayaGame())switch(n){case"touch":default:this.bindTouch(t,r)}else console.warn("[bindTap] 当前引擎环境不兼容此方法")}},{key:"bindTouch",value:function(e,t){if(c.default.isCocosGame())cc.isValid(e)&&(e.getComponent(cc.Button)||e.addComponent(cc.Button),"Function"===c.default.getVariableType(t)&&e.on("click",t));else if(c.default.isLayaGame()){if("Function"===c.default.getVariableType(t)){var n=0,r=0;e.on(Laya.Event.MOUSE_DOWN,e,function(){e.parent&&(n=e.parent.x,r=e.parent.Y)}),e.on(Laya.Event.MOUSE_UP,e,function(){e.parent?n==e.parent.x&&r==e.parent.Y&&t():t()})}}else console.warn("[bindTap] 当前引擎环境不兼容此方法")}},{key:"hideNode",value:function(e){this.isDestroy(e)||(c.default.isCocosGame()?e.active=!1:c.default.isLayaGame()&&(e.visible=!1))}},{key:"showNode",value:function(e){this.isDestroy(e)||(c.default.isCocosGame()?e.active=!0:c.default.isLayaGame()&&(e.visible=!0))}}]),e}())},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(r(1)),a=s(r(2)),u=s(r(5));function s(e){return e&&e.__esModule?e:{default:e}}n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"send",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments[1];return u.default.whenOpenIdIsReady().then(function(){var n=a.default.packLogData(e,t);return o.default.postBehaviorLog(n)})}}]),e}())},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=c(r(0)),a=c(r(6)),s=c(r(10)),u=r(3),d=c(r(23));function c(e){return e&&e.__esModule?e:{default:e}}var l={},f=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.mainNodeName=null,e.winSize=a.default.getWinSize(),e.sceneId=a.default.getSceneId(),e.isLandScape=e.winSize.width>e.winSize.height,e.scaleToStandardCanvasSize=e.isLandScape?u.standardCanvasSize.landscape.width/e.winSize.width:u.standardCanvasSize.portrait.width/e.winSize.width,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.default),i(t,[{key:"getCornerClickCatch",value:function(e){return l[e]}},{key:"setCornerClickCatch",value:function(e){l[e]=!0}},{key:"getMainNodeZIndex",value:function(e){var t=o.default.isCocosGame()&&cc.macro.MAX_ZINDEX||999999999;switch(e){case u.tigerType.fakeVideo:return t;case u.tigerType.blinkIcon:case u.tigerType.horizontalBlinkIcon:case u.tigerType.intersititialAd:return t-1;case u.tigerType.recommend:return t-2;case u.tigerType.floatIcon:return t-3}}},{key:"getDefaultStyle",value:function(e){if(e){var t=e.split("x");return{width:Number(t[0]),height:Number(t[1])}}return{width:0,height:0}}},{key:"checkNodeHasInit",value:function(){var e=this;return new Promise(function(t,n){a.default.getSceneChildByName(e.mainNodeName)?n(new Error("该组件已存在")):t()})}},{key:"getConfigAndSendRenderLog",value:function(e){return s.default.getList({positionId:e})}},{key:"navigate",value:function(e){var t=e.positionId,n=e.creativeId;return s.default.navigate({positionId:t,creativeId:n})}},{key:"checkTigerCanRender",value:function(e){return e?o.default.isRuningMiniGame()?o.default.isCocosGame()||o.default.isLayaGame()?a.default.sceneIsInit()?s.default.getConfig({positionId:e}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.isOpen?[u.tigerType.recommend,u.tigerType.intersititialAd,u.tigerType.fakeVideo,u.tigerType.floatIcon,u.tigerType.blinkIcon,u.tigerType.horizontalBlinkIcon].includes(e.type)?e:Promise.reject(new Error("暂不支持该类型进行UI渲染")):Promise.reject(new Error("创建错误: 远端配置未开启或创意为空"))}):Promise.reject(new Error("场景未渲染完成，创建失败")):Promise.reject(new Error("该API只支持cocos或laya引擎环境使用")):Promise.reject(new Error("请在微信小游戏环境下使用")):Promise.reject(new Error("请传入正确的positionId"))}},{key:"countScaleToStandardCanvasSize",value:function(e){return e/this.scaleToStandardCanvasSize}}]),t}();n.default=f},function(t,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s={PENDING:0,FULLFILED:1,REJECTED:2},u=new WeakMap,c=function(){function e(t){i(this,e),this.thenList=[],this.catchList=[],this.promiseData={cb:t,status:s.PENDING}}return a(e,[{key:"getResolveFn",value:function(){var e=this,t=this.promiseData;return function(n){t.status===s.PENDING&&(t.result=n,t.status=s.FULLFILED,e.consumeThenList(),e.consumeCatchList())}}},{key:"getRejectFn",value:function(){var e=this,t=this.promiseData;return function(n){t.status===s.PENDING&&(t.result=n,t.status=s.REJECTED,e.consumeThenList(),e.consumeCatchList())}}},{key:"resolveThenItem",value:function(e){var t=this.promiseData.result;try{e.result=e.successCb(t)}catch(t){return void e.thenDigestor(t,s.REJECTED)}e.thenDigestor(e.result,s.FULLFILED)}},{key:"rejectThenItem",value:function(e){var t=this.promiseData.result;if(e.failCb)try{e.result=e.failCb(t),e.thenDigestor(e.result,s.FULLFILED)}catch(t){e.thenDigestor(t,s.REJECTED)}else e.thenDigestor(t,s.REJECTED)}},{key:"getDigestor",value:function(e,t){return function n(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.FULLFILED;r instanceof d||r instanceof Promise?r.then(function(e){n(e,s.FULLFILED)}).catch(function(e){n(e,s.REJECTED)}):i===s.FULLFILED?e(r):i===s.REJECTED&&t(r)}}},{key:"consumeThenList",value:function(){var e=this.promiseData.status,t=this.thenList;if(e!==s.PENDING)for(var n=void 0;n=t.shift();)e===s.FULLFILED?this.resolveThenItem(n):e===s.REJECTED&&this.rejectThenItem(n)}},{key:"consumeCatchList",value:function(){var e=this.promiseData,t=e.status,n=e.result,r=this.catchList;if(t!==s.PENDING)for(var i=void 0;i=r.shift();)if(t===s.FULLFILED)try{i.catchDigestor(n,s.FULLFILED)}catch(e){i.catchDigestor(e,s.REJECTED)}else if(t===s.REJECTED)try{i.result=i.errHandler(n),i.catchDigestor(i.result,s.FULLFILED)}catch(e){i.catchDigestor(e,s.REJECTED)}}}]),e}(),d=function(){function e(t){if(i(this,e),!t)throw new Error("simplePromise resolver undefined is not a function");var n=new c(t);u.set(this,n),this.promiseData=n.promiseData;try{t(n.getResolveFn(),n.getRejectFn())}catch(e){n.promiseData.status===s.PENDING&&(n.promiseData.status=s.REJECTED,n.promiseData.result=e,n.consumeCatchList())}}return a(e,[{key:"then",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=arguments[1],r=u.get(this),i={successCb:t,failCb:n};return r.thenList.push(i),new e(function(e,t){i.thenDigestor=r.getDigestor(e,t),r.consumeThenList()})}},{key:"catch",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=u.get(this),r={errHandler:t};return n.catchList.push(r),new e(function(e,t){r.catchDigestor=n.getDigestor(e,t),n.consumeCatchList()})}}]),e}();d.resolve=function(e){return new d(function(t){return t(e)})},d.reject=function(e){return new d(function(t,n){return n(e)})},d.all=function(e){var t=null,n=!1,r=e.map(function(e){return{filled:!1}}),i=d.resolve("wow");return e.forEach(function(e,o){i=i.then(function(t){return e.then(function(e){r[o]={filled:!0,result:e}})}).catch(function(e){n||(n=!0,t=e)})}),i.then(function(){return r.filter(function(e){return!e.filled}).length>0?d.reject(t):d.resolve(r.map(function(e){return e.result}))})},r.default=d},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=d(r(0)),a=d(r(1)),s=r(4),u=r(3),c=d(r(2)),l=d(r(13));function d(e){return e&&e.__esModule?e:{default:e}}var f={},h={},g={},y={},v=function(e,t){var n=null;if(h[e]){var r=!0,i=!1,a=void 0;try{for(var s,u=h[e].creatives[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var c=s.value;if(c.creative_id==t){n=o.default.deepClone(c);break}}}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}}return n},m=function(e){return(e=o.default.deepClone(e)).creatives&&e.creatives.length&&e.creatives.forEach(function(e){e.positionId=e.tiger_position_id,e.creativeId=e.creative_id,delete e.tiger_master_id,delete e.tiger_plan_id,delete e.tiger_group_id,delete e.flow_owner_id,delete e.is_default,delete e.redirect_app_id,delete e.redirect_path,delete e.redirect_version,delete e.redirect_extra_data,delete e.channel_code,delete e.production_app_id,delete e.tiger_position_id,delete e.creative_id}),delete e.is_click_change,e},S=function(e,t,n){var r=Date.now(),i=o.default.deepClone(h[e]);y[e]=y[e]||Date.now();var s=!!y[e]&&r-y[e]<u.PRE_TIGER_REFRESH;if(i&&i.creatives&&i.creatives.length>0&&s){var c=[];if(n||!i.isOpen)return Promise.resolve({isOpen:i.isOpen,type:i.type,creatives:[]});if(i.type===u.tigerType.recommend){for(var d=null,l=[],p=0;p<i.creatives.length;p++)t&&i.creatives[p].creative_id==t?d=i.creatives[p]:l.push(i.creatives[p]);d&&l.push(d),h[e].creatives=o.default.deepClone(l),c=l.slice(0,h[e].render_max)}else i.creatives.length>1?(g[e]+=1,g[e]>i.creatives.length-1&&(g[e]=0)):g[e]=0,c=[i.creatives[g[e]]];return Promise.resolve(Object.assign(i,{creatives:c}))}return f[e]&&s?f[e]:f[e]=function(e,t){return a.default.getFlowList({positionId:e}).then(function(n){if(n.isOpen){n.creatives=n.creatives||[];var r;return h[e]=o.default.deepClone(n),g[e]=t?-1:0,y[e]=Date.now(),r=n.type===u.tigerType.recommend?n.creatives.slice(0,n.render_max):[n.creatives[0]],n.creatives=r,n}return g[e]=0,{isOpen:!1,creatives:[]}}).catch(function(t){return console.error("请求错误: "+e+" "+(t?JSON.stringify(t):"")),g[e]=0,{isOpen:!1,creatives:[]}})}(e,n)};n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"formatTigerToOld",value:function(e){if(!e.isOpen)return{is_open:e.isOpen};var t=e.creatives.map(function(t){switch(e.type){case u.tigerType.floatIcon:t.show_config.fps&&t.show_config.images?t.type=u.oldTigerCreativeType.dynamicIcon:t.type=u.oldTigerCreativeType.staticIcon;break;case u.tigerType.blinkIcon:t.type=u.oldTigerCreativeType.portraitBlinkPage;break;case u.tigerType.boxIcon:t.show_config.fps&&t.show_config.images?t.type=u.oldTigerCreativeType.staticBox:t.type=u.oldTigerCreativeType.dynamicBox;break;case u.tigerType.boxBanner:t.type=u.oldTigerCreativeType.boxBanner;break;case u.tigerType.gameBanner:t.type=u.oldTigerCreativeType.gameBanner;break;case u.tigerType.horizontalBlinkIcon:t.type=u.oldTigerCreativeType.landscapeBlinkPage;break;case u.tigerType.recommend:t.type=u.oldTigerCreativeType.recommend;break;case u.tigerType.testAd:t.show_config.fps&&t.show_config.images?t.type=u.oldTigerCreativeType.testDynamicAd:t.type=u.oldTigerCreativeType.testStaticAd}return e.hasOwnProperty("auto_change")&&t.show_config&&(t.show_config.auto_change=e.auto_change),e.hasOwnProperty("position_show_type")&&(t.position_show_type=e.position_show_type),e.hasOwnProperty("render_max")&&(t.render_max=e.render_max),t.tiger_position_id=t.positionId,t.creative_id=t.creativeId,t.is_open=e.isOpen,delete t.positionId,delete t.creativeId,t});return e.type===u.tigerType.recommend?{tiger_position_id:t[0].tiger_position_id,type:t[0].type,is_open:e.isOpen,list:t}:(t[0].is_open=e.isOpen,t[0])}},{key:"sendVideoCloseLog",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.list,n=e.isEnded,r=e.timeLastShow,i=t[0].positionId,o=t[0].creativeId,a=v(i,o);l.default.sendBehaviour("close",{list:[a],isEnded:n,timeLastShow:r})}},{key:"navigate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.positionId,r=t.creativeId;return new Promise(function(t,i){if(!n)throw"参数错误，请传入正确的positionId";if(!r)throw"参数错误，请传入正确的creativeId";var a=e,d=v(n,r);if(!d||!d.show_config)throw"该参数: "+n+":"+r+", 在列表中不存在或配置为空，请先获取配置列表";var f=c.default.packLogData().userLog.ext;function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,n){var r=e.tiger_position_id,i=h[r]?h[r]:{};i.is_click_change||i.type==u.tigerType.recommend?a.getList({positionId:e.tiger_position_id,creativeId:e.creative_id||""}).then(t).catch(n):t(m(Object.assign(i,{creatives:[e]})))})}f.v=s.SDK_CONFIG.SDKVERSION,l.default.sendBehaviour("click",{list:[d]}),c.default.navigateToMiniProgram({appId:d.redirect_app_id,path:d.redirect_path,extraData:Object.assign({tiger_info:f,tiger_list:[d],channelCode:d.channel_code},o.default.parseQuery(d.redirect_extra_data)),envVersion:d.redirect_version,success:function(e){l.default.sendBehaviour("confirm",{list:[d]}),p(d).then(function(n){n.navigateMessage=e,t(n)}).catch(i)},fail:function(e){e&&e.errMsg&&e.errMsg.indexOf("cancel")>-1?l.default.sendBehaviour("cancel",{list:[d]}):(l.default.sendBehaviour("404",{list:[d],errMsg:JSON.stringify(e)}),console.error("跳转失败，请检查game.json(小游戏)/app.json(小程序)跳转列表是否配置正确")),p(d).then(function(n){n.navigateMessage=e,t(n)}).catch(i)}})})}},{key:"getList",value:function(e){var t=e.positionId,n=e.creativeId;return t?Promise.resolve().then(function(){return S(t,n,!1)}).then(function(e){return function(e){return e.creatives&&e.creatives.length&&l.default.sendBehaviour("render",{list:e.creatives}),m(e)}(e)}):Promise.reject(new Error("参数positionId不能为空!"))}},{key:"getConfig",value:function(e){var t=e.positionId;return t?Promise.resolve().then(function(){return S(t,null,!0)}).then(function(e){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.type?{isOpen:e.isOpen,type:e.type}:{isOpen:e.isOpen}}(e)}):Promise.reject(new Error("参数positionId不能为空!"))}}]),e}())},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=d(r(1)),a=d(r(0)),s=d(r(5)),u=d(r(2)),c=r(4),l=d(r(7));function d(e){return e&&e.__esModule?e:{default:e}}var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e=a.default.deepClone(e)).channelCode;l.default.send("share",{sccode:t}),u.default.isSharing=!0;var n=s.default.userInfo.open_id,r=u.default.appShareId,i=u.default.appShareId2,o=e.success||function(){},c=e.cancel||function(){},d=u.default.getShareEventId(),f={seid:d};if(t&&(f.channelCode=t),i&&r?(r=i,i=n):r?i=n:r=n,a.default.isRuningMiniPro()){Object.assign(f,r?{shareId:r}:{}),Object.assign(f,i?{shareId2:i}:{});var h=e.path;e.path=h?a.default.addQuery(h,f):a.default.addQuery(a.default.getCurrentRoute(),f)}else{Object.assign(f,r?{sid:r}:{}),Object.assign(f,i?{sid2:i}:{});var p=e.query;e.query=p?p+"&"+a.default.stringifyQuery(f):a.default.stringifyQuery(f)}var g=Date.now();return a.default.nextShow().then(function(){var e=Date.now()-g;u.default.isSharing=!1,e>=3e3?(l.default.send("sharesuccess"),o({errMsg:"shareAppMessage:ok",shareEventId:d})):(l.default.send("sharecancel"),c({errMsg:"shareAppMessage:cancel"}))}),delete e.success,delete e.cancel,console.log("shareConfig",e),e};n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.shareTemplatesPromise=null,this.shareTemplatesCache=null}return i(e,[{key:"onAppShareMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.scene){var t=this.getShareConfigInCache(e.scene);e={title:e.title||t.title,imageUrl:e.imageUrl||t.imageUrl,channelCode:e.channelCode||t.channelCode,query:e.query,success:e.success,cancel:e.cancel}}return f(e)}},{key:"shareGameMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.scene){var t=this.getShareConfigInCache(e.scene);wx.shareAppMessage(f({title:e.title||t.title,imageUrl:e.imageUrl||t.imageUrl,channelCode:e.channelCode||t.channelCode,query:e.query,success:e.success,cancel:e.cancel}))}else wx.shareAppMessage(f(e))}},{key:"onShareGameMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};wx.onShareAppMessage(function(){var n=t();if(n.scene){var r=e.getShareConfigInCache(n.scene);n={title:r.title,imageUrl:r.imageUrl,channelCode:r.channelCode,query:n.query,success:n.success,cancel:n.cancel}}return f(n)})}},{key:"getShareConfigInCache",value:function(e){if(!u.default.hasInitSDK)throw c.RESPONSE.INIT_SDK_ERROR;if(this.shareTemplatesCache){var t=this.shareTemplatesCache[e];if(t&&t.length){var n=a.default.getRandomNumber(0,t.length-1);return{title:t[n].title,imageUrl:t[n].image,channelCode:t[n].channel_code}}return console.error("该scene值下未配置任何分享素材"),{}}}},{key:"getGroupIdAndRank",value:function(){return u.default.getAppShowOptions().then(function(e){var t=e.shareTicket,n="",r=e.query.seid;return a.default.isRuningMiniPro()?n=e.query.shareId2||e.query.shareId:a.default.isRuningMiniGame()&&(n=e.query.sid2||e.query.sid),r&&t&&n?s.default.fetchUserInfo().then(function(e){return a.default.promiseFy(wx.getShareInfo,{shareTicket:t}).then(function(e){var t=e.encryptedData,i=e.iv;if(t&&i)return o.default.getGroupIdAndRank({share_open_id:n,share_id:r,wx_encrypted_data:t,wx_iv:i}).then(function(e){return e.shareEventId=r,e})})}):Promise.reject(new Error("当前启动场景非群卡片进入，无法获取群id"))})}},{key:"getShareTemplates",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.version,r=t.noCache,i=void 0!==r&&r;return this.shareTemplatesPromise&&!i?this.shareTemplatesPromise:this.shareTemplatesPromise=o.default.getShareTemplate({version:n}).then(function(t){return e.shareTemplatesCache=t,t}).catch(function(){})}}]),e}())},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(r(1)),a=s(r(5)),u=s(r(7));function s(e){return e&&e.__esModule?e:{default:e}}var c="abtest计划id不能为空！";n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.runningAbtestGroup=[],this.abtestUserGroupPromiseCache=null}return i(e,[{key:"start",value:function(e){var t=this;return!(e=Number(e))||isNaN(e)?(console.error(c),Promise.reject(new Error(c))):a.default.fetchUserInfo().then(function(){return t.getAbtestUserGroup()}).then(function(n){if(!n||0===n.length)return{};var r=n.find(function(t){return t.planId===e});return r?(t.runningAbtestGroup.some(function(t){return t.planId===e})||t.runningAbtestGroup.push(r),u.default.send("abtest"),r):(console.error("该abtest计划id在abtest后台配置中不存在！"),{})})}},{key:"getAbtestUserGroup",value:function(){return this.abtestUserGroupPromiseCache?this.abtestUserGroupPromiseCache:this.abtestUserGroupPromiseCache=o.default.getAbtestUserGroup()}}]),e}())},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(4),a=c(r(1)),s=c(r(0)),u=c(r(2)),d=c(r(5));function c(e){return e&&e.__esModule?e:{default:e}}var l="test"===o.SDK_CONFIG.ENV?10:100,f={},h={};n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"sendTigerLogin",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d.default.fetchUserInfo().then(function(n){if(t.scene=t.scene&&Number(t.scene),t.scene&&[1037,1048,1012].indexOf(t.scene)>-1){var r=t.query||{},i=s.default.parseQuery(decodeURIComponent(r.scene));if(i.qcid&&i.qpid&&[1048,1012].indexOf(t.scene)>-1){var o=[{tiger_position_id:i.qpid,creative_id:i.qcid}];e.sendBehaviour("qrcodeLogin",{list:o,uid2:n.open_id})}else if(1037===t.scene){var a=(t.referrerInfo||{}).extraData||{},u=a.tiger_info||{},c=a.tiger_list||[];c.length&&e.sendBehaviour("login",{list:c,ak:u.ak,aid:u.aid,tid:u.tid,uid:u.uid,pid:u.pid,uidfp:u.uidfp,uid2:n.open_id})}}})}},{key:"backBtnSend",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s.default.deepClone(t),r=u.default.packLogData(e,n);return a.default.postTigerBehaviour(r)}},{key:"sendBehaviour",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s.default.deepClone(t),r=n.list,i=void 0===r?[]:r,o=Date.now();if((i=i.filter(function(t,n){var r=t.tiger_position_id+"_"+t.creative_id+"_"+e,a=f[r];return!(a&&o-a<6e4||h[r]>=l||(delete i[n].show_config,delete i[n].render_max,delete i[n].size,delete i[n].old_type,delete i[n].type,0))})).length){n.list=i;var c=u.default.packLogData(e,n);a.default.postTigerBehaviour(c).then(function(){i.forEach(function(t){var n=t.tiger_position_id+"_"+t.creative_id+"_"+e;f[n]=Date.now(),h[n]=h[n]||0,h[n]+=1})})}}}]),e}())},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(3),a=function(e){return e&&e.__esModule?e:{default:e}}(r(0));n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ALL_TIGER_UI_LIST=[],this.hasInitReGetTigerTimer=!1}return i(e,[{key:"on",value:function(e){if("Function"!==a.default.getVariableType(e))throw new Error("至少传入一个回调函数");this.ALL_TIGER_UI_LIST.push(e),this.init()}},{key:"init",value:function(){var e=this;this.hasInitReGetTigerTimer||(this.hasInitReGetTigerTimer=setInterval(function(){e.ALL_TIGER_UI_LIST.forEach(function(e){return e()})},o.PRE_TIGER_REFRESH))}},{key:"off",value:function(e){if(e&&"Function"!==a.default.getVariableType(e))throw new Error("至少传入一个回调函数");this.ALL_TIGER_UI_LIST=e?this.ALL_TIGER_UI_LIST.filter(function(t){return t!==e}):[],0==this.ALL_TIGER_UI_LIST.length&&this.stop()}},{key:"stop",value:function(){clearInterval(this.hasInitReGetTigerTimer),this.hasInitReGetTigerTimer=!1}}]),e}())},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(r(0)),a=s(r(2)),u=s(r(7));function s(e){return e&&e.__esModule?e:{default:e}}var c={},d="";n.default=new(function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);try{o.default.listenWxAPI("createRewardedVideoAd",function(e){var n=e.userOptions,r=e.wxOriginReturns;return t.catchVideoBehaviour(n[0],r)})}catch(e){this.rewriteVideoAdFail=!0}}return i(e,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.rewriteVideoAdFail){var t=wx.createRewardedVideoAd(e);return this.catchVideoBehaviour(e,t)}return wx.createRewardedVideoAd(e)}},{key:"catchVideoBehaviour",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],r=t.adUnitId;if(!r)throw"缺少必要参数: adUnitId";var i=function(t){if(d===r){var n=c[r].startShowTimeStamp;if(console.log("[rewardedVideoAd close]: ",t),n>0){a.default.APP_STATUS_HIDE_STAMPS.forEach(function(e,t){var r=a.default.APP_STATUS_SHOW_STAMPS[t+1];n<e&&r&&(n+=r-e)});var i=(Date.now()-n)/1e3;i=i<0?0:i>60?60:i,c[r].showVideoPromise="",u.default.send("videoClose",{adUnitId:r,isEnded:t&&t.isEnded||void 0===t,timeLastShow:i})}e.showRewardedVideoAd=!1,c[r].isLoadSuccess=!1}},o=function(e){console.log("[rewardedVideoAd error]: ",e);var t=c[r];if(d===r&&(t.showVideoPromise=""),!t.isLoadSuccess||d===r){var n=t.isLoadSuccess?"videoError":"videoLoadError";console.log("[rewardedVideoAd errorType]: ",n),u.default.send(n,{adUnitId:r,errMsg:JSON.stringify(e)})}},s=function(){c[r].isLoadSuccess||(console.log("[rewardedVideoAd onLoad]: ",r),c[r].isLoadSuccess=!0,u.default.send("videoLoad",{adUnitId:r}))};if(!c[r]){c[r]={},c[r].video=n,c[r].startShowTimeStamp=0,c[r].showVideoPromise="",c[r].isLoadSuccess=!1,c[r].video.onLoad(s),c[r].video.onClose(i),c[r].video.onError(o);var l=c[r].video.offLoad.bind(c[r].video),f=c[r].video.offClose.bind(c[r].video),h=c[r].video.offError.bind(c[r].video);c[r].video.offLoad=function(e){l(e),e||c[r].video.onLoad(s)},c[r].video.offClose=function(e){f(e),e||c[r].video.onClose(i)},c[r].video.offError=function(e){h(e),e||c[r].video.onError(o)}}var p=c[r].video;return{show:function(){return r?(d=r,c[r].showVideoPromise||(c[r].showVideoPromise=p.show().then(function(e){return u.default.send("videoShow",{adUnitId:r}),e})),c[r].showVideoPromise.then(function(t){return e.showRewardedVideoAd=!0,c[r].startShowTimeStamp=Date.now(),t}).catch(function(e){return o(e),Promise.reject(e)})):Promise.reject(new Error("缺少必要参数: adUnitId"))},load:function(){return p.load()},onLoad:function(e){return p.onLoad(e)},offLoad:function(e){return p.offLoad(e)},onError:function(e){return p.onError(e)},offError:function(e){return p.offError(e)},onClose:function(e){return p.onClose(e)},offClose:function(e){return p.offClose(e)}}}}]),e}())},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=_(n(0)),i=n(4),o=_(n(17)),a=_(n(19)),s=_(n(5)),u=_(n(11)),c=_(n(10)),d=_(n(22)),l=_(n(13)),f=_(n(30)),h=_(n(15)),p=_(n(31)),g=_(n(32)),y=_(n(7)),v=_(n(33)),m=_(n(2)),S=_(n(12));function _(e){return e&&e.__esModule?e:{default:e}}var I=function(e){m.default.sendLanuchCodeToCheck(e)},w=function(e){console.log("appShow options:",e),m.default.appIsShow=!0,m.default.APP_SHOW_OPTIONS=e,m.default.saveEnvironmentData(e),m.default.APP_STATUS_SHOW_STAMPS.push(Date.now()),p.default.start(),y.default.send("login_in"),o.default.mergeAndSetClipBorad(e).catch(function(){}),l.default.sendTigerLogin(e)},E=function(e){console.log("appHide options: ",e),m.default.appIsShow=!1,m.default.APP_STATUS_HIDE_STAMPS.push(Date.now()),y.default.send("login_out"),p.default.stop(),f.default.sendBannerBack(e)},T={onShow:function(){var e;if(r.default.needUpdateTips("onShow","wx.onShow"),r.default.isRuningMiniGame())return(e=wx).onShow.apply(e,arguments);console.error("该接口不支持当前环境")},onHide:function(){var e;if(r.default.needUpdateTips("onHide","wx.onHide"),r.default.isRuningMiniGame())return(e=wx).onHide.apply(e,arguments);console.error("该接口不支持当前环境")},init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.appVersion,n=e.hideRequestLog;m.default.initSDK({appVersion:t,hideRequestLog:n})},navigateToMiniProgram:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.appId,n=e.path,r=e.extraData,i=e.envVersion,o=e.success,a=e.fail;m.default.navigateToMiniProgram({appId:t,path:n,extraData:r,envVersion:i,success:o,fail:a})},getRiskFactor:function(){if(!m.default.hasInitSDK)throw i.RESPONSE.INIT_SDK_ERROR;return m.default.getRiskFactor()},sendLoadingLog:function(e){g.default.send(e)},getTigerConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.tiger_position_id,n=e.appVersion;return r.default.needUpdateTips("getTigerConfig","checkFlowIsOpen"),n&&(m.default.appVersion=n),c.default.getConfig({positionId:t}).then(function(e){return{is_open:e.isOpen,tiger_position_id:t}})},navigateToTiger:function(e){var t=e.tiger_position_id,n=e.creative_id;return r.default.needUpdateTips("navigateToTiger","flowNavigate"),c.default.navigate({positionId:t,creativeId:n}).then(function(e){return[c.default.formatTigerToOld(e)]})},getTigerList:function(e){var t=e.tiger_position_id_list,n=e.appVersion;return r.default.needUpdateTips("getTigerList","getFlowConfig"),"Array"!==r.default.getVariableType(t)?Promise.reject(new Error("tiger_position_id_list必须为数组")):(n&&(m.default.appVersion=n),Promise.all(t.map(function(e){return c.default.getList({positionId:e}).then(function(e){return c.default.formatTigerToOld(e)})})))},checkFlowIsOpen:function(e){var t=e.positionId;if(!m.default.hasInitSDK)throw i.RESPONSE.INIT_SDK_ERROR;return c.default.getConfig({positionId:t})},getFlowConfig:function(e){var t=e.positionId;if(!m.default.hasInitSDK)throw i.RESPONSE.INIT_SDK_ERROR;return c.default.getList({positionId:t})},flowNavigate:function(e){var t=e.positionId,n=e.creativeId;if(!m.default.hasInitSDK)throw i.RESPONSE.INIT_SDK_ERROR;return c.default.navigate({positionId:t,creativeId:n})},createTiger:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.tiger_position_id,n=e.app_version,i=e.width,o=e.x,a=e.y,s=e.zIndex;return r.default.needUpdateTips("createTiger","createFlow"),n&&(m.default.appVersion=n),new d.default({positionId:t,width:i,x:o,y:a,zIndex:s})},createFlow:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.positionId,n=e.x,r=e.y,o=e.width,a=e.zIndex,s=e.nodeOptions;if(!m.default.hasInitSDK)throw i.RESPONSE.INIT_SDK_ERROR;return new d.default({positionId:t,width:o,x:n,y:r,zIndex:a,nodeOptions:s})},createBackBtn:function(){console.error(i.RESPONSE.API_DISABLED)},createRewardedVideoAd:function(e){return h.default.create(e)},createBannerAd:function(e){return f.default.create(e)},onMergeAccount:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.success,n=e.fail;if(!i.SDK_CONFIG.HAS_APPSECRET&&"Function"===r.default.getVariableType(n))return n(i.RESPONSE.API_DISABLED_WITHOUT_APPSECRET);o.default.onMergeAccount({success:t,fail:n})},getSDKConfig:function(){return r.default.deepClone(i.SDK_CONFIG)},sendUserInfo:function(e){var t=e.openId,n=e.gender;return s.default.sendUserInfo({openId:t,gender:n})},login:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).refresh,t=void 0!==e&&e;return s.default.fetchUserInfo({openIdOnly:!t})},updateUserInfo:function(e){if(!i.SDK_CONFIG.HAS_APPSECRET)throw i.RESPONSE.API_DISABLED_WITHOUT_APPSECRET;return s.default.updateUserInfo(e)},pay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.coin,n=e.program_param;if(!i.SDK_CONFIG.HAS_APPSECRET)throw i.RESPONSE.API_DISABLED_WITHOUT_APPSECRET;return a.default.start({coin:t,program_param:n})},payByCS:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.amount,n=e.program_param,r=e.loopCheckTimes;return a.default.payByCS({amount:t,program_param:n,loopCheckTimes:r})},cancelLockPay:function(e){var t=e.order_code;if(!i.SDK_CONFIG.HAS_APPSECRET)throw i.RESPONSE.API_DISABLED_WITHOUT_APPSECRET;return a.default.cancelLockPay({order_code:t})},updateGold:function(e){var t=e.gold,n=e.gold_desc,r=void 0===n?"":n;if(!i.SDK_CONFIG.HAS_APPSECRET)throw i.RESPONSE.API_DISABLED_WITHOUT_APPSECRET;return a.default.updateGold({gold:t,gold_desc:r})},getGoldBalance:function(){return a.default.getGoldBalance()},getGameSwitchConfig:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).version;r.default.needUpdateTips("getGameSwitchConfig","getJudgeConfig"),e&&(m.default.appVersion=e);var t={share:!0,invation:!0,login:!0};return m.default.getJudgeConfigById().then(function(e){return Object.keys(e).forEach(function(n){void 0!==e[n].key&&(t[e[n].key]=!!e[n].status)}),t})},getJudgeConfig:function(e){return m.default.hasInitSDK?m.default.getJudgeConfigById(e):Promise.reject(i.RESPONSE.INIT_SDK_ERROR)},getShareTemplates:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).version,t=void 0===e?"":e;return u.default.getShareTemplates({version:t})},getShareInfo:function(e){var t=e.success,n=e.fail;if(!i.SDK_CONFIG.HAS_APPSECRET&&"Function"===r.default.getVariableType(n))return n(i.RESPONSE.API_DISABLED_WITHOUT_APPSECRET);u.default.getGroupIdAndRank().then(t).catch(n)},sendRegionRoleLog:function(e){var t=e.region,n=e.role;if(!t||!n)throw i.RESPONSE.REGION_ROLE_VARIABLE_NEED;return s.default.regionRoleInfo={region:t,role:n},y.default.send("role_login_in",{region:t,role:n})},sendEvent:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};return v.default.sendEvent(e,t,n,r)},getAppJSONConfig:function(e){return m.default.getAppJSONConfig(e)},abtest:function(e){return S.default.start(e)}};!function(){if((r.default.isRuningMiniGame()||r.default.isRuningMiniPro())&&!wx.tmSDK){if(r.default.isRuningMiniGame()){if(GameGlobal.XH_MINIPRO_SDK||GameGlobal.XH_STATISTIC)throw i.RESPONSE.CHECK_OLD_SDK_JOIN_UP;g.default.send("appLoaded"),I(wx.getLaunchOptionsSync()),T.shareAppMessage=u.default.shareGameMessage.bind(u.default),T.onShareAppMessage=u.default.onShareGameMessage.bind(u.default),r.default.forceBindWxAPI("onShow",w),r.default.forceBindWxAPI("onHide",E)}else r.default.isRuningMiniPro()&&(r.default.addPreHook("App",{onLanuch:I,onShow:w,onHide:E}),r.default.addPreHook("Page",{onShareAppMessage:u.default.onAppShareMessage.bind(u.default)}));wx.tmSDK=T,Object.defineProperty(wx,"tmSDK",{writable:!1}),Object.keys(wx.tmSDK).forEach(function(e){Object.defineProperty(wx.tmSDK,e,{writable:!1})})}}(),t.default=T},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=c(r(5)),a=c(r(1)),s=c(r(0)),u=r(4),d=c(r(2));function c(e){return e&&e.__esModule?e:{default:e}}n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mergePromise=null}return i(e,[{key:"checkAndMergeAccount",value:function(e){if(!u.SDK_CONFIG.HAS_APPSECRET)return Promise.reject(new Error(u.RESPONSE.API_DISABLED_WITHOUT_APPSECRET));var t=void 0;return Promise.resolve().then(function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.query=e.query||{};var t=e.query.mergeAccount;try{t=JSON.parse(t)}catch(e){t=""}return t||(t=((e.referrerInfo||{}).extraData||{}).mergeAccount||{}),t}(e)}).then(function(e){var n=e.appId,r=e.openId;return n&&r?(t=u.STORAGE_KEYS.ACCOUNT_MERGE_RECORDS_STORAGE_KEY+"_"+n+"_"+r,s.default.getStorage(t).then(function(e){return e||n===u.SDK_CONFIG.APPID||r===o.default.userInfo.open_id?u.RESPONSE.NO_MERGE_ERROR:a.default.postMergeAccounts({clipboard:"www.starsriver.cn?"+n+"?"+r})})):u.RESPONSE.NO_MERGE_ERROR}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!e.err&&e.pid?(o.default.userInfo.pid=e.pid,{err:0,message:"账户合并成功",data:o.default.userInfo}):Promise.reject(e)}).catch(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&1031===e.err&&s.default.setStorage(t,!0);var n={err:e.err,message:e.message||e};return Promise.reject(n)})}},{key:"mergeAndSetClipBorad",value:function(e){var t=this;return this.mergePromise=o.default.fetchUserInfo().then(function(){return t.checkAndMergeAccount(e)})}},{key:"onMergeAccount",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.success,r=t.fail;d.default.getAppShowOptions().then(function(t){e.mergePromise?e.mergePromise.then(n).catch(r):e.mergeAndSetClipBorad(t).then(n).catch(r)})}}]),e}())},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};!function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=r,n=t.util={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=(255&e[n])<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(t){if("function"==typeof btoa)return btoa(o.bytesToString(t));for(var n=[],r=0;r<t.length;r+=3)for(var i=t[r]<<16|t[r+1]<<8|t[r+2],a=0;a<4;a++)8*r+6*a<=8*t.length?n.push(e.charAt(i>>>6*(3-a)&63)):n.push("=");return n.join("")},base64ToBytes:function(t){if("function"==typeof atob)return o.stringToBytes(atob(t));t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],r=0,i=0;r<t.length;i=++r%4)0!=i&&n.push((e.indexOf(t.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<2*i|e.indexOf(t.charAt(r))>>>6-2*i);return n}},i=t.charenc={};i.UTF8={stringToBytes:function(e){return o.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(o.bytesToString(e)))}};var o=i.Binary={stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}}(),function(){var e=r,t=e.util,n=e.charenc.UTF8,i=e.SHA1=function(e){var n=t.wordsToBytes(i._sha1(e));return t.bytesToHex(n)};i._sha1=function(e){e.constructor==String&&(e=n.stringToBytes(e));var r=t.bytesToWords(e),i=8*e.length,o=[],a=1732584193,s=-271733879,u=-1732584194,c=271733878,d=-1009589776;r[i>>5]|=128<<24-i%32,r[15+(i+64>>>9<<4)]=i;for(var l=0;l<r.length;l+=16){for(var f=a,h=s,p=u,g=c,y=d,v=0;v<80;v++){if(v<16)o[v]=r[l+v];else{var m=o[v-3]^o[v-8]^o[v-14]^o[v-16];o[v]=m<<1|m>>>31}var S=(a<<5|a>>>27)+d+(o[v]>>>0)+(v<20?1518500249+(s&u|~s&c):v<40?1859775393+(s^u^c):v<60?(s&u|s&c|u&c)-1894007588:(s^u^c)-899497514);d=c,c=u,u=s<<30|s>>>2,s=a,a=S}a+=f,s+=h,u+=p,c+=g,d+=y}return[a,s,u,c,d]},i._blocksize=16,i._digestsize=20}(),t.default=r.SHA1},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=c(r(5)),a=r(4),s=c(r(1)),u=c(r(0)),d=c(r(2));function c(e){return e&&e.__esModule?e:{default:e}}n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.coin,r=t.program_param;return Promise.resolve().then(function(){return o.default.fetchUserInfo()}).then(function(){return s.default.getCheckPayType()}).then(function(t){var i=t.pay_type;if(0===i){var o;return o="ios"===d.default.appSystemOsType?a.RESPONSE.USER_PAY_DISABLED_IOS:"android"===d.default.appSystemOsType?a.RESPONSE.USER_PAY_DISABLED_ANDROID:"win"===d.default.appSystemOsType?a.RESPONSE.USER_PAY_DISABLED_WINDOWS:a.RESPONSE.USER_PAY_DISABLED_OTHER,Promise.reject(u.default.makeResponse(o))}return 1===i?e.createOrderAndPayByWx({coin:n,program_param:r}):2===i?e.createOrderAndPayByMidas({coin:n,program_param:r}):void 0}).then(function(t){return e.loopCheckOrder(t)})}},{key:"loopCheckOrder",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.MAX_PAY_RETRY_TIMES;return Promise.resolve().then(function(){return s.default.getCheckOrderStatus(e)}).then(function(r){var i=r.pay_status;if(0===i){if(0===n){var o=u.default.makeResponse(a.RESPONSE.CHECK_ORDER_TIME_OUT);return o.data={orderId:e},Promise.reject(o)}return u.default.sleep(a.PAY_RETRY_INTERVAL).then(function(){return t.loopCheckOrder(e,n-1)})}if(1===i||3===i){var s=u.default.makeResponse(a.RESPONSE.PAY_SUCCESS);return s.data={orderId:e},Promise.resolve(s)}if(2===i){var c=u.default.makeResponse(a.RESPONSE.PAY_FAIL);return c.data={orderId:e},Promise.reject(c)}var d=u.default.makeResponse(a.RESPONSE.PAY_UNKNOWN_ORDER_STATUS);return d.data={orderId:e,pay_status:i},Promise.reject(d)}).catch(function(r){return r.message===a.RESPONSE.CHECK_ORDER_TIME_OUT.message||r.message===a.RESPONSE.PAY_FAIL.message||n<=0?Promise.reject(r):u.default.sleep(a.PAY_RETRY_INTERVAL).then(function(){return t.loopCheckOrder(e,n-1)})})}},{key:"createOrderAndPayByMidas",value:function(e){var t=e.coin,n=e.program_param,r="";return Promise.resolve().then(function(){return u.default.promiseFy(wx.login)}).then(function(e){return s.default.platuserRefreshSession({wx_code:e.code})}).then(function(){return s.default.postCreateMidasPayOrder({coin:t,program_param:n})}).then(function(e){var t=e.item,n=t.buy_quantity;return r=t.order_code,n>0?u.default.promiseFy(wx.requestMidasPayment,{mode:t.mode,env:t.env,offerId:t.offer_id,currencyType:t.currency_type,platform:t.platform,buyQuantity:t.buy_quantity,zoneId:t.zone_id}).catch(function(e){return""===r?Promise.reject(e):s.default.putCancelPay(r).then(function(){return Promise.reject(e)}).catch(function(){return Promise.reject(e)})}).then(function(){return s.default.putConfirmPay(r)}):Promise.resolve()}).then(function(){return r}).catch(function(e){var t;return t=u.default.isEmptyObject(e)||void 0===e?"无报错信息":e.msg||e.message||JSON.stringify(e),s.default.postPayErrorLog({order_code:r,msg:t}).then(function(){return Promise.reject(e)}).catch(function(){return Promise.reject(e)})})}},{key:"createOrderAndPayByWx",value:function(e){var t=e.coin,n=e.program_param,r="";return s.default.postCreateWxPayOrder({coin:t,program_param:n}).then(function(e){var t=e.item;return r=t.order_code,u.default.promiseFy(wx.requestPayment,{timeStamp:t.timestamp+"",nonceStr:t.noncestr,package:t.package,signType:t.sign_type,paySign:t.pay_sign})}).then(function(){return s.default.putConfirmPay(r)}).then(function(){return r})}},{key:"updateGold",value:function(e){var t=e.gold,n=e.gold_desc,r=void 0===n?"":n,i=t>0?0:1;return t=Math.abs(t),Promise.resolve().then(function(){return o.default.fetchUserInfo()}).then(function(){return s.default.putUpdateGoldBalance({gold:t,transaction_type:i,gold_desc:r})})}},{key:"cancelLockPay",value:function(e){var t=e.order_code;return t?s.default.putCancelPay(t):Promise.reject(new Error("请使用正确的订单号"))}},{key:"getGoldBalance",value:function(){return Promise.resolve().then(function(){return o.default.fetchUserInfo()}).then(s.default.getGoldBalance)}},{key:"payByCS",value:function(e){var t=this,n=e.amount,r=e.program_param,i=e.loopCheckTimes;return o.default.fetchUserInfo().then(function(e){return u.default.isRuningMiniGame()?"number"!=typeof n?Promise.reject(new Error("金额必须是数字类型")):n<.1?Promise.reject(new Error("amount参数不能小于0.1")):""===r||"string"!=typeof r?Promise.reject(new Error("program_param不能为空且必须为字符类型")):Promise.resolve().then(function(){return s.default.postCreateH5PayOrder({amount:n,program_param:r})}).then(function(s){var u=s.order_id,c=o.default.access_token,d=e.open_id;if(!c)return Promise.reject(new Error("[payByCs] from_access_token不能为空"));if(!d)return Promise.reject(new Error("[payByCs] from_uid不能为空"));var l=JSON.stringify({from_appid:a.SDK_CONFIG.APPID,from_pgid:a.SDK_CONFIG.PROGRAM_ID,from_uid:d,amount:n,program_param:r,from_access_token:c,order_id:u});return console.log(l),t.H5PayOpenCS(l,u,i)}):u.default.isRuningMiniPro()?Promise.reject(new Error("小程序环境暂不支持H5支付功能")):Promise.reject(new Error("当前环境不属于小游戏或小程序，不支持H5支付功能"))})}},{key:"H5PayOpenCS",value:function(e,t,n){var r=this;return new Promise(function(i,o){var a=!1;u.default.promiseFy(wx.openCustomerServiceConversation,{sessionFrom:e,showMessageCard:!0,sendMessageTitle:"购买商品请点击下方链接",sendMessageImg:"https://cdn.kuaiyugo.com/plat/SDK/prod/static_files/h5pay_guide_img2.jpg?v="+Date.now()}).catch(function(e){var t=e;return t.message,a=!0,o(t)}),u.default.nextShow().then(function(){if(!a)return r.loopCheckH5Order(t,n).then(i).catch(o)})})}},{key:"checkH5PayOrderStatus",value:function(e,t){if(-2===e){var n=u.default.makeResponse(a.RESPONSE.H5PAY_FAIL_SELLER_DELIVER_FAIL);return n.data={orderId:t},Promise.reject(n)}if(-1===e){var r=u.default.makeResponse(a.RESPONSE.H5PAY_FAIL_PAY_ERROR);return r.data={orderId:t},Promise.reject(r)}if(0===e){var i=u.default.makeResponse(a.RESPONSE.H5PAY_FAIL_BUYER_NOT_PAY);return i.data={orderId:t},Promise.reject(i)}if(1===e){var o=u.default.makeResponse(a.RESPONSE.H5PAY_FAIL_SELL_NOT_DELIVERY);return o.data={orderId:t},Promise.reject(o)}if(2===e){var s=u.default.makeResponse(a.RESPONSE.H5_PAY_SUCCESS);return s.data={orderId:t},Promise.resolve(s)}var c=u.default.makeResponse(a.RESPONSE.H5PAY_UNKNOWN_ORDER_STATUS);return c.data={orderId:t,order_status:e},Promise.reject(c)}},{key:"loopCheckH5Order",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.MAX_PAY_RETRY_TIMES,r=function(e,n,r){return n<=1?t.checkH5PayOrderStatus(r,e):u.default.sleep(a.PAY_RETRY_INTERVAL).then(function(){return t.loopCheckH5Order(e,n-1)})};return Promise.resolve().then(function(){return s.default.getH5PayOrderStatus(e)}).then(function(t){var i=t.order_status;if(2===i){var o=u.default.makeResponse(a.RESPONSE.H5_PAY_SUCCESS);return o.data={orderId:e},o}return r(e,n,i)}).catch(function(t){return[a.RESPONSE.H5PAY_FAIL_SELLER_DELIVER_FAIL.message,a.RESPONSE.H5PAY_FAIL_PAY_ERROR.message,a.RESPONSE.H5PAY_FAIL_BUYER_NOT_PAY.message,a.RESPONSE.H5PAY_FAIL_SELL_NOT_DELIVERY.message,a.RESPONSE.H5PAY_UNKNOWN_ORDER_STATUS.message].some(function(e){return t.message.indexOf(e)>-1})?Promise.reject(t):r(e,n)})}}]),e}())},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(3),a=function(e){return e&&e.__esModule?e:{default:e}}(r(6)),s={},u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"show",value:function(e,t,n){switch(this.clearActions(e,n),t){case o.AdvDynamicType.easeInOut:this.runRepeatedScaleAnimation(e);break;case o.AdvDynamicType.shake:this.runRepeatedShakeAnimation(e);break;case o.AdvDynamicType.moveByY:this.runRepeatedMoveByYAnimation(e)}}},{key:"enter",value:function(e,t,n){switch(t){case o.AdvEnterAnimationType.showToTop:return this.runEnterSlideToTopAnimation(e,n);case o.AdvEnterAnimationType.jumpFromTop:return this.runEnterJumpFromTopAnimation(e,n);default:return Promise.resolve()}}},{key:"exit",value:function(e,t,n){switch(this.clearActions(e,n),t){case o.exitAnimationType.exitToBottom:return this.runExitSlideToBottomAnimation(e,n);default:return Promise.resolve()}}},{key:"clearActions",value:function(e,t){cc.isValid(e)&&(e.stopAllActions(),t&&void 0!==t.x&&void 0!==!t.y&&e.runAction(cc.place(cc.p(t.x,t.y))))}},{key:"runRepeatedMoveByYAnimation",value:function(e){cc.isValid(e)&&e.runAction(cc.repeatForever(cc.sequence(cc.moveBy(.5,cc.p(0,40)).easing(cc.easeCubicActionOut()),cc.moveBy(.1,cc.p(0,-40)),cc.moveBy(.5,cc.p(0,20)).easing(cc.easeCubicActionOut()),cc.moveBy(.1,cc.p(0,-20)),cc.moveBy(.1*3,cc.p(0,10)).easing(cc.easeCubicActionOut()),cc.moveBy(.1,cc.p(0,-10)),cc.delayTime(1))))}},{key:"runRepeatedShakeAnimation",value:function(e){cc.isValid(e)&&e.runAction(cc.repeatForever(cc.sequence(cc.moveBy(.02,cc.p(10,0)),cc.moveBy(.04,cc.p(-20)),cc.moveBy(.02,cc.p(10)),cc.moveBy(.02,cc.p(0,10)),cc.moveBy(.04,cc.p(0,-20)),cc.moveBy(.02,cc.p(0,10)),cc.moveBy(.02,cc.p(5,0)),cc.moveBy(.04,cc.p(-10,0)),cc.moveBy(.02,cc.p(5,0)),cc.moveBy(.02,cc.p(0,5)),cc.moveBy(.04,cc.p(0,-10)),cc.moveBy(.02,cc.p(0,5)),cc.delayTime(1))))}},{key:"runRepeatedScaleAnimation",value:function(e){if(cc.isValid(e)){e.scale=1;var t=cc.scaleTo(.3,1.2),n=cc.scaleTo(.3,1),r=cc.sequence(cc.repeat(cc.sequence(t,n),2),cc.delayTime(.5)),i=cc.repeatForever(r);e.runAction(i)}}},{key:"runEnterJumpFromTopAnimation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){if(cc.isValid(e)){var i=t.x||e.x,o=t.y||e.y,s=a.default.getWinSize().height+e.height;e.runAction(cc.sequence(cc.place(cc.p(i,s)),cc.moveTo(.2*3,cc.p(i,o-40)).easing(cc.easeSineIn()),cc.moveTo(.4,cc.p(i,o+10)).easing(cc.easeCircleActionOut()),cc.moveTo(.4,cc.p(i,o-5)).easing(cc.easeSineIn()),cc.moveTo(.2,cc.p(i,o)).easing(cc.easeCircleActionOut()),cc.callFunc(function(){n()})))}else n()})}},{key:"runEnterSlideToTopAnimation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){if(cc.isValid(e)){var i=t.x||e.x,o=t.y||e.y,u=a.default.getWinSize(),c=s.systemInfo||wx.getSystemInfoSync(),d=s.winSizeHeight||Math.max(c.windowHeight,u.height);s.winSizeHeight=d,s.systemInfo=c,e.runAction(cc.sequence(cc.place(cc.p(i,-d)),cc.moveTo(.6,cc.p(i,o)).easing(cc.easeSineIn()),cc.callFunc(function(){n()})))}})}},{key:"runExitSlideToBottomAnimation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){if(cc.isValid(e)){var i=t.x||e.x,o=t.y||e.y,u=s.systemInfo||wx.getSystemInfoSync(),c=a.default.getWinSize(),d=s.winSizeHeight||Math.max(u.windowHeight,c.height);s.winSizeHeight=d,s.systemInfo=u,e.runAction(cc.sequence(cc.place(cc.p(i,o)),cc.moveTo(.6,cc.p(i,-d)).easing(cc.easeSineIn()),cc.callFunc(function(){n()})))}})}}]),e}();n.default=u},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(3),a=function(e){return e&&e.__esModule?e:{default:e}}(r(6)),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"show",value:function(e,t){t==o.AdvDynamicType.easeInOut?this.scale(e):t==o.AdvDynamicType.shake?this.shake(e):Laya.timer.clearAll(e)}},{key:"enter",value:function(e,t,n){switch(t){case o.AdvEnterAnimationType.showToTop:return this.runEnterSlideToTopAnimation(e,n);case o.AdvEnterAnimationType.jumpFromTop:return this.runEnterJumpFromTopAnimation(e,n);default:return Promise.resolve()}}},{key:"exit",value:function(e,t,n){switch(t){case o.exitAnimationType.exitToBottom:return this.runExitSlideToBottomAnimation(e,n);default:return Promise.resolve()}}},{key:"shake",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:500,o=Laya.timer.currTimer;e.handler_shake=e.handler_shake||function(){var a=e.x,s=e.y,u=Laya.timer.currFrame,c=Laya.timer.currTimer,d=c-o;d>r?d>r+i?o=c:(e.x=a,e.y=s):(e.x+=Math.sin(u)*t,e.y-=Math.cos(u)*n)},Laya.timer.clearAll(e),Laya.timer.frameLoop(2,e,e.handler_shake)}},{key:"scale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1.2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=e.scaleX,o=e.scaleY,a=e.width,s=e.height,u=e.x,c=e.y;e.handler_scale=e.handler_scale||function(){Laya.Tween.to(e,{x:u-(t*a-a)/2,y:c-(n*s-s)/2,scaleX:t,scaleY:n},500,Laya.Ease.quadOut,Laya.Handler.create(e,function(){Laya.Tween.to(e,{x:u,y:c,scaleX:i,scaleY:o},250)}))},Laya.timer.clearAll(e),Laya.timer.frameLoop(r,e,e.handler_scale)}},{key:"runEnterSlideToTopAnimation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){var i=t.y||e.y,o=a.default.getWinSize(),s=wx.getSystemInfoSync(),u=Math.max(s.windowHeight,o.height);e.y=u,Laya.Tween.to(e,{y:i},600,Laya.Ease.sineIn,Laya.Handler.create(e,function(){n()}))})}},{key:"runEnterJumpFromTopAnimation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){var i=t.y||e.y;e.y=-e.height,Laya.Tween.to(e,{y:i+40},600,Laya.Ease.sineIn,Laya.Handler.create(e,function(){Laya.Tween.to(e,{y:i-10},400,Laya.Ease.sineOut,Laya.Handler.create(e,function(){Laya.Tween.to(e,{y:i+5},400,Laya.Ease.sineIn,Laya.Handler.create(e,function(){Laya.Tween.to(e,{y:i},200,Laya.Ease.sineOut,Laya.Handler.create(e,function(){n()}))}))}))}))})}},{key:"runExitSlideToBottomAnimation",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],new Promise(function(t,n){var r=a.default.getWinSize(),i=wx.getSystemInfoSync(),o=Math.max(i.windowHeight,r.height);Laya.Tween.to(e,{y:o},600,Laya.Ease.sineIn,Laya.Handler.create(e,function(){t()}))})}}]),e}();n.default=s},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=f(r(0)),a=r(3),s=f(r(8)),u=f(r(25)),c=f(r(26)),d=f(r(27)),l=f(r(28)),p=f(r(29));function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var g=function(e){function t(e){var n,r=e.positionId,i=e.width,s=e.x,u=e.y,c=e.zIndex,d=e.nodeOptions,l=void 0===d?{}:d;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),console.log("渲染 参数:",r,i,s,u,c);var f=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return f.nodeOptions=l,f.checkTigerCanRender(r).then(function(e){switch(console.log("远程配置: ",e),e.type){case a.tigerType.fakeVideo:f.createTigerVideo(r);break;case a.tigerType.recommend:f.createRecommend(r,{left:s,top:u,width:i,zIndex:c});break;case a.tigerType.floatIcon:f.createIcon(r,{left:s,top:u,width:i,zIndex:c});break;case a.tigerType.blinkIcon:case a.tigerType.horizontalBlinkIcon:f.createBlinkPage(r);break;case a.tigerType.intersititialAd:f.createInterstitialAd(r)}f.showTigerUI(),f.catchTigerUIEvents()}).catch(function(e){f.runCallBack("onError",{message:e})}),n=o.default.bindJsScopeToFn({onRender:f.onRender,offRender:f.offRender,onError:f.onError,offError:f.offError,onDestroy:f.onDestroy,offDestroy:f.offDestroy,onClose:f.onClose,offClose:f.offClose,onNavigate:f.onNavigate,offNavigate:f.offNavigate,destroy:f.destroy},f),h(f,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"showTigerUI",value:function(){var e=this;this.tigerUI&&this.tigerUI.show().then(function(t){if("Object"===o.default.getVariableType(e.nodeOptions))for(var n in e.nodeOptions)e.nodeOptions.hasOwnProperty(n)&&(t[n]=e.nodeOptions[n]);e.runCallBack("onRender",{node:t,message:"组件节点已渲染"})})}},{key:"catchTigerUIEvents",value:function(){var e=this;this.tigerUI&&(this.tigerUI.onError(function(t){e.runCallBack("onError",{message:t})}),this.tigerUI.onDestroy(function(){e.runCallBack("onDestroy")}),this.tigerUI.onNavigate&&this.tigerUI.onNavigate(function(t){e.runCallBack("onNavigate",t)}))}},{key:"destroy",value:function(){this.tigerUI&&this.tigerUI.destroy()}},{key:"createBlinkPage",value:function(e){this.tigerUI=new l.default(e)}},{key:"createIcon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.tigerUI=new d.default({positionId:e,style:{width:t.width,left:t.left,top:t.top}})}},{key:"createRecommend",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.tigerUI=new c.default({positionId:e,style:{width:t.width,left:t.left,top:t.top}})}},{key:"createInterstitialAd",value:function(e){this.tigerUI=new p.default(e)}},{key:"createTigerVideo",value:function(e){var t=this;this.tigerUI=new u.default(e),this.tigerUI.onClose(function(e){t.runCallBack("onClose",e)})}}]),t}();n.default=g},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=a(r(0)),s=a(r(24));function a(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._callBacks={}}return i(e,[{key:"onSceneChange",value:function(e){var t=this;o.default.isCocosGame()&&(this.addCallBack("onSceneChange",e),this.hasAddLoadSceneHook||s.default.addLoadSceneHook(function(){t.runCallBack("onSceneChange")}),this.hasAddLoadSceneHook=!0)}},{key:"offSceneChange",value:function(e){this.deleteCallBack("onSceneChange",e)}},{key:"onNavigate",value:function(e){this.addCallBack("onNavigate",e)}},{key:"offNavigate",value:function(e){this.deleteCallBack("onNavigate",e)}},{key:"onResize",value:function(e){this.addCallBack("onResize",e)}},{key:"offResize",value:function(e){this.deleteCallBack("onResize",e)}},{key:"onLoad",value:function(e){this.addCallBack("onLoad",e)}},{key:"offLoad",value:function(e){this.deleteCallBack("onLoad",e)}},{key:"onRender",value:function(e){this.addCallBack("onRender",e)}},{key:"offRender",value:function(e){this.deleteCallBack("onRender",e)}},{key:"onError",value:function(e){this.addCallBack("onError",e)}},{key:"offError",value:function(e){this.deleteCallBack("onError",e)}},{key:"onDestroy",value:function(e){this.addCallBack("onDestroy",e)}},{key:"offDestroy",value:function(e){this.deleteCallBack("onDestroy",e)}},{key:"onClose",value:function(e){this.addCallBack("onClose",e)}},{key:"offClose",value:function(e){this.deleteCallBack("onClose",e)}},{key:"runCallBack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){if("onError"===e){var n=t.message||{};t.message=n.message||n,console.error(t)}(this._callBacks[e]||[]).forEach(function(e){return"Function"===o.default.getVariableType(e)&&e(t)})}else console.error("请传入正确的回调类型")}},{key:"addCallBack",value:function(e,t){if(!e)throw new Error("请传入正确的回调类型");if("Function"!==o.default.getVariableType(t))throw new Error("至少传入一个回调函数");var n=this._callBacks[e]||[];n.push(t),this._callBacks[e]=n}},{key:"deleteCallBack",value:function(e,t){if(!e)throw new Error("请传入正确的回调类型");var n=this._callBacks[e]||[];n=t?n.filter(function(e){return e!==t}):[],this._callBacks[e]=n}}]),e}();n.default=u},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(0));n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"addLoadSceneHook",value:function(e){if(o.default.isCocosGame()){var t=cc.director.loadScene;cc.director.loadScene=function(n,r){for(var i=arguments.length,a=Array(i>2?i-2:0),s=2;s<i;s++)a[s-2]=arguments[s];t.call.apply(t,[cc.director,n,function(){"Function"===o.default.getVariableType(e)&&e.apply(void 0,arguments),"Function"===o.default.getVariableType(r)&&r.apply(void 0,arguments)}].concat(a))}}}}]),e}())},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tigerVideoUIImagePosition=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(3),a=c(r(6)),s=c(r(0)),u=c(r(10)),l=c(r(8));function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=n.tigerVideoUIImagePosition={closeBtnWithLine:{rectX:0,rectY:18,rectW:122,rectH:45},closeBtn:{rectX:0,rectY:180,rectW:122,rectH:66},viewBtn:{rectX:0,rectY:100,rectW:120,rectH:60},soundBtnOpened:{rectX:140,rectY:0,rectW:82,rectH:71},soundBtnClose:{rectX:140,rectY:100,rectW:82,rectH:71},videoBtn:{rectX:140,rectY:180,rectW:119,rectH:119}},h={},p=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.mainNodeName="video_"+e,r.positionId=e,r.isHighViewPhone=s.default.isHighViewPhone(r.winSize),r.phoneFixHeight=r.isHighViewPhone?40:0,r.load().then(function(){r.runCallBack("onLoad",{tiger:s.default.deepClone(r.tigerConfig)})}).catch(function(e){r.runCallBack("onError",{message:e})}),n=s.default.bindJsScopeToFn({type:"tigerVideo",show:r.show,load:r.load,onDestroy:r.onDestroy,offDestroy:r.offDestroy,onNavigate:r.onNavigate,offNavigate:r.offNavigate,onLoad:r.onLoad,offLoad:r.offLoad,onError:r.onError,offError:r.offError,onClose:r.onClose,offClose:r.offClose},r),d(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default),i(t,[{key:"renderAllNodes",value:function(){var e=this;return this.checkNodeHasInit().then(function(){return e.closeRemainSecondText=!1,e.runingSecondTotal=0,e.renderVideoWrapperNode(),a.default.runEnterSceneAction(e.mainNode,o.AdvEnterAnimationType.showToTop).then(function(){return e.renderVideoCloseButton(),e.renderBanner(),e.tigerVideoConfigs.audio&&e.renderSound(),e.renderVideo(),e.bindAppShowOrHide(),e.mainNode})})}},{key:"load",value:function(){var e=this;if(!s.default.isCocosGame()&&!s.default.isLayaGame())return Promise.reject(new Error("不支持当前引擎渲染"));var t=this.positionId;return this.winSize.width>this.winSize.height?Promise.reject(new Error("暂不支持横屏游戏渲染")):this.checkTigerCanRender(t).then(function(t){if(t.type===o.tigerType.fakeVideo)return e.checkNodeHasInit()})}},{key:"show",value:function(){var e=this,t=a.default.getSceneId();return this.showPromise?this.showPromise.then(function(){return a.default.isDestroy(e.mainNode)&&e.tigerConfig?e.renderAllNodes():e.mainNode}):this.showPromise=this.load().then(function(){return e.getConfigAndSendRenderLog(e.positionId)}).then(function(n){if(t===a.default.getSceneId()&&!e.tigerConfig)return e.tigerConfig=n.creatives[0],e.creativeId=e.tigerConfig.creativeId,e.tigerVideoConfigs=e.tigerConfig.show_config,e.renderAllNodes()}).catch(function(t){return e.runCallBack("onError",{message:t}),Promise.reject(t)})}},{key:"bindAppShowOrHide",value:function(){var e=this;this.onHideStopVideoFn=function(){e.pauseVideo()},this.onShowPlayVideoFn=function(){e.continueVideo()},s.default.forceBindWxAPI("onShow",this.onShowPlayVideoFn),s.default.forceBindWxAPI("onHide",this.onHideStopVideoFn)}},{key:"bindOffHideStopVideo",value:function(){this.onHideStopVideoFn&&wx.offHide(this.onHideStopVideoFn),this.onShowPlayVideoFn&&wx.offShow(this.onShowPlayVideoFn)}},{key:"unzipVideoImages",value:function(){var e=this.tigerVideoConfigs,t=this.positionId+"_"+this.creativeId,n=e.video;return h[n]?h[n]:h[n]=Promise.resolve().then(function(){return s.default.promiseFy(wx.downloadFile,{url:e.video})}).then(function(e){if(200!==e.statusCode)return console.error("[tigerVideo] 资源包下载失败"),Promise.resolve([]);var n=wx.getFileSystemManager(),r=wx.env.USER_DATA_PATH+"/video_image_"+t+"/",i=["jpeg","jpg","png"];return s.default.promiseFy(n.access,{path:r}).then(function(e){return s.default.promiseFy(n.rmdir,{dirPath:r,recursive:!0}).then(function(){return Promise.resolve()})}).catch(function(){return Promise.resolve()}).then(function(){return s.default.promiseFy(n.unzip,{zipFilePath:e.tempFilePath,targetPath:r})}).then(function(){return s.default.promiseFy(n.readdir,{dirPath:r})}).then(function(e){var t=[];return e.files.forEach(function(e,n){var o=e.split(".").pop();if(i.includes(o)){var a=Number(e.replace(/[^0-9]/g,""));t[a]=r+e}}),t})})}},{key:"renderVideoWrapperNode",value:function(){var e=this.winSize,t=a.default.createNode(this.mainNodeName,{style:{x:0,y:0,width:e.width,height:e.height,bgStyle:{color:"0,0,0"},zIndex:this.getMainNodeZIndex(o.tigerType.fakeVideo)}});a.default.bindTap({node:t,type:"touch"}),this.mainNode=t}},{key:"destroy",value:function(){var e=this;this.stopVideo(),a.default.runExitSceneAction(this.mainNode,o.exitAnimationType.exitToBottom).then(function(){e.mainNode.destroy(),e.runCallBack("onDestroy"),e.bindOffHideStopVideo();var t=e.tigerVideoConfigs,n={runingSecondTotal:Number(e.runingSecondTotal.toFixed(2))};n.isEnded=n.runingSecondTotal>=t.images_num/t.fps,u.default.sendVideoCloseLog({list:[e.tigerConfig],isEnded:n.isEnded,timeLastShow:n.runingSecondTotal}),e.runCallBack("onClose",{isEnded:n.isEnded}),console.log("[tigerVideo close]",n)})}},{key:"renderVideo",value:function(){var e=this,t=this.mainNode,n=this.winSize,r=a.default.createNode("videoNode",{parent:t,style:{x:0,y:n.height/2-n.width/(16/9)/2,width:n.width,height:n.width/(16/9)}}),i=a.default.scaleSizeInCanvas(80),s=a.default.createNode("videoRePlayIconNode",{parent:t,style:{x:n.width/2-i/2,y:n.height/2-i/2,width:i,height:i}});this.showRePlayNode=function(){a.default.showNode(e.videoRePlayIconNode),a.default.loadImage(s,o.videoTigerIcons,f.videoBtn)},this.hideRePlayNode=function(){a.default.hideNode(e.videoRePlayIconNode)},this.videoRePlayIconNode=s,this.videoNode=r,this.playVideo(),a.default.bindTap({node:r,type:"touch",callback:function(){e.isStopVideo&&e.playVideo()}})}},{key:"checkIsPauseVideo",value:function(){var e=this;return new Promise(function(t){e.isPauseVideo?e.checkIsPauseVideoCallBack=function(){t()}:t()})}},{key:"continueVideo",value:function(){this.isShowCloseModal||this.isShowNavigatorModal||(this.checkIsPauseVideoCallBack&&this.checkIsPauseVideoCallBack(),this.hideRePlayNode(),this.isPauseVideo=!1,this.openSound&&this.openSound())}},{key:"pauseVideo",value:function(){this.showRePlayNode(),this.isPauseVideo=!0,this.closeSound&&this.closeSound()}},{key:"stopVideo",value:function(){this.showRePlayNode(),this.isStopVideo=!0,this.closeSound&&this.closeSound(),this.setRemainSecondText(0)}},{key:"playVideo",value:function(){var e=this,t=this.videoNode,n=this.tigerVideoConfigs,r=n.fps,i=0,o=n.images_num,s=o/r;this.isStopVideo=!1,this.isPauseVideo=!1,this.nowVideoPlayTimePosition=0,this.hideRePlayNode(),this.setRemainSecondText(s),n.cover&&a.default.loadImage(t,n.cover),this.unzipVideoImages().then(function(u){n.cover=n.cover||u[0],e.openSound&&e.openSound(),function c(){var d=(i+1)/r;e.nowVideoPlayTimePosition=d,i<u.length&&!e.isStopVideo?(d===Math.floor(d)&&e.setRemainSecondText(s-d),a.default.loadImage(t,u[i]).then(function(){e.runingSecondTotal+=s/o,i+=1,setTimeout(function(){e.checkIsPauseVideo().then(function(){c()})},s/o*1e3)})):(n.cover&&a.default.loadImage(t,n.cover),e.stopVideo())}()})}},{key:"renderVideoCloseButton",value:function(){var e=this,t=this.mainNode,n=this,r=a.default.scaleSizeInCanvas(80),i=a.default.scaleSizeInCanvas(30),s=a.default.createNode("videoCloseNode",{parent:t,style:{width:r,height:i,x:a.default.scaleSizeInCanvas(18),y:a.default.scaleSizeInCanvas(14+this.phoneFixHeight)}}),u=a.default.createLabelNode("videoCloseLabelNode",{parent:t,style:{width:r,height:i,x:a.default.scaleSizeInCanvas(23),y:a.default.scaleSizeInCanvas(19+this.phoneFixHeight),fontStyle:{string:"退出",fontSize:a.default.scaleSizeInCanvas(15),overflow:"clamp",color:"255,255,255"}}});this.setRemainSecondText=function(t){e.closeRemainSecondText||(t=Math.ceil(t),a.default.setStyle(u,{fontStyle:{string:"退出   "+(t>0?t+"秒":"")}}),0===t?(e.closeRemainSecondText=!0,e.videoIsEnded()):e.closeRemainSecondText=!1)},a.default.bindTap({node:s,type:"touch",callback:function(){e.pauseVideo(),e.closeRemainSecondText?n.destroy():(e.isShowCloseModal=!0,wx.showModal({title:"提示",content:"观看完整视频可获得游戏奖励",cancelText:"关闭广告",confirmText:"继续观看",success:function(e){n.isShowCloseModal=!1,e.cancel?n.destroy():n.continueVideo()}}))}});var c={width:a.default.scaleSizeInCanvas(90),height:a.default.scaleSizeInCanvas(35),x:a.default.scaleSizeInCanvas(14),y:a.default.scaleSizeInCanvas(10)+a.default.scaleSizeInCanvas(this.phoneFixHeight)},d=a.default.createNode("videoCloseBorderNode",{parent:t,style:{width:c.width,height:c.height,x:c.x,y:c.y}});this.videoIsNotEnded=function(){a.default.loadImage(d,o.videoTigerIcons,f.closeBtnWithLine)},this.videoIsEnded=function(){a.default.setStyle(d,{width:a.default.scaleSizeInCanvas(50),height:c.height,x:c.x,y:c.y}),a.default.loadImage(d,o.videoTigerIcons,f.closeBtn)},this.videoIsNotEnded()}},{key:"renderSound",value:function(){var e=this,t=this.mainNode,n=this.tigerVideoConfigs,r=a.default.createNode("videoSoundIcon",{parent:t,style:{x:a.default.scaleSizeInCanvas(110),y:a.default.scaleSizeInCanvas(20+this.phoneFixHeight),width:a.default.scaleSizeInCanvas(20),height:a.default.scaleSizeInCanvas(16)}}),i=wx.createInnerAudioContext();i.src=n.audio,this.openSound=function(){if(n.audio){if(!e.isPauseVideo&&!e.isStopVideo&&e.videoSoundIsOpen){var t=e.nowVideoPlayTimePosition>0?e.nowVideoPlayTimePosition:0;i.seek(t),i.play()}e.videoSoundIsOpen&&a.default.loadImage(r,o.videoTigerIcons,f.soundBtnOpened)}},this.closeSound=function(){n.audio&&((!e.videoSoundIsOpen||e.isStopVideo||e.isPauseVideo)&&i.stop(),!e.videoSoundIsOpen&&a.default.loadImage(r,o.videoTigerIcons,f.soundBtnClose))},this.videoSoundIsOpen=!1,this.closeSound(),a.default.bindTap({node:r,type:"touch",callback:function(){e.videoSoundIsOpen?(e.videoSoundIsOpen=!1,e.closeSound()):(e.videoSoundIsOpen=!0,e.openSound())}})}},{key:"renderBanner",value:function(){var e=this,t=this.mainNode,n=this.tigerVideoConfigs,r=this.winSize,i=a.default.createNode("videoBannerNode",{parent:t,style:{width:r.width-a.default.scaleSizeInCanvas(20),height:a.default.scaleSizeInCanvas(100),x:a.default.scaleSizeInCanvas(10),y:r.height-a.default.scaleSizeInCanvas(20)-a.default.scaleSizeInCanvas(100),bgStyle:{color:"255,255,255",radius:6}}}),s=a.default.createNode("videoBannerIcon",{parent:t,style:{width:a.default.scaleSizeInCanvas(70),height:a.default.scaleSizeInCanvas(70),x:a.default.scaleSizeInCanvas(30),y:r.height-a.default.scaleSizeInCanvas(20)-a.default.scaleSizeInCanvas(100)+a.default.scaleSizeInCanvas(15)}});a.default.loadImage(s,n.icon),a.default.createLabelNode("videoBannerTitle",{parent:t,style:{x:a.default.scaleSizeInCanvas(120),y:r.height-a.default.scaleSizeInCanvas(90),width:a.default.scaleSizeInCanvas(170),height:a.default.scaleSizeInCanvas(30),fontStyle:{string:n.title,fontSize:a.default.scaleSizeInCanvas(20),overflow:"clamp",color:"0,0,0"}}}),a.default.createLabelNode("videoBannerContent",{parent:t,style:{x:a.default.scaleSizeInCanvas(120),y:r.height-a.default.scaleSizeInCanvas(60),width:a.default.scaleSizeInCanvas(170),height:a.default.scaleSizeInCanvas(30),fontStyle:{string:n.sub_title,fontSize:a.default.scaleSizeInCanvas(12),overflow:"clamp",color:"191,191,191"}}});var u=a.default.createNode("videoBannerView",{parent:t,style:{x:i.width-a.default.scaleSizeInCanvas(70),y:r.height-a.default.scaleSizeInCanvas(80),width:a.default.scaleSizeInCanvas(60),height:a.default.scaleSizeInCanvas(30)}});a.default.loadImage(u,o.videoTigerIcons,f.viewBtn),a.default.bindTap({node:i,type:"touch",callback:function(){e.pauseVideo(),e.isShowNavigatorModal=!0,e.navigate({positionId:e.positionId,creativeId:e.creativeId}).then(function(t){e.runCallBack("onNavigate",t.navigateMessage),e.isShowNavigatorModal=!1,e.continueVideo()}).catch(function(){e.isShowNavigatorModal=!1,e.continueVideo()})}})}}]),t}();n.default=p},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(3),a=c(r(6)),s=c(r(0)),u=c(r(8)),l=c(r(14));function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=12,h=function(e){function t(e){var n,r=e.positionId,i=e.style,a=void 0===i?{}:i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var u=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return u.scheduleFpsTimer={},u.mainNodeName="recommend_"+r,u.positionId=r,u.defaultStyle=(0,o.getTigerStyle)()[o.tigerType.recommend],u.initUserStyle(a),u.computedIconWidth(),u.watchStyle(),u.load().then(function(){u.runCallBack("onLoad"),u.runCallBack("onResize",u.getOnResizeStyle())}).catch(function(e){u.runCallBack("onError",{message:e})}),n=s.default.bindJsScopeToFn({type:"tigerRecommend",style:u.watchingStyle,show:u.show,hide:u.hide,destroy:u.destroy,onDestroy:u.onDestroy,offDestroy:u.offDestroy,onResize:u.onResize,offResize:u.offResize,onNavigate:u.onNavigate,offNavigate:u.offNavigate,onLoad:u.onLoad,offLoad:u.offLoad,onError:u.onError,offError:u.offError},u),d(u,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),i(t,[{key:"watchStyle",value:function(){var e=this,t=this;this.watchingStyle=s.default.deepClone(this.userStyle);var n=function(n){if(e.watchingStyle.hasOwnProperty(n)){var r=["height","realWidth","realHeight","scale"].includes(n);s.default.watchObjectKey(e.watchingStyle,n,{set:function(e,i){"Number"!==s.default.getVariableType(e)||e===i||r||t.load().then(function(){t.resetStyle(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n,e))})},get:function(e){return"realWidth"===n||"width"===n?t.userStyle.width:"realHeight"===n||"height"===n?t.getRecommendH(t.watchingStyle.realWidth):e}})}};for(var r in this.watchingStyle)n(r)}},{key:"getOnResizeStyle",value:function(){var e=this.userStyle.width,t=this.getRecommendH(e);return{width:e,realWidth:e,height:t,realHeight:t,left:this.userStyle.left,top:this.userStyle.top}}},{key:"getRecommendW",value:function(e){var t=a.default.getWinSize().width;return e<100?100:e>t?t:e}},{key:"getRecommendH",value:function(e){return e/(this.defaultStyle.width/this.defaultStyle.height)}},{key:"scaleToNormalRecommend",value:function(e){return e*this.userStyle.width/this.defaultStyle.width}},{key:"resetStyle",value:function(e){var t=this,n=e.width,r=e.left,i=e.top,o=void 0!==n;if(o){var s=this.getRecommendW(n),u=this.getRecommendH(s);this.userStyle.width!==s&&(this.userStyle.width=s,this.userStyle.height=u,this.userStyle.realWidth=s,this.userStyle.realHeight=u,this.runCallBack("onResize",this.getOnResizeStyle()),this.watchingStyle.realWidth=s,this.watchingStyle.realHeight=u)}else void 0!==r?this.userStyle.left=r:void 0!==i&&(this.userStyle.top=i);this.showPromise&&this.showPromise.then(function(){a.default.setStyle(t.mainNode,{width:t.userStyle.width,height:t.userStyle.height,x:t.userStyle.left,y:t.userStyle.top}),o&&(a.default.setStyle(t.recommendTitleNode,{width:t.scaleToNormalRecommend(100),height:t.scaleToNormalRecommend(20),x:t.scaleToNormalRecommend(10),y:t.scaleToNormalRecommend(10),fontStyle:{fontSize:t.scaleToNormalRecommend(f)}}),a.default.setStyle(t.iconListWrapperMaskNode,{width:t.userStyle.width,height:t.userStyle.height}),a.default.setStyle(t.scrollViewNode,{width:t.userStyle.width,height:t.userStyle.height}),t.computedIconWidth(),t.resetIconsAndWrapper(t.tigerConfig))})}},{key:"renderAllNodes",value:function(){var e=this;this.renderWrapperNode(),this.renderLeftTopTextNode(),this.renderScrollArea(),this.renderIconsAndText(),this.refreshUICallback=function(){e.reLoadConfigAndRenderIcons()},l.default.on(this.refreshUICallback)}},{key:"reLoadConfigAndRenderIcons",value:function(){var e=this;!this.hasTiggerDestroy&&a.default.isNowScene(this.sceneId)&&!a.default.isDestroy(this.mainNode)&&a.default.isVisible(this.mainNode)&&this.getConfigAndSendRenderLog(this.positionId).then(function(t){e.tigerConfig=t,e.renderIconsAndText()})}},{key:"show",value:function(){var e=this,t=a.default.getSceneId();return this.showPromise?this.showPromise.then(function(){return a.default.isDestroy(e.mainNode)&&e.tigerConfig&&(e.hasShow=!0,e.renderAllNodes()),e.mainNode}):this.showPromise=this.load().then(function(){return e.getConfigAndSendRenderLog(e.positionId)}).then(function(n){return t==a.default.getSceneId()&&(e.tigerConfig=n,e.renderAllNodes(),e.hasShow=!0),e.mainNode}).catch(function(t){return e.runCallBack("onError",{message:t}),Promise.reject(t)})}},{key:"initUserStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.width=e.width||this.defaultStyle.width,e.left=e.left||0,e.top=e.top||0;var t=this.getRecommendW(e.width),n=this.getRecommendH(t);this.userStyle={},this.userStyle.width=t,this.userStyle.height=n,this.userStyle.left=e.left,this.userStyle.top=e.top,this.userStyle.realWidth=t,this.userStyle.realHeight=n,this.userStyle.zIndex=void 0===e.zIndex?this.getMainNodeZIndex(o.tigerType.recommend):e.zIndex}},{key:"load",value:function(){return s.default.isCocosGame()||s.default.isLayaGame()?this.loadPromise?this.loadPromise:this.loadPromise=this.checkTigerCanRender(this.positionId):Promise.reject(new Error("不支持当前引擎渲染"))}},{key:"hide",value:function(){a.default.hideNode(this.mainNode)}},{key:"destroy",value:function(){if(this.hasShow&&this.mainNode&&!a.default.isDestroy(this.mainNode)){for(var e in this.scheduleFpsTimer)this.scheduleFpsTimer.hasOwnProperty(e)&&clearTimeout(this.scheduleFpsTimer[e].time);this.hasTiggerDestroy=!0,this.showPromise=null,this.mainNode.destroy(),l.default.off(this.refreshUICallback),this.runCallBack("onDestroy")}}},{key:"renderWrapperNode",value:function(){var e=this.userStyle,t=a.default.createNode(this.mainNodeName,{style:{x:e.left,y:e.top,width:e.width,height:e.height,bgStyle:{opacity:.4,color:"0,0,0"},zIndex:e.zIndex}});this.mainNode=t}},{key:"renderLeftTopTextNode",value:function(){var e=this.mainNode,t=a.default.createLabelNode("recommendTitleNode",{parent:e,style:{width:this.scaleToNormalRecommend(100),height:this.scaleToNormalRecommend(20),x:this.scaleToNormalRecommend(10),y:this.scaleToNormalRecommend(10),fontStyle:{string:"猜你喜欢",fontSize:this.scaleToNormalRecommend(f),color:"255,255,255",overflow:"clamp"}}});this.recommendTitleNode=t}},{key:"renderScrollArea",value:function(){var e=this.mainNode,t=this.userStyle,n=a.default.createNode("recommendScrollArea",{parent:e,style:{x:0,y:0,width:t.width,height:t.height}}),r=a.default.createMaskNode("iconListWrapperNode",{parent:n,maskNodeStyle:{type:"RECT",rectNode:n,width:t.width,height:t.height,x:0,y:0},innerNodeStyle:{width:(this.iconWidth+this.iconMarginLeft)*this.tigerConfig.creatives.length+ +this.iconMarginLeft,height:t.height,x:0,y:0}}),i=r.innerNode,o=r.maskNode;a.default.setScrollViewNode(n,{content:i,horizontal:!0,vertical:!1}),this.iconListWrapperMaskNode=o,this.iconListWrapperNode=i,this.scrollViewNode=n}},{key:"computedIconWidth",value:function(){var e=this.userStyle,t=this.scaleToNormalRecommend(20),n=e.width/5*(1-t/e.width)-t;this.iconWidth=n,this.iconMarginLeft=t}},{key:"renderIconsAndText",value:function(){var e=this;this.iconAndTextNodes&&(this.iconAndTextNodes.forEach(function(e){e.destroy()}),this.iconAndTextNodes=[]);var t=this.tigerConfig,n=this.iconMarginLeft,r=this.iconWidth,i={x:0,y:0,width:r,height:r},o={x:0,y:i.height+this.scaleToNormalRecommend(10),height:this.scaleToNormalRecommend(20),fontStyle:{fontSize:this.scaleToNormalRecommend(12),horizontalAlign:"center",color:"255,255,255",overflow:"clamp"}},a={x:0,y:this.scaleToNormalRecommend(35)};this.iconAndTextNodes=t.creatives.map(function(t,s){var u=0===s?n:n*(s+1)+r*s;return o.string=t.show_config.title||"",i.imageUrl=t.show_config.image||t.show_config.images,Array.isArray(i.imageUrl)&&(i.fps=t.show_config.fps,i.id="icon_"+s),a.x=u,e.renderIconWrapper(a,i,o,t)})}},{key:"renderIconWrapper",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this.iconListWrapperNode,o=s.default.cutStringAndBackWidth(n.string,n.fontStyle.fontSize,5),u=Math.ceil(o.width),c=Math.max(t.width,u);t.x=(c-t.width)/2,n.x=(t.width-u)/2,n.fontStyle.string=o.string,n.width=u;var d=a.default.createNode("iconWrapperNode",{parent:i,style:{width:c,height:n.y+t.height,x:e.x,y:e.y}});return this.renderIcon(d,t),this.renderIconText(d,n),this.renderIconCornerNode(d,t,r),this.bindTapEvent(d,r),d}},{key:"renderIcon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.default.createMaskNode("recommendIconMaskNode",{parent:e,maskNodeStyle:{type:"ELLIPSE",width:t.width,height:t.height,x:0,y:0},innerNodeStyle:{width:t.width,height:t.height,x:0,y:0}});Array.isArray(t.imageUrl)?this.fpsIconLooper(n.innerNode,t):a.default.loadImage(n.innerNode,t.imageUrl)}},{key:"fpsIconLooper",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.id){this.scheduleFpsTimer[n.id]={},this.scheduleFpsTimer[n.id].fps=n.fps,this.scheduleFpsTimer[n.id].imageUrl=n.imageUrl,this.scheduleFpsTimer[n.id].index=1,this.scheduleFpsTimer[n.id].time=1;var r=this.scheduleFpsTimer[n.id];r.scheduleFps=function(n){clearTimeout(r.time),r.time=setTimeout(function(){t.tigerConfig.isOpen&&r.fps>0&&a.default.isVisible(e)&&!a.default.isDestroy(e)?(r.index>=n.length&&(r.index=0),a.default.loadImage(e,n[r.index]).then(function(){r.index+=1,r.scheduleFps(n)})):clearTimeout(r.time)},1/r.fps*1e3)},r.scheduleFps(r.imageUrl)}}},{key:"renderIconCornerNode",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2],i=r.corner_style;i&&(this.cornerNode={},Object.keys(i).forEach(function(o){var s=i[o];null!==s&&(t.cornerNode[o]=function(e){var t=e.creativeId,n=e.wrapperNode,r=e.iconNodeStyle,i=e.type,o=void 0===i?1:i,s=e.position,u=e.style,c=void 0===u?{}:u,d="iconWrapperNode_corner_"+s;c={width:this.countScaleToStandardCanvasSize(c.width),height:this.countScaleToStandardCanvasSize(c.height)};var l=this.getCornerClickCatch(t);if(1===o&&l)return null;var f=function(e){e.type;var t=e.position,n=e.iconNodeStyle,r=e.style,i=n.height,o=n.width,a={left_top:{y:0,x:0},left_bottom:{y:i-=r.height,x:0},right_top:{y:0,x:o-=r.width},right_bottom:{y:i,x:o}};return a[t]||a.right_top}.call(this,{type:o,position:s,style:c,iconNodeStyle:r});return a.default.createNode(d,{parent:n,style:{x:f.x,y:f.y,width:c.width,height:c.height,zIndex:this.userStyle.zIndex+1}})}.call(t,{creativeId:r.creativeId,wrapperNode:e,iconNodeStyle:n,position:o,type:s.type,style:s}),t.cornerNode[o]&&s&&s.image&&a.default.loadImage(t.cornerNode[o],s.image))}))}},{key:"resetIconsAndWrapper",value:function(e){this.tigerConfig=e,a.default.setStyle(this.iconListWrapperNode,{width:(this.iconWidth+this.iconMarginLeft)*e.creatives.length+this.iconMarginLeft,height:this.userStyle.height,x:0,y:0}),this.renderIconsAndText()}},{key:"bindTapEvent",value:function(e,t){var n=this;a.default.setNodeClickScaleTransition(e),a.default.bindTap({node:e,callback:function(e){n.setCornerClickCatch(t.creativeId),n.navigate({positionId:t.positionId,creativeId:t.creativeId}).then(function(e){n.runCallBack("onNavigate",e.navigateMessage),n.resetIconsAndWrapper(e)}).catch(function(e){n.resetIconsAndWrapper(e)})}})}},{key:"renderIconText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.default.createLabelNode("recommendIconTextNode",{parent:e,style:t})}}]),t}();n.default=h},function(n,r,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=d(i(8)),s=i(3),u=d(i(6)),c=d(i(2)),f=d(i(14)),h=d(i(0));function d(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(e){var n=e.positionId,r=e.style,i=void 0===r?{}:r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.positionId=n,o.mainNodeName="tigerIcon_"+n,o.userStyle=i||{},l(o,h.default.bindJsScopeToFn({type:"tigerIcon",show:o.show,onDestroy:o.onDestroy,offDestroy:o.offDestroy,onError:o.onError,offError:o.offError,onNavigate:o.onNavigate,offNavigate:o.offNavigate,destroy:o.destroy},o))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),o(t,[{key:"show",value:function(){var e=this;return this.showPromise?this.showPromise:this.showPromise=this.getConfigAndSendRenderLog(this.positionId).then(function(t){return e.tigerConfig=t,e.renderNodeAndStyle(),e.refreshUITimerCallBack=function(){e.reRenderTigerToView()},f.default.on(e.refreshUITimerCallBack),e.mainNode}).catch(function(t){return e.runCallBack("onError",{message:t}),Promise.reject(t)})}},{key:"getConfigImages",value:function(e){return e.show_config.image?[e.show_config.image]:e.show_config.images?e.show_config.images:[]}},{key:"initIconStyle",value:function(){this.defaultStyle=(0,s.getTigerStyle)(this.tigerConfig.creatives[0].size)[this.tigerConfig.type];var e=this.countScaleToStandardCanvasSize(100),t=u.default.getWinSize().width;this.userStyle.width=this.userStyle.width||e;var n=this.userStyle.width<e?e:this.userStyle.width>t?t:this.userStyle.width;this.iconStyle={width:n,height:n/(this.defaultStyle.width/this.defaultStyle.height),left:this.userStyle.left||0,top:this.userStyle.top||0,zIndex:void 0!==this.userStyle.zIndex?this.userStyle.zIndex:this.getMainNodeZIndex(s.tigerType.floatIcon)};var r=this.tigerConfig.borderStyle;if(r&&r.imageUrl){var i=r.size.split("x"),o={width:Number(i[0]),height:Number(i[1])},a=n/(this.defaultStyle.width/o.width);this.iconStyle.borderStyle=Object.assign(r,{width:a,height:a/(o.width/o.height),left:r.left*(a/o.width),top:r.top*(a/o.width)})}}},{key:"renderIconBorderNode",value:function(){if(this.iconStyle.borderStyle&&this.iconStyle.borderStyle.imageUrl){var e=this.mainNodeName+"_border",t=u.default.createNode(e,{parent:this.mainNode,style:{x:0,y:0,width:this.iconStyle.borderStyle.width,height:this.iconStyle.borderStyle.height}});this.borderNode=t}}},{key:"renderBorderImage",value:function(){return this.borderNode&&this.iconStyle.borderStyle?u.default.loadImage(this.borderNode,this.iconStyle.borderStyle.imageUrl):Promise.resolve()}},{key:"renderIconCornerNode",value:function(){var e=this,t=this.tigerConfig.creatives[0],n=t.corner_style;if(n){this.cornerNode={};var r=t.creativeId;Object.keys(n).forEach(function(t){var i=n[t];null!==i&&(e.cornerNode[t]=function(e){var t=e.creativeId,n=e.type,r=void 0===n?1:n,i=e.position,o=e.style,a=void 0===o?{}:o,s=this.iconStyle.width/(this.defaultStyle.width/a.width),c=this.mainNodeName+"_"+i;a={width:s,height:s};var d=this.getCornerClickCatch(t);if(1===r&&d)return null;var l=function(e){var t=e.type,n=e.position,r=e.style,i=0,o=0,a=this.iconStyle.height,s=this.iconStyle.width;if(this.iconStyle.borderStyle&&(i=this.iconStyle.borderStyle.left,o=this.iconStyle.borderStyle.top,s=i+this.iconStyle.width,a=o+this.iconStyle.height),1===t){var u=r.width/2,c=r.height/2;i-=u,o-=c,a-=c,s-=u}else a-=r.height,s-=r.width;var d={left_top:{y:o,x:i},left_bottom:{y:a,x:i},right_top:{y:o,x:s},right_bottom:{y:a,x:s}};return d[n]||d.right_top}.call(this,{type:r,position:i,style:a});return u.default.createNode(c,{parent:this.mainNode,style:{x:l.x,y:l.y,width:a.width,height:a.height,zIndex:this.iconStyle.zIndex+1}})}.call(e,{creativeId:r,position:t,type:i.type,style:i}))})}}},{key:"renderCornerImage",value:function(){var e=this;if(this.cornerNode){var t=[],n=this.tigerConfig.creatives[0].corner_style;return n?(Object.keys(n).forEach(function(r){var i=e.cornerNode[r];i&&t.push(u.default.loadImage(i,n[r].image))}),Promise.all(t)):Promise.resolve()}return Promise.resolve()}},{key:"initMainNode",value:function(){var e=this.iconStyle.left,t=this.iconStyle.top,n=this.iconStyle.zIndex;this.mainNode&&this.mainNode.destroy();var r=u.default.createNode(this.mainNodeName,{style:{x:e,y:t,width:this.iconStyle.borderStyle?this.iconStyle.borderStyle.width:this.iconStyle.width,height:this.iconStyle.borderStyle?this.iconStyle.borderStyle.height:this.iconStyle.height,zIndex:n}});this.mainNode=r;var i=u.default.getStylePosition(r,{width:this.iconStyle.width,height:this.iconStyle.height,x:e,y:t});this.customConfig={x:i.x,y:i.y}}},{key:"renderAllImageToNodes",value:function(){var e=this,t=this.mainNode,n=this.customConfig,r=this.tigerConfig,i=this.getConfigImages(r.creatives[0]);this.imageIsLoading=!0,this.imageNode=u.default.createNode(this.mainNodeName+"_image",{parent:t,style:{x:this.iconStyle.borderStyle?this.iconStyle.borderStyle.left:0,y:this.iconStyle.borderStyle?this.iconStyle.borderStyle.top:0,width:this.iconStyle.width,height:this.iconStyle.height}}),u.default.hideNode(this.mainNode),Promise.all([this.renderBorderImage(),this.renderCornerImage(),u.default.loadImage(this.imageNode,i[0])]).then(function(){u.default.showNode(e.mainNode),e.imageIsLoading=!1,e.checkIsRunEnterSceneAction().then(function(){u.default.runAction(t,r.creatives[0].show_config.show_type,{x:n.x,y:n.y}),e.startAutoSwitch()}),i.length>0&&e.fpsIconLooper(i)})}},{key:"bindTapEvent",value:function(){var e=this,t=this.mainNode;u.default.setNodeClickScaleTransition(t),u.default.bindTap({node:t,type:"touch",callback:function(){if(!e.imageIsLoading){var t=e.tigerConfig.creatives[0],n=t.creativeId;e.setCornerClickCatch(t.creativeId),e.navigate({positionId:t.positionId,creativeId:t.creativeId}).then(function(t){e.runCallBack("onNavigate",t.navigateMessage),e.tigerConfig.creatives[0].creativeId===n&&(e.tigerConfig=t,e.renderNodeAndStyle())})}}})}},{key:"renderNodeAndStyle",value:function(){this.initIconStyle(),this.initMainNode(),this.bindTapEvent(),this.renderIconBorderNode(),this.renderIconCornerNode(),this.renderAllImageToNodes(),this.hasShow=!0}},{key:"checkIsRunEnterSceneAction",value:function(){var e=this;return new Promise(function(t){if(e.isAlreadyShowEnterAnimation)return t();var n=e.mainNode,r=e.tigerConfig,i=e.customConfig,o=r.position_show_type;u.default.runEnterSceneAction(n,o,{x:i.x,y:i.y}).then(function(){e.isAlreadyShowEnterAnimation=!0,t()})})}},{key:"fpsIconLooper",value:function(t){var n=this,r=1;!function e(t){clearTimeout(n.scheduleFpsTimer),n.scheduleFpsTimer=setTimeout(function(){var i=n.imageNode,o=n.sceneId,a=n.tigerConfig.creatives[0];n.tigerConfig.isOpen&&a.show_config.fps>0&&u.default.isNowScene(o)&&u.default.isVisible(i)&&!u.default.isDestroy(i)?(r>=t.length&&(r=0),u.default.loadImage(i,t[r]).then(function(){r+=1,e(t)})):clearTimeout(n.scheduleFpsTimer)},1/n.tigerConfig.creatives[0].show_config.fps*1e3)}(t)}},{key:"startAutoSwitch",value:function(){var e=this,t=Date.now(),n=this.tigerConfig;clearTimeout(this.autoSwitchTimer),this.autoSwitchTimer=setTimeout(function(){var r=c.default.APP_STATUS_SHOW_STAMPS[c.default.APP_STATUS_SHOW_STAMPS.length-1];t<r?e.startAutoSwitch():n.auto_change>0?e.reRenderTigerToView():clearTimeout(e.autoSwitchTimer)},1e3*n.auto_change)}},{key:"reRenderTigerToView",value:function(){var e=this,t=this.sceneId,n=this.mainNode;!this.hasTiggerDestroy&&u.default.isNowScene(t)&&u.default.isVisible(n)&&!u.default.isDestroy(n)?this.getConfigAndSendRenderLog(this.positionId).then(function(t){e.tigerConfig=t||{},e.renderNodeAndStyle()}):this.destroy()}},{key:"destroy",value:function(){var e=this.mainNode,t=this.scheduleFpsTimer,n=this.autoSwitchTimer;this.hasShow&&e&&!u.default.isDestroy(e)&&(clearTimeout(t),clearTimeout(n),f.default.off(this.refreshUITimerCallBack),e.destroy(),this.hasTiggerDestroy=!0,this.runCallBack("onDestroy"))}}]),t}();r.default=p},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=u(r(8)),a=r(3),s=u(r(6)),d=u(r(0));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.positionId=e,n.mainNodeName="blinkPage_"+e,c(n,d.default.bindJsScopeToFn({type:"tigerBlinkPage",show:n.show,onDestroy:n.onDestroy,offDestroy:n.offDestroy,onError:n.onError,onNavigate:n.onNavigate,offNavigate:n.offNavigate,offError:n.offError},n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"show",value:function(){var e=this;return this.showPromise?this.showPromise:this.showPromise=this.getConfigAndSendRenderLog(this.positionId).then(function(t){return e.tigerConfig=t.creatives[0],e.defaultStyle=(0,a.getTigerStyle)()[t.type],e.initMainNode(e.tigerConfig),e.initIconNode(),e.mainNode}).catch(function(t){return e.runCallBack("onError",{message:t}),Promise.reject(t)})}},{key:"initMainNode",value:function(e){var t=this,n=s.default.createNode(this.mainNodeName,{style:{x:0,y:0,width:this.defaultStyle.width,height:this.defaultStyle.height,zIndex:this.getMainNodeZIndex(a.tigerType.blinkIcon)}});s.default.loadImage(n,e.show_config.image),this.mainNode=n,s.default.bindTap({node:n,type:"touch",callback:function(){t.navigate({positionId:e.positionId,creativeId:e.creativeId}).then(function(e){t.runCallBack("onNavigate",e.navigateMessage)})}}),setTimeout(function(){t.destroy()},1e3*e.show_config.duration)}},{key:"initIconNode",value:function(){var e=this,t=this.mainNode,n=s.default.scaleSizeInCanvas(64),r=s.default.scaleSizeInCanvas(32),i=s.default.scaleSizeInCanvas(10),o=s.default.createNode("blink_tips",{parent:t,style:{x:0,y:0,width:n,height:r}});s.default.loadImage(o,a.blinkTigerTipsIcon);var u=s.default.createNode("blink_cancel",{parent:t,style:{x:this.defaultStyle.width-n-i,y:this.defaultStyle.height-r-i,width:n,height:r}});s.default.loadImage(u,a.blinkTigerCancelIcon).then(function(){s.default.bindTap({node:u,type:"touch",callback:function(){e.destroy()}})})}},{key:"destroy",value:function(){s.default.isDestroy(this.mainNode)||(this.mainNode.destroy(),this.runCallBack("onDestroy"))}}]),t}();n.default=l},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=u(r(8)),a=r(3),s=u(r(6)),d=u(r(0));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.positionId=e,n.mainNodeName="interstitialAd_"+e,c(n,d.default.bindJsScopeToFn({type:"interstitialAd",show:n.show,onDestroy:n.onDestroy,offDestroy:n.offDestroy,onNavigate:n.onNavigate,offNavigate:n.offNavigate,onError:n.onError,offError:n.offError},n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"show",value:function(){var e=this;return this.showPromise?this.showPromise:this.showPromise=this.getConfigAndSendRenderLog(this.positionId).then(function(t){return e.initDefaultStyle(t),e.initMainNode(t),e.initMainImage(t),e.initCloseBtnBgNode(),e.initTimeTextNode(t),e.mainNode}).catch(function(t){return e.runCallBack("onError",{message:t}),Promise.reject(t)})}},{key:"initDefaultStyle",value:function(e){var t=e.creatives[0].size,n=(0,a.getTigerStyle)(t)[e.type],r=n.width/this.scaleToStandardCanvasSize;this.defaultStyle={width:r,height:n.height/this.scaleToStandardCanvasSize,x:(this.winSize.width-r)/2,y:s.default.scaleSizeInCanvas(150)}}},{key:"initMainNode",value:function(e){var t=s.default.createNode(this.mainNodeName,{style:{x:0,y:0,bgStyle:{opacity:.4,color:"0,0,0"},width:this.winSize.width,height:this.winSize.height,zIndex:this.getMainNodeZIndex(a.tigerType.intersititialAd)}});s.default.bindTap({node:t,type:"touch",callback:function(){}}),this.mainNode=t}},{key:"initMainImage",value:function(e){var t=this,n=this.mainNode,r=s.default.createNode("main_image",{parent:n,style:this.defaultStyle});s.default.loadImage(r,e.creatives[0].show_config.image),s.default.bindTap({node:r,type:"touch",callback:function(){t.navigate({positionId:e.creatives[0].positionId,creativeId:e.creatives[0].creativeId}).then(function(e){t.runCallBack("onNavigate",e.navigateMessage)})}})}},{key:"initCloseBtnBgNode",value:function(){var e=this.mainNode,t=s.default.scaleSizeInCanvas(20),n=s.default.scaleSizeInCanvas(20),r=s.default.createNode("close_bg",{parent:e,style:{x:(this.winSize.width-this.defaultStyle.width)/2+this.defaultStyle.width-5-t,y:s.default.scaleSizeInCanvas(120),width:t,height:n}});s.default.loadImage(r,a.closeBtnBg)}},{key:"initCloseXNode",value:function(){var e=this,t=this.mainNode,n=s.default.scaleSizeInCanvas(20),r=s.default.scaleSizeInCanvas(20),i=s.default.createNode("close_x",{parent:t,style:{x:(this.winSize.width-this.defaultStyle.width)/2+this.defaultStyle.width-5-n,y:s.default.scaleSizeInCanvas(120),width:n,height:r}});s.default.loadImage(i,a.closeBtnX),s.default.bindTap({node:i,type:"touch",callback:function(){e.destroy()}})}},{key:"initTimeTextNode",value:function(e){if(e.duration>0){var t=this.mainNode,n=s.default.scaleSizeInCanvas(20),r=s.default.scaleSizeInCanvas(20);this.timeTextNode=s.default.createLabelNode("time_text",{parent:t,style:{x:(this.winSize.width-this.defaultStyle.width)/2+this.defaultStyle.width-s.default.scaleSizeInCanvas(16),y:s.default.scaleSizeInCanvas(124),width:n,height:r,fontStyle:{string:e.duration,fontSize:s.default.scaleSizeInCanvas(10),overflow:"clamp",color:"255,255,255"}}}),this.loopTimeText(e.duration)}else this.initCloseXNode()}},{key:"loopTimeText",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;setTimeout(function(){t-=1,s.default.setStyle(e.timeTextNode,{fontStyle:{string:t}}),t<=0?(e.timeTextNode.destroy(),e.initCloseXNode()):e.loopTimeText(t)},1e3)}},{key:"destroy",value:function(){s.default.isDestroy(this.mainNode)||(this.mainNode.destroy(),this.runCallBack("onDestroy"))}}]),t}();n.default=l},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=u(r(0)),a=u(r(15)),s=u(r(7)),c=u(r(2));function u(e){return e&&e.__esModule?e:{default:e}}var d=null;n.default=new(function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);try{o.default.listenWxAPI("createBannerAd",function(e){var n=e.userOptions,r=e.wxOriginReturns;return t.catchBannerBehaviour(n[0],r)})}catch(e){this.rewriteBannerAdFail=!0}}return i(e,[{key:"catchBannerBehaviour",value:function(e,t){var n=e.adUnitId,r=!1,i=null,o=function(){console.log("[wxBanner onLoad]"),r=!0,s.default.send("bannerLoad",{adUnitId:n})},a=function(e){console.log("[wxBanner error]: ",e);var t=r?"bannerShowError":"bannerLoadError";console.log("[wxBanner errorType]: ",t);var i={adUnitId:n,errMsg:JSON.stringify(e)};void 0!==e.errCode&&(i.errCode=e.errCode),s.default.send(t,i)};t.onLoad(o),t.onError(a);var u=t.offLoad.bind(t),c=t.offError.bind(t);return t.offLoad=function(e){u(e),e||t.onLoad(o)},t.offError=function(e){c(e),e||t.onError(a)},{style:t&&t.style,show:function(){return i||(i=t.show().then(function(e){return d=n,s.default.send("bannerShow",{adUnitId:n}),e})),i},destroy:function(){return d=null,i=null,r=!1,t.destroy()},hide:function(){return d=null,i=null,r=!1,t.hide()},onResize:function(e){return t.onResize(e)},offResize:function(e){return t.offResize(e)},onLoad:function(e){return t.onLoad(e)},offLoad:function(e){return t.offLoad(e)},onError:function(e){return t.onError(e)},offError:function(e){return t.offError(e)}}}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.rewriteBannerAdFail){var t=wx.createBannerAd(e);return this.catchBannerBehaviour(e,t)}return wx.createBannerAd(e)}},{key:"sendBannerBack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d?a.default.showRewardedVideoAd?console.log("[bannerBack block] hasShowVideo"):c.default.isSharing?console.log("[bannerBack block] isSharing"):c.default.hasTiggerNavigate?console.log("[bannerBack block] hasTiggerNavigate"):e&&e.targetPagePath&&(e.targetPagePath.match(/wx.*?\:/)||e.targetPagePath.toLowerCase().includes("nativelandingpages")||e.targetPagePath.includes("http"))&&s.default.send("bannerBack",{adUnitId:d}):console.log("[bannerBack block] notHasBanner")}}]),e}())},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=a(r(1)),s=a(r(5));function a(e){return e&&e.__esModule?e:{default:e}}var u="";n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"stop",value:function(){u&&clearInterval(u),u=""}},{key:"start",value:function(){s.default.fetchUserInfo().then(function(e){u||(o.default.postHeartBeatRecord({uid:e.open_id,uidfp:e.ofp,uidfp2:e.ofp2}),u=setInterval(function(){o.default.postHeartBeatRecord({uid:e.open_id,uidfp:e.ofp,uidfp2:e.ofp2})},5e3))})}}]),e}())},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(r(1)),a=s(r(2)),u=s(r(0));function s(e){return e&&e.__esModule?e:{default:e}}var c=0,d=0,l=0,f={appLoaded:"t1",progressStart:"t2",progressEnd:"t3"},h=0,p=0;n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"send",value:function(e){if(!u.default.isRuningMiniGame())return new Error("[sendLoadingLog]: 该接口目前仅支持小游戏");var t={},n=f[e];if("t1"===n)0===c&&(c=Date.now(),t={timeToStart:0});else if("t2"===n){if(!c)throw new Error("[sendLoadingLog]: progressStart类型日志必须在appLoaded(应用加载)日志之后发送");if(0!==d)throw new Error("[sendLoadingLog]: progressStart日志只能发送一次");a.default.APP_STATUS_HIDE_STAMPS.forEach(function(e,t){var n=a.default.APP_STATUS_SHOW_STAMPS[t+1];c<e&&n&&(h+=n-e)});var r=(d=Date.now())-c;t={timeToStart:r-h,timeToLast:r-h}}else if("t3"===n){if(!d)throw new Error("[sendLoadingLog]: progressEnd类型日志必须在progressStart之后发送");if(0!==l)throw new Error("[sendLoadingLog]: progressEnd日志只能发送一次");a.default.APP_STATUS_HIDE_STAMPS.forEach(function(e,t){var n=a.default.APP_STATUS_SHOW_STAMPS[t+1];d<e&&n&&(p+=n-e)}),l=Date.now(),t={timeToStart:l-c-p-h,timeToLast:l-d-p}}a.default.getAppShowOptions().then(function(){if(!(["t1","t2","t3"].indexOf(n)>-1))throw new Error("[sendLoadingLog]: 请传入正确类型");o.default.postLoadingLog(a.default.packLogData(n,t))})}}]),e}())},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(r(0)),a=s(r(7)),u=r(4);function s(e){return e&&e.__esModule?e:{default:e}}var c=0,d=0;n.default=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"sendEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};if(""!=e&&"String"==o.default.getVariableType(e))if(JSON.stringify(t).length>512)r(o.default.makeResponse(u.RESPONSE.CUSTOM_EVENT_DATA_LENGTH_EXCEED_LIMIT));else{for(var i in t)if(t.hasOwnProperty(i)){if(!0===[void 0,null,NaN].includes(t[i]))return void r(o.default.makeResponse(u.RESPONSE.CUSTOM_EVENT_KEY_NOT_LEGAL));if(-1===["Number","String"].indexOf(o.default.getVariableType(t[i])))return void r(o.default.makeResponse(u.RESPONSE.CUSTOM_EVENT_VALUE_TYPE_ILLEGAL));if(i.length>16)return void r(o.default.makeResponse(u.RESPONSE.CUSTOM_EVENT_KEY_LENGTH_EXCEED_LIMIT));if(String(t[i]).length>128)return void r(o.default.makeResponse(u.RESPONSE.CUSTOM_EVENT_VALUE_LENGTH_EXCEED_LIMIT))}var s=Date.now(),l=s-d;c>=10&&l<1e3?r(o.default.makeResponse(u.RESPONSE.EVENT_CALLTIMES_LIMITS)):(l>=1e3&&(c=0),c+=1,d=s,a.default.send("custom_event",{eventId:e,eventObj:t}).then(n).catch(r))}else r(o.default.makeResponse(u.RESPONSE.CUSTOM_EVENT_ID_IS_NULL))}}]),e}())}]);